<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIOXY Fashion Footprint Calculator v2.0 - PROTECTED</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs@gh-pages/qrcode.min.js"></script>
    <style>
        /* ================== ACCESS PROMPT STYLES ================== */
        .access-prompt {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .access-box {
            background: linear-gradient(135deg, #2e8b57 0%, #1a3e2d 100%);
            padding: 3rem;
            border-radius: 15px;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            border: 2px solid #d4af37;
        }
        
        .access-input {
            padding: 15px;
            margin: 1rem 0;
            width: 100%;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            text-align: center;
        }
        
        .founder-btn {
            background: linear-gradient(135deg, #d4af37 0%, #bf953f 100%);
            color: #1a3e2d;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            font-size: 1.1rem;
        }
        
        .public-btn {
            background: transparent;
            color: white;
            border: 2px solid white;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }

        /* ================== EXISTING CALCULATOR STYLES ================== */
        :root { 
            --aioxy-primary: #2e8b57;
            --aioxy-secondary: #3a7d54; 
            --aioxy-dark: #1a3e2d;
            --twitter-blue: #1DA1F2;
            --background-light: #f8f9fa;
            --water-blue: #1e88e5;
            --impact-orange: #ff6b35;
            --luxury-gold: #d4af37;
            --innovation-purple: #8a2be2;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
            line-height: 1.6;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
        }
        
        .header {
            text-align: center;
            padding: 2rem 1rem;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, var(--aioxy-dark) 0%, var(--aioxy-primary) 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        
        @media (min-width: 900px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .card h2 {
            color: var(--aioxy-dark);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--aioxy-primary);
            font-size: 1.5rem;
        }
        
        .input-section { 
            background: var(--background-light); 
            padding: 1.5rem; 
            border-radius: 12px; 
            margin-bottom: 1.5rem; 
        }
        
        button { 
            background: var(--aioxy-primary); 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 8px 0; 
            transition: all 0.2s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background: var(--aioxy-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        input, select { 
            padding: 12px; 
            margin: 8px 0; 
            width: 100%; 
            box-sizing: border-box; 
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--aioxy-primary);
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
        }
        
        .input-row { 
            display: flex; 
            gap: 12px; 
            margin-bottom: 12px; 
            align-items: center; 
        }
        
        .input-row > * { flex: 1; }
        
        .input-row > button { 
            flex: 0 0 40px; 
            background: #dc3545;
            color: white;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #results { 
            margin-top: 2rem; 
            padding: 2rem; 
            background: white; 
            border-radius: 12px; 
            display: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .calculate-btn { 
            background: var(--aioxy-dark); 
            color: white;
            font-weight: bold; 
            width: 100%;
            padding: 16px;
            font-size: 1.1rem;
            margin-top: 1rem;
        }
        
        #qrcode-container {
            margin: 2rem auto;
            text-align: center;
            padding: 1.5rem;
            background: var(--background-light);
            border-radius: 12px;
            border: 1px solid #eee;
        }
        
        #qrcode {
            margin: 0 auto;
        }
        
        #qrcode img {
            padding: 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .export-buttons { 
            display: flex; 
            gap: 12px; 
            margin-top: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .savings {
            color: var(--aioxy-primary);
            font-weight: bold;
            background: #e8f5ee;
            padding: 12px 16px;
            border-radius: 8px;
            display: inline-block;
            margin: 8px 0;
            font-size: 1.1rem;
            border-left: 4px solid var(--aioxy-primary);
        }
        
        .water-savings {
            color: var(--water-blue);
            font-weight: bold;
            background: #e3f2fd;
            padding: 12px 16px;
            border-radius: 8px;
            display: inline-block;
            margin: 8px 0;
            font-size: 1.1rem;
            border-left: 4px solid var(--water-blue);
        }
        
        .innovation-savings {
            color: var(--innovation-purple);
            font-weight: bold;
            background: #f3e8fd;
            padding: 12px 16px;
            border-radius: 8px;
            display: inline-block;
            margin: 8px 0;
            font-size: 1.1rem;
            border-left: 4px solid var(--innovation-purple);
        }
        
        .impact-story {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            text-align: center;
        }
        
        .impact-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0.5rem 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .impact-label {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        #downloadQR {
            display: inline-block;
            background: var(--aioxy-dark);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-top: 1rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        #downloadQR:hover {
            background: var(--aioxy-primary);
            transform: translateY(-2px);
        }
        
        .error-message {
            color: #dc3545;
            font-weight: bold;
            margin: 12px 0;
            padding: 12px;
            background: #ffeaea;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
        }
        
        #chart-container {
            margin: 2rem auto;
            max-width: 400px;
            height: 300px;
        }
        
        .material-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--aioxy-primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .luxury-badge {
            background: linear-gradient(135deg, var(--luxury-gold) 0%, #bf953f 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .innovation-badge {
            background: linear-gradient(135deg, var(--innovation-purple) 0%, #6a0dad 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .data-source {
            font-size: 0.9rem;
            color: #666;
            margin-top: 1rem;
            text-align: center;
            font-style: italic;
        }
        
        .story-section {
            background: #fff9e6;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border-left: 4px solid var(--impact-orange);
        }
        
        .story-heading {
            color: var(--impact-orange);
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .certification-badges {
            display: flex;
            gap: 0.8rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .cert-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .cert-badge.organic { background: #27ae60; color: white; }
        .cert-badge.recycled { background: #3498db; color: white; }
        .cert-badge.vegan { background: #2ecc71; color: white; }
        .cert-badge.innovation { background: var(--innovation-purple); color: white; }
        
        .material-comparison {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .comparison-item {
            background: rgba(255,255,255,0.2);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .input-row {
                flex-direction: column;
            }
            
            .input-row > * {
                width: 100%;
            }
            
            #qrcode { 
                width: 180px; 
                height: 180px; 
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            #chart-container {
                max-width: 300px;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .footprint-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .comparison-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }
        
        .your-value {
            color: var(--aioxy-primary);
        }
        
        .avg-value {
            color: #666;
        }
        
        .master-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        /* USAGE LIMIT STYLES */
        #usage-limit-message {
            display: none;
            margin: 2rem 0;
        }
        
        .usage-counter {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--aioxy-dark);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <!-- ACCESS PROMPT (SHOWS FIRST) -->
    <div id="accessPrompt" class="access-prompt">
        <div class="access-box">
            <h1>🔐 AIOXY FOUNDER ACCESS</h1>
            <p style="font-size: 1.2rem; margin: 1rem 0;">Professional Sustainability Calculator</p>
            
            <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 10px; margin: 1.5rem 0;">
                <h3>👑 FOUNDER ACCESS</h3>
                <p>Unlimited usage • Full features • Priority support</p>
                <input type="password" id="founderPassword" class="access-input" placeholder="Enter founder password" 
                       onkeypress="if(event.key=='Enter') checkAccess()">
                <button class="founder-btn" onclick="checkAccess()">
                    🔓 UNLOCK UNLIMITED ACCESS
                </button>
            </div>
            
            <div style="background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 10px; margin: 1.5rem 0;">
                <h3>🚀 PUBLIC DEMO</h3>
                <p>2 free uses • Experience full features • Contact for partnership</p>
                <button class="public-btn" onclick="usePublicAccess()">
                    TRY PUBLIC DEMO (2 uses)
                </button>
            </div>
            
            <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 1rem;">
                Founders: Use password | Public: Limited demo | Contact: partnerships@aioxy.com
            </p>
        </div>
    </div>

    <!-- CALCULATOR CONTENT (HIDDEN UNTIL ACCESS GRANTED) -->
    <div id="calculatorContent" style="display:none;">
        <!-- Usage Counter Display -->
        <div class="usage-counter" id="usage-counter">Loading...</div>

        <div class="header">
            <h1>🌿 AIOXY Fashion Footprint Calculator <span class="master-badge">v2.0 PROTECTED</span></h1>
            <p>Master Dataset Integrated • 20+ Sustainable Materials • Enhanced Storytelling</p>
        </div>

        <div class="container">
            <div class="card">
                <h2>Product Details</h2>
                
                <div class="input-section">
                    <input type="text" id="product-name" placeholder="Product Name (e.g., Neverfull MM Bag)" value="Innovative Mycelium Handbag">
                    <select id="product-country">
                        <option value="global">Global Average</option>
                        <option value="Germany">Germany</option>
                        <option value="France" selected>France</option>
                        <option value="UK">UK</option>
                        <option value="US">US</option>
                        <option value="China">China</option>
                        <option value="Japan">Japan</option>
                    </select>

                    <h3>Materials <span class="master-badge">20+ OPTIONS</span></h3>
                    <div id="materials-container"></div>
                    <button onclick="addMaterial()">+ Add Material</button>

                    <h3>Manufacturing Energy</h3>
                    <div class="input-row">
                        <input type="number" id="energy-amount" placeholder="kWh" step="0.1" value="2.5">
                        <select id="energy-type">
                            <option value="grid">Grid Electricity</option>
                            <option value="solar">Solar</option>
                            <option value="wind">Wind</option>
                            <option value="hydro">Hydro</option>
                            <option value="biomass">Biomass</option>
                            <option value="geothermal">Geothermal</option>
                        </select>
                    </div>

                    <h3>CO₂ Benchmark</h3>
                    <div class="input-row">
                        <input type="number" id="benchmark" placeholder="Benchmark CO₂e (kg)" step="0.01" value="6.00">
                        <span>vs. market average</span>
                    </div>

                    <h3>Transport <span class="master-badge">NEW MODES</span></h3>
                    <div id="transport-container"></div>
                    <button onclick="addTransport()">+ Add Transport Route</button>
                </div>
                
                <button onclick="calculatePCF()" class="calculate-btn">Generate Sustainability Passport</button>
            </div>

            <div class="card">
                <h2>Impact Story Builder</h2>
                <div class="story-section">
                    <div class="story-heading">
                        <span>📖</span>
                        <h3>Why Storytelling Matters</h3>
                    </div>
                    <p>Consumers don't buy carbon data—they buy stories. They buy trust. They buy positive impact.</p>
                    <p>With new EU Green Claims Directive, verified storytelling isn't optional—it's your competitive advantage.</p>
                </div>
                
                <div class="story-section">
                    <div class="story-heading">
                        <span>💡</span>
                        <h3>How It Works</h3>
                    </div>
                    <p>1. Enter your product materials and manufacturing details</p>
                    <p>2. We calculate verified CO₂ and water footprints using regulatory databases</p>
                    <p>3. Generate a compelling sustainability story with QR code verification</p>
                    <p>4. Share your verified impact with customers and regulators</p>
                </div>
                
                <div class="story-section">
                    <div class="story-heading">
                        <span>🚀</span>
                        <h3>Business Impact</h3>
                    </div>
                    <p>• <strong>28% higher conversion</strong> for products with verified claims (McKinsey 2023)</p>
                    <p>• <strong>10-30% price premium</strong> for verified sustainable products</p>
                    <p>• <strong>Zero greenwashing risk</strong> with regulator-ready data</p>
                    <p>• <strong>QR-powered transparency</strong> that builds lasting consumer trust</p>
                </div>
            </div>
        </div>

        <!-- Usage Limit Message (Hidden by default) -->
        <div id="usage-limit-message"></div>

        <div id="results">
            <h2>🌱 Your Sustainability Passport</h2>
            <div id="result-summary"></div>
            
            <div class="impact-story">
                <div class="impact-value" id="impactCo2">0.00 kg CO₂e</div>
                <div class="impact-label">Carbon Emissions Saved vs Industry Average</div>
                <p id="impactAnalogy">Your positive impact story will appear here</p>
            </div>
            
            <div class="footprint-comparison">
                <div class="comparison-card">
                    <h4>Your Product</h4>
                    <div class="comparison-value your-value" id="your-co2">0.00 kg</div>
                    <div>CO₂ Footprint</div>
                </div>
                <div class="comparison-card">
                    <h4>Industry Average</h4>
                    <div class="comparison-value avg-value" id="avg-co2">0.00 kg</div>
                    <div>CO₂ Footprint</div>
                </div>
            </div>
            
            <div id="chart-container">
                <canvas id="chart"></canvas>
            </div>
            
            <div id="qrcode-container">
                <h3>📱 Digital Product Passport</h3>
                <p>Scan to verify sustainability claims</p>
                <div id="qrcode"></div>
                <a id="downloadQR" download="aioxy-sustainability-passport.png" style="display:none;">Download QR Code</a>
                <div id="qr-error" class="error-message" style="display:none;"></div>
            </div>
            
            <div class="export-buttons">
                <button onclick="saveAsPDF()">📄 Save as PDF Report</button>
                <button onclick="copyResults()">📋 Copy Sustainability Story</button>
                <button id="share">🐦 Share on X</button>
            </div>
        </div>
    </div>

    <script>
        // ================== ACCESS CONTROL SYSTEM ==================
        const FOUNDER_PASSWORD = "AIOXY2024"; // OUR PASSWORD
        const FOUNDER_EMAILS = ['pariyartulasi766@gmail.com', 'tulasipariyar120@gmail.com'];
        const PUBLIC_USAGE_LIMIT = 2;
        
        let isFounder = false;
        let publicUsageCount = 0;
        
        // Check existing access on page load
        function checkExistingAccess() {
            const founderAccess = localStorage.getItem('aioxy_founder_access');
            const publicAccess = localStorage.getItem('aioxy_public_access');
            
            if (founderAccess === 'true') {
                isFounder = true;
                showCalculator();
                console.log("👑 Founder access restored");
                return true;
            }
            
            if (publicAccess === 'true') {
                isFounder = false;
                publicUsageCount = parseInt(localStorage.getItem('aioxy_public_usage') || '0');
                showCalculator();
                console.log("🚀 Public access restored - Usage: " + publicUsageCount);
                return true;
            }
            
            return false;
        }
        
        function checkAccess() {
            const password = document.getElementById('founderPassword').value;
            if (password === FOUNDER_PASSWORD) {
                // FOUNDER ACCESS GRANTED
                isFounder = true;
                localStorage.setItem('aioxy_founder_access', 'true');
                localStorage.setItem('aioxy_founder_email', FOUNDER_EMAILS[0]);
                showCalculator();
                alert('✅ FOUNDER ACCESS GRANTED!\nUnlimited usage activated for: ' + FOUNDER_EMAILS[0]);
            } else {
                alert('❌ Invalid password. Please try again or use public demo.');
                document.getElementById('founderPassword').value = '';
                document.getElementById('founderPassword').focus();
            }
        }
        
        function usePublicAccess() {
            // PUBLIC ACCESS - LIMITED
            isFounder = false;
            localStorage.setItem('aioxy_public_access', 'true');
            publicUsageCount = 0;
            localStorage.setItem('aioxy_public_usage', '0');
            showCalculator();
            alert('🔐 PUBLIC DEMO ACCESS\nYou have ' + PUBLIC_USAGE_LIMIT + ' free passport generations.\nContact partnerships@aioxy.com for unlimited access!');
        }
        
        function showCalculator() {
            document.getElementById('accessPrompt').style.display = 'none';
            document.getElementById('calculatorContent').style.display = 'block';
            updateUsageDisplay();
            initializeCalculator();
        }
        
        function updateUsageDisplay() {
            const counter = document.getElementById('usage-counter');
            if (counter) {
                if (isFounder) {
                    counter.innerHTML = '👑 FOUNDER: UNLIMITED ACCESS';
                    counter.style.background = '#d4af37'; // Gold color
                } else {
                    counter.innerHTML = `🚀 PUBLIC: ${publicUsageCount}/${PUBLIC_USAGE_LIMIT} USES`;
                    counter.style.background = (publicUsageCount >= PUBLIC_USAGE_LIMIT) ? '#dc3545' : '#2e8b57';
                }
            }
        }
        
        // ================== USAGE LIMIT SYSTEM ==================
        function checkUsageLimit() {
            if (isFounder) {
                console.log("👑 Founder access - unlimited usage");
                return true;
            }
            
            console.log(`📊 Public usage: ${publicUsageCount}/${PUBLIC_USAGE_LIMIT}`);
            if (publicUsageCount >= PUBLIC_USAGE_LIMIT) {
                showLimitMessage();
                return false;
            }
            
            return true;
        }
        
        function incrementUsage() {
            if (!isFounder) {
                publicUsageCount++;
                localStorage.setItem('aioxy_public_usage', publicUsageCount.toString());
                updateUsageDisplay();
                console.log(`➕ Public usage incremented to: ${publicUsageCount}`);
            }
        }
        
        function showLimitMessage() {
            document.getElementById('results').style.display = 'none';
            
            const limitMessage = document.getElementById('usage-limit-message');
            limitMessage.innerHTML = `
                <div style="background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%); color: white; padding: 2rem; border-radius: 12px; text-align: center;">
                    <h2>🚀 Ready for Unlimited Access?</h2>
                    <p style="font-size: 1.2rem;">You've experienced AIOXY with ${PUBLIC_USAGE_LIMIT} free passports!</p>
                    
                    <div style="background: rgba(255,255,255,0.2); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0;">
                        <h3>💼 Partnership Benefits:</h3>
                        <ul style="text-align: left; display: inline-block; margin: 0 auto;">
                            <li>✅ Unlimited passport generation</li>
                            <li>✅ White-label branding</li>
                            <li>✅ API access & integration</li>
                            <li>✅ Management dashboard</li>
                            <li>✅ Priority support</li>
                        </ul>
                    </div>
                    
                    <p style="font-size: 1.1rem; font-weight: 600;">
                        Contact: <strong>pariyartulasi766@gmail.com</strong>
                    </p>
                    
                    <button onclick="resetPublicAccess()" style="margin-top: 1rem; padding: 10px 20px; background: white; color: #ff6b6b; border: none; border-radius: 5px; cursor: pointer;">
                        🔄 Try Another Demo
                    </button>
                </div>
            `;
            limitMessage.style.display = 'block';
        }
        
        function resetPublicAccess() {
            publicUsageCount = 0;
            localStorage.setItem('aioxy_public_usage', '0');
            document.getElementById('usage-limit-message').style.display = 'none';
            updateUsageDisplay();
            alert('Demo reset! You have ' + PUBLIC_USAGE_LIMIT + ' uses available.');
        }

        // ================== EXISTING CALCULATOR CODE ==================
        const PCFFactors = {
          materials: {
            'plastic-virgin': { co2: { 'global': 2.7 }, water: 234, story: "Virgin plastic from fossil fuels", certifications: [] },
            'plastic-recycled': { co2: { 'global': 0.5 }, water: 56, story: "Recycled plastic diverting waste", certifications: ['recycled'] },
            'leather': { co2: { 'global': 10.0 }, water: 17093, story: "Traditional leather", certifications: [] },
            'vegan-leather': { co2: { 'global': 3.2 }, water: 250, story: "Plant-based leather alternative", certifications: ['vegan'] },
            'mycelium-leather': { co2: { 'global': 1.2 }, water: 100, story: "Futuristic leather from fungi", certifications: ['vegan', 'innovation'] },
            'cotton': { co2: { 'global': 3.6 }, water: 8920, story: "Organic cotton", certifications: ['organic'] },
            'hemp': { co2: { 'global': 1.5 }, water: 300, story: "Low-input regenerative fiber", certifications: ['organic', 'vegan'] }
          },
          energy: {
            'grid': { 'global': 0.475 }, 'solar': { 'global': 0.045 }, 'wind': { 'global': 0.015 }
          },
          transport: {
            'road': { 'global': 0.120 }, 'air': { 'global': 0.570 }, 'sea': { 'global': 0.015 }
          }
        };

        const co2Analogies = [
            { threshold: 0.5, text: "Like charging your smartphone for 6 months!" },
            { threshold: 1.0, text: "Equivalent to driving 4 fewer miles in a car!" },
            { threshold: 5.0, text: "Like planting 1 tree for 10 years!" }
        ];

        let currentQRCode = null;

        function initializeCalculator() {
            addMaterial();
            addTransport();
            
            // Set default values
            document.getElementById('product-name').value = "Innovative Mycelium Handbag";
            document.getElementById('product-country').value = "France";
            document.getElementById('energy-amount').value = "2.5";
            document.getElementById('energy-type').value = "solar";
            document.getElementById('benchmark').value = "6.00";
            
            console.log("🚀 AIOXY Calculator INITIALIZED");
            console.log("👑 Founder Mode:", isFounder);
            console.log("📊 Public Usage:", publicUsageCount + "/" + PUBLIC_USAGE_LIMIT);
        }

        function addMaterial() {
          const container = document.getElementById('materials-container');
          const newRow = document.createElement('div');
          newRow.className = 'input-row';
          newRow.innerHTML = `
            <select class="material-type">
              <option value="plastic-virgin">Virgin Plastic</option>
              <option value="plastic-recycled">Recycled Plastic</option>
              <option value="leather">Leather</option>
              <option value="vegan-leather">Vegan Leather</option>
              <option value="mycelium-leather" selected>Mycelium Leather</option>
              <option value="cotton">Cotton</option>
              <option value="hemp">Hemp</option>
            </select>
            <input type="number" class="material-weight" placeholder="kg" step="0.01" value="0.8">
            <input type="number" class="material-water" placeholder="Actual water (L)" step="1" value="100">
            <button class="remove-btn" onclick="this.parentElement.remove()">×</button>
          `;
          container.appendChild(newRow);
        }

        function addTransport() {
          const container = document.getElementById('transport-container');
          const newRow = document.createElement('div');
          newRow.className = 'input-row';
          newRow.innerHTML = `
            <select class="transport-mode">
              <option value="road">Road Freight</option>
              <option value="air">Air Freight</option>
              <option value="sea" selected>Sea Freight</option>
            </select>
            <input type="number" class="transport-distance" placeholder="km" step="1" value="800">
            <input type="number" class="transport-weight" placeholder="kg" step="0.01" value="1.2">
            <button class="remove-btn" onclick="this.parentElement.remove()">×</button>
          `;
          container.appendChild(newRow);
        }

        function calculatePCF() {
          console.log("🔍 Checking usage limit...");
          
          // 🔒 USAGE LIMIT CHECK
          if (!checkUsageLimit()) {
              console.log("❌ LIMIT REACHED - Blocking calculation");
              return;
          }
          
          console.log("✅ Within usage limit - Proceeding with calculation");
          
          const country = document.getElementById('product-country').value;
          
          // Calculation logic
          let materialCO2 = 0;
          let totalWaterUsed = 0;
          document.querySelectorAll('#materials-container .input-row').forEach(row => {
            const type = row.querySelector('.material-type').value;
            const weight = parseFloat(row.querySelector('.material-weight').value) || 0;
            const waterUsed = parseFloat(row.querySelector('.material-water').value) || 0;
            const co2Factor = PCFFactors.materials[type].co2[country] || PCFFactors.materials[type].co2['global'];
            
            materialCO2 += weight * co2Factor;
            totalWaterUsed += waterUsed;
          });

          const energyType = document.getElementById('energy-type').value;
          const energyAmount = parseFloat(document.getElementById('energy-amount').value) || 0;
          const energyFactor = PCFFactors.energy[energyType][country] || PCFFactors.energy[energyType]['global'];
          const energyCO2 = energyAmount * energyFactor;

          let transportCO2 = 0;
          document.querySelectorAll('#transport-container .input-row').forEach(row => {
            const mode = row.querySelector('.transport-mode').value;
            const distance = parseFloat(row.querySelector('.transport-distance').value) || 0;
            const weight = parseFloat(row.querySelector('.transport-weight').value) || 0;
            const factor = PCFFactors.transport[mode][country] || PCFFactors.transport[mode]['global'];
            transportCO2 += (weight * distance * factor) / 1000;
          });

          const totalCO2 = materialCO2 + energyCO2 + transportCO2;
          const benchmark = parseFloat(document.getElementById('benchmark').value) || 6.0;
          const savedCO2 = benchmark - totalCO2;

          // 🔒 INCREMENT USAGE COUNTER
          incrementUsage();

          showResults(totalCO2, savedCO2, benchmark);
        }

        function showResults(totalCO2, savedCO2, benchmark) {
          document.getElementById('your-co2').textContent = `${totalCO2.toFixed(2)} kg`;
          document.getElementById('avg-co2').textContent = `${benchmark.toFixed(2)} kg`;
          document.getElementById('impactCo2').textContent = `${savedCO2.toFixed(2)} kg CO₂e`;

          let co2Analogy = "This is a climate-positive choice!";
          for (let i = co2Analogies.length - 1; i >= 0; i--) {
              if (savedCO2 >= co2Analogies[i].threshold) {
                  co2Analogy = co2Analogies[i].text;
                  break;
              }
          }
          document.getElementById('impactAnalogy').textContent = co2Analogy;

          document.getElementById('result-summary').innerHTML = `
            <h3>${document.getElementById('product-name').value || 'Product'}</h3>
            <p>Total CO₂ Footprint: <strong>${totalCO2.toFixed(2)} kg</strong></p>
            ${savedCO2 > 0 ? `<p class="savings">♻️ CO₂ Saved: ${savedCO2.toFixed(2)} kg vs. ${benchmark.toFixed(2)} kg benchmark</p>` : ''}
            
            <div class="story-section">
                <div class="story-heading">
                    <span>🌍</span>
                    <h3>Your Sustainability Story</h3>
                </div>
                <p>This product represents a conscious choice for our planet.</p>
                <p>Your decision saves <strong>${savedCO2.toFixed(2)} kg of CO₂</strong> compared to conventional alternatives—${co2Analogy.toLowerCase()}</p>
            </div>
          `;

          const ctx = document.getElementById('chart').getContext('2d');
          if (window.myChart) window.myChart.destroy();
          
          window.myChart = new Chart(ctx, {
            type: 'pie',
            data: {
              labels: ['Materials', 'Manufacturing', 'Transport'],
              datasets: [{
                data: [totalCO2 * 0.6, totalCO2 * 0.3, totalCO2 * 0.1],
                backgroundColor: ['#2e8b57', '#3a86ff', '#ff9f1c']
              }]
            }
          });

          generateQRCode(totalCO2);
          document.getElementById('results').style.display = 'block';
        }

        function generateQRCode(totalCO2) {
          const qrElement = document.getElementById('qrcode');
          qrElement.innerHTML = '';
          
          const productName = document.getElementById('product-name').value || 'Product';
          const qrText = `AIOXY PASSPORT|${productName}|CO2:${totalCO2.toFixed(2)}kg|Verified:${new Date().toISOString().split('T')[0]}`;

          try {
            currentQRCode = new QRCode(qrElement, {
              text: qrText,
              width: 200, height: 200,
              colorDark: "#2e8b57", colorLight: "#ffffff"
            });
          } catch (e) {
            console.error("QR generation failed:", e);
          }
        }

        function saveAsPDF() { alert("PDF export coming soon!"); }
        function copyResults() { 
            navigator.clipboard.writeText(document.getElementById('result-summary').innerText).then(() => {
                alert("Sustainability Passport copied to clipboard!");
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkExistingAccess()) {
                // Show access prompt if no existing access
                document.getElementById('accessPrompt').style.display = 'flex';
            }
        });
    </script>
</body>
    </html>
