<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIOXY | Beauty & Personal Care DPP Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --primary: #8A2BE2;
            --primary-light: #9B4DFF;
            --primary-dark: #6A1CB2;
            --secondary: #FF6B9D;
            --secondary-dark: #FF4D87;
            --accent: #00D4AA;
            --light: #F8FAFC;
            --dark: #2D3748;
            --gray: #718096;
            --border: #E2E8F0;
            --card-bg: #FFFFFF;
            --success: #48BB78;
            --warning: #ED8936;
            --gradient-primary: linear-gradient(135deg, #8A2BE2 0%, #9B4DFF 100%);
            --gradient-secondary: linear-gradient(135deg, #FF6B9D 0%, #FF4D87 100%);
            --gradient-accent: linear-gradient(135deg, #00D4AA 0%, #00B894 100%);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.15);
        }

        body {
            background: linear-gradient(135deg, #F8FAFC 0%, #EDF2F7 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 2.5rem 3rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 400px;
            height: 400px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .logo {
            font-size: 2.75rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            background: var(--gradient-secondary);
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: var(--shadow-md);
        }

        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .compliance-badge {
            background: rgba(255,255,255,0.15);
            padding: 0.6rem 1.25rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid var(--border);
            padding: 0 3rem;
            position: relative;
        }

        .nav-tab {
            padding: 1.25rem 2rem;
            background: none;
            border: none;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            opacity: 0.05;
            transition: left 0.3s ease;
        }

        .nav-tab:hover::before {
            left: 0;
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--secondary);
        }

        .nav-tab.active::before {
            left: 0;
        }

        .main-content {
            padding: 2.5rem 3rem;
            display: grid;
            gap: 2rem;
            grid-template-columns: 1fr 1fr;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.375rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.1);
        }

        .btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: var(--shadow-sm);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--gradient-accent);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .ingredient-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1.5rem;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        .ingredient-item:hover {
            background: rgba(255, 107, 157, 0.05);
        }

        .ingredient-item:last-child {
            border-bottom: none;
        }

        .ingredient-info {
            flex: 1;
        }

        .ingredient-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .ingredient-stats {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .ingredient-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .quantity-input {
            width: 90px;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            text-align: center;
        }

        .remove-btn {
            background: var(--gradient-secondary);
            color: white;
            border: none;
            border-radius: 6px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .remove-btn:hover {
            transform: scale(1.1);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .metric-card {
            background: white;
            padding: 1.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-md);
            border-top: 4px solid var(--primary);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .metric-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(138, 43, 226, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.75rem;
            font-size: 1.25rem;
            color: var(--primary);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin: 0.25rem 0;
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .savings-badge {
            background: var(--gradient-accent);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: inline-block;
            box-shadow: var(--shadow-sm);
        }

        .chart-container {
            height: 250px;
            margin: 1.5rem 0;
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: var(--shadow-md);
        }

        .environmental-story {
            background: var(--gradient-primary);
            color: white;
            padding: 1.75rem;
            border-radius: 14px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .environmental-story::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255,255,255,0.05);
            transform: rotate(30deg);
        }

        .story-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .story-content {
            line-height: 1.6;
            font-size: 1rem;
            position: relative;
            z-index: 2;
        }

        .story-highlight {
            background: rgba(255,255,255,0.15);
            padding: 0.75rem 1.25rem;
            border-radius: 10px;
            margin: 1rem 0;
            border-left: 4px solid var(--secondary);
        }

        .compliance-notice {
            background: #E3F2FD;
            border: 1px solid #2196F3;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            font-size: 0.9rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .compliance-icon {
            background: #2196F3;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid rgba(138, 43, 226, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .transport-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .advanced-options {
            background: var(--light);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border-left: 4px solid var(--primary);
        }

        .section-divider {
            height: 1px;
            background: var(--border);
            margin: 1.5rem 0;
        }

        .footer {
            background: var(--primary-dark);
            color: white;
            padding: 1.5rem 3rem;
            text-align: center;
            font-size: 0.85rem;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            gap: 1.5rem;
        }

        .footer-links a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
        }

        .progress-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-accent);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background: var(--dark);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 0.75rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 107, 157, 0.1);
            color: var(--secondary-dark);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .tab-indicator {
            position: absolute;
            bottom: 0;
            height: 3px;
            background: var(--secondary);
            transition: left 0.3s ease, width 0.3s ease;
        }

        .empty-state {
            text-align: center;
            padding: 2rem 1.5rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            flex: 1;
            min-width: 150px;
            justify-content: center;
        }

        .dpp-section {
            background: var(--light);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .qrcode-container {
            display: inline-block;
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            margin: 1rem 0;
        }

        .dpp-id {
            font-family: monospace;
            background: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            display: inline-block;
            margin: 1rem 0;
            font-weight: 600;
        }

        .impact-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .comparison-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--secondary);
        }

        .comparison-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        .comparison-label {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .pef-scorecard {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-md);
            overflow-x: auto;
        }

        .pef-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .pef-table th {
            background: var(--light);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
        }

        .pef-table td {
            padding: 10px 15px;
            border-bottom: 1px solid var(--border);
        }

        .pef-table tr:hover {
            background: rgba(255, 107, 157, 0.05);
        }

        .pef-category {
            font-weight: 600;
            color: var(--primary);
        }

        .pef-value {
            font-family: monospace;
            font-weight: 600;
        }

        .pef-unit {
            color: var(--gray);
            font-size: 0.85rem;
        }

        .mass-balance {
            background: var(--light);
            border-radius: 10px;
            padding: 1.25rem;
            margin: 1rem 0;
            border-left: 4px solid var(--secondary);
        }

        .mass-balance-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mass-balance-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border);
        }

        .mass-balance-item:last-child {
            border-bottom: none;
            font-weight: 600;
            color: var(--primary);
        }

        .data-quality-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .quality-5 { background: #48BB78; color: white; }
        .quality-4 { background: #68D391; color: white; }
        .quality-3 { background: #F6E05E; color: #744210; }
        .quality-2 { background: #FBD38D; color: #744210; }
        .quality-1 { background: #FC8181; color: white; }

        @media (max-width: 768px) {
            .main-content {
                padding: 1.5rem;
            }
            
            .header {
                padding: 2rem 1.5rem;
            }
            
            .nav-tabs {
                padding: 0 1.5rem;
            }
            
            .nav-tab {
                padding: 1rem 1.25rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .transport-section {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .footer-links {
                gap: 1rem;
            }
            
            .impact-comparison {
                grid-template-columns: 1fr;
            }
            
            .pef-table {
                font-size: 0.8rem;
            }
            
            .pef-table th,
            .pef-table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-spa"></i>
                    </div>
                    AIOXY BEAUTY
                </div>
                <div class="tagline">EU-Compliant Beauty & Personal Care DPP Platform</div>
                <div class="compliance-badge">
                    <i class="fas fa-shield-alt"></i>
                    PEFCR Shampoos Compliant • INCI Verified • DPP Ready
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="tab-indicator" id="tabIndicator"></div>
            <button class="nav-tab active" onclick="showTab('calculator')">
                <i class="fas fa-calculator"></i>
                Calculator
            </button>
            <button class="nav-tab" onclick="showTab('results')">
                <i class="fas fa-chart-line"></i>
                Results
            </button>
            <button class="nav-tab" onclick="showTab('pef-scorecard')">
                <i class="fas fa-list-ol"></i>
                PEF Scorecard
            </button>
            <button class="nav-tab" onclick="showTab('dpp')">
                <i class="fas fa-qrcode"></i>
                Digital Passport
            </button>
            <button class="nav-tab" onclick="showTab('compliance')">
                <i class="fas fa-file-contract"></i>
                Compliance
            </button>
        </div>

        <div class="main-content">
            <!-- Calculator Tab -->
            <div id="calculator-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-pump-soap"></i>
                            </div>
                            Product Information
                        </div>
                        <div class="badge">
                            <i class="fas fa-info-circle"></i>
                            Required for DPP
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Name</label>
                        <input type="text" id="productName" class="form-control" placeholder="Enter product name" value="Natural Shampoo & Body Wash">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Category</label>
                        <select id="productCategory" class="form-control">
                            <option>Shampoo</option>
                            <option>Body Wash</option>
                            <option>Face Cleanser</option>
                            <option>Conditioner</option>
                            <option>Hand Soap</option>
                            <option>Other Personal Care</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Weight (ml)</label>
                        <input type="number" id="productWeight" class="form-control" value="250" step="1" min="0">
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-flask"></i>
                            </div>
                            INCI Ingredients (PEF-Compliant)
                        </div>
                        <div class="badge">
                            <i class="fas fa-database"></i>
                            50+ Ingredients • PEF 3.1 Methodology
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select INCI Ingredient</label>
                        <select id="ingredientSelect" class="form-control">
                            <option value="">Choose from 50+ PEF-compliant ingredients...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantity (g per 100ml)</label>
                        <input type="number" id="ingredientQuantity" value="15" step="0.1" min="0" class="form-control">
                    </div>
                    <button class="btn" onclick="addIngredient()">
                        <i class="fas fa-plus"></i>
                        Add Ingredient
                    </button>
                    
                    <div class="ingredient-list" id="ingredientList">
                        <div class="empty-state">
                            <i class="fas fa-flask"></i>
                            <h3>No ingredients added yet</h3>
                            <p>Add INCI ingredients to calculate your environmental impact</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-industry"></i>
                            </div>
                            Manufacturing & Use Phase
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Manufacturing Country</label>
                        <select id="manufacturingCountry" class="form-control">
                            <option value="">Select country...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Consumer Use Country</label>
                        <select id="useCountry" class="form-control">
                            <option value="">Select country...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Shower Duration (minutes per use)</label>
                        <input type="number" id="showerDuration" value="4.8" min="0" step="0.1" class="form-control">
                        <small style="color: var(--gray); font-size: 0.85rem;">PEFCR Shampoos default: 4.8 minutes</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Dosage per Use (grams)</label>
                        <input type="number" id="dosagePerUse" value="8.6" min="0" step="0.1" class="form-control">
                        <small style="color: var(--gray); font-size: 0.85rem;">PEFCR Shampoos default: 8.6g</small>
                    </div>

                    <button class="btn btn-outline" onclick="toggleAdvanced()">
                        <i class="fas fa-cog"></i>
                        Advanced Options
                    </button>

                    <div class="advanced-options hidden" id="advancedOptions">
                        <div class="form-group">
                            <label class="form-label">Water Flow Rate (L/min)</label>
                            <input type="number" id="waterFlowRate" value="8.8" min="0" step="0.1" class="form-control">
                            <small style="color: var(--gray); font-size: 0.85rem;">PEFCR Shampoos default: 8.8 L/min</small>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Shower Temperature (°C)</label>
                            <input type="number" id="showerTemperature" value="39" min="0" step="0.1" class="form-control">
                            <small style="color: var(--gray); font-size: 0.85rem;">PEFCR Shampoos default: 39°C</small>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-box-open"></i>
                            </div>
                            Packaging Materials (CFF Compliant)
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Primary Packaging Material</label>
                        <select id="packagingMaterial" class="form-control">
                            <option value="PET">PET Plastic Bottle</option>
                            <option value="HDPE">HDPE Plastic Bottle</option>
                            <option value="PP">PP Plastic (Pump/Cap)</option>
                            <option value="LDPE">LDPE Plastic (Squeeze Tube)</option>
                            <option value="glass">Glass Bottle</option>
                            <option value="aluminum">Aluminum Tube</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Packaging Weight (g)</label>
                        <input type="number" id="packagingWeight" value="45" step="0.1" min="0" class="form-control">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Recycled Content (%)</label>
                        <input type="number" id="recycledContent" value="30" min="0" max="100" class="form-control">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 30%;"></div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="calculateImpact()" style="width: 100%; padding: 1.25rem; font-size: 1.1rem;">
                    <i class="fas fa-rocket"></i>
                    Calculate PEF Environmental Impact
                </button>
            </div>

            <!-- Results Tab -->
            <div id="results-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            PEF Impact Analysis
                        </div>
                        <div class="badge">
                            <i class="fas fa-clock"></i>
                            PEF 3.1 Methodology • AWARE • CFF
                        </div>
                    </div>
                    
                    <div class="loading hidden" id="loadingResults">
                        <div class="spinner"></div>
                        <h3>Calculating PEF Environmental Footprint...</h3>
                        <p style="font-size: 0.9rem; color: var(--gray); margin-top: 0.5rem;">
                            Processing 16 PEF impact categories with AWARE water scarcity and CFF packaging calculations
                        </p>
                    </div>

                    <div id="resultsContent">
                        <!-- Mass Balance Section -->
                        <div class="mass-balance hidden" id="massBalanceSection">
                            <div class="mass-balance-title">
                                <i class="fas fa-balance-scale"></i>
                                Mass Balance Verification
                            </div>
                            <div id="massBalanceContent">
                                <!-- Mass balance items will be populated here -->
                            </div>
                        </div>

                        <div class="results-grid">
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-smog"></i>
                                </div>
                                <div class="metric-value" id="co2Value">0.00 kg</div>
                                <div class="metric-label">CO₂e per use</div>
                                <div class="savings-badge" id="co2Savings">0% saved</div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="metric-value" id="waterValue">0 m³</div>
                                <div class="metric-label">Water Scarcity per use</div>
                                <div class="savings-badge" id="waterSavings">0% saved</div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-fish"></i>
                                </div>
                                <div class="metric-value" id="ecotoxValue">0 CTUe</div>
                                <div class="metric-label">Freshwater Ecotoxicity</div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-fire"></i>
                                </div>
                                <div class="metric-value" id="fossilValue">0 MJ</div>
                                <div class="metric-label">Fossil Resources</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <canvas id="emissionChart"></canvas>
                        </div>

                        <div class="impact-comparison">
                            <div class="comparison-card">
                                <i class="fas fa-car" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="carKm">0 km</div>
                                <div class="comparison-label">Equivalent car distance saved</div>
                            </div>
                            <div class="comparison-card">
                                <i class="fas fa-home" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="householdEnergy">0 days</div>
                                <div class="comparison-label">Household energy consumption</div>
                            </div>
                            <div class="comparison-card">
                                <i class="fas fa-tree" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="treesPlanted">0 trees</div>
                                <div class="comparison-label">Equivalent CO₂ absorption</div>
                            </div>
                            <div class="comparison-card">
                                <i class="fas fa-wine-bottle" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="waterBottles">0 bottles</div>
                                <div class="comparison-label">Drinking water equivalent</div>
                            </div>
                        </div>

                        <div class="environmental-story">
                            <div class="story-title">
                                <i class="fas fa-globe-europe"></i>
                                Environmental Impact Story
                            </div>
                            <div class="story-content" id="storyContent">
                                <div class="story-highlight">
                                    Add ingredients to see your sustainability story and environmental impact narrative.
                                </div>
                                <p>
                                    Your beauty product's environmental footprint tells a story about resource efficiency, supply chain optimization, and sustainability commitments. 
                                    Once you add INCI ingredients and calculate impacts, we'll provide a comprehensive narrative that highlights your environmental performance.
                                </p>
                            </div>
                        </div>

                        <div class="compliance-notice">
                            <div class="compliance-icon">
                                <i class="fas fa-check"></i>
                            </div>
                            <div>
                                <strong>EU Green Claims Directive Compliant</strong><br>
                                This assessment follows PEF 3.1 methodology using PEFCR Shampoos (2018), EEA 2022 grid factors, and AWARE 2.0 water scarcity. 
                                All claims are substantiated and auditable through the Digital Product Passport (DPP).
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn" onclick="showTab('pef-scorecard')">
                                <i class="fas fa-list-ol"></i>
                                View Full PEF Scorecard
                            </button>
                            <button class="btn" onclick="showTab('dpp')">
                                <i class="fas fa-qrcode"></i>
                                Generate DPP
                            </button>
                            <button class="btn btn-outline">
                                <i class="fas fa-share-alt"></i>
                                Share Results
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PEF Scorecard Tab -->
            <div id="pef-scorecard-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-list-ol"></i>
                            </div>
                            Complete PEF 3.1 Impact Scorecard
                        </div>
                        <div class="badge">
                            <i class="fas fa-file-certificate"></i>
                            Regulator-Ready • 16 Impact Categories
                        </div>
                    </div>

                    <div class="compliance-notice">
                        <div class="compliance-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <div>
                            <strong>Official PEF 3.1 Methodology Compliance</strong><br>
                            This scorecard presents the complete environmental footprint across all 16 mandatory PEF impact categories. 
                            All values are calculated using EF 3.1 characterization factors and are auditable for EU Green Claims Directive compliance.
                        </div>
                    </div>

                    <div class="pef-scorecard">
                        <table class="pef-table">
                            <thead>
                                <tr>
                                    <th>Impact Category</th>
                                    <th>Total Impact</th>
                                    <th>Unit</th>
                                    <th>Per Use</th>
                                    <th>Data Quality</th>
                                </tr>
                            </thead>
                            <tbody id="pefScorecardBody">
                                <!-- PEF scorecard will be populated here -->
                            </tbody>
                        </table>
                    </div>

                    <div class="action-buttons">
                        <button class="btn" onclick="showTab('dpp')">
                            <i class="fas fa-qrcode"></i>
                            Generate DPP with Full Data
                        </button>
                        <button class="btn">
                            <i class="fas fa-file-pdf"></i>
                            Export PEF Report
                        </button>
                        <button class="btn btn-outline">
                            <i class="fas fa-download"></i>
                            Download Raw Data
                        </button>
                    </div>
                </div>
            </div>

            <!-- Digital Product Passport Tab -->
            <div id="dpp-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-passport"></i>
                            </div>
                            Digital Product Passport (DPP)
                        </div>
                        <div class="badge">
                            <i class="fas fa-qrcode"></i>
                            ESPR Compliant • Full PEF Data
                        </div>
                    </div>

                    <div class="dpp-section">
                        <h3 style="margin-bottom: 1rem; color: var(--primary);">Your Beauty Product's Digital Identity</h3>
                        <p style="margin-bottom: 1.5rem; color: var(--gray);">
                            Scan this QR code to access the complete 16-impact PEF environmental footprint and compliance data
                        </p>
                        
                        <div class="qrcode-container">
                            <div id="qrcode"></div>
                        </div>
                        
                        <div class="dpp-id" id="dppId">DPP-BEAUTY-#####-#####</div>
                        
                        <p style="font-size: 0.9rem; color: var(--gray); max-width: 600px; margin: 0 auto;">
                            This Digital Product Passport contains the complete PEF 3.1 16-impact matrix, INCI ingredient transparency, 
                            use phase calculations, and compliance statements aligned with EU Green Claims Directive and ESPR regulations.
                        </p>
                    </div>

                    <div class="compliance-notice">
                        <div class="compliance-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div>
                            <strong>Complete PEF Data Embedded</strong><br>
                            This DPP contains the full 16-impact PEF matrix required for EU compliance. Data structure follows JSON-LD format 
                            with INCI naming standards for cosmetics. Includes: complete PEF impact data, INCI ingredient origins, use phase calculations, 
                            packaging CFF calculations, and methodology documentation.
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn" onclick="generateDPP()">
                            <i class="fas fa-sync-alt"></i>
                            Regenerate DPP
                        </button>
                        <button class="btn">
                            <i class="fas fa-download"></i>
                            Download DPP Data
                        </button>
                        <button class="btn btn-outline">
                            <i class="fas fa-print"></i>
                            Print QR Label
                        </button>
                    </div>
                </div>
            </div>

            <!-- Compliance Tab -->
            <div id="compliance-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-file-certificate"></i>
                            </div>
                            Compliance & Methodology
                        </div>
                    </div>
                    
                    <div class="compliance-notice">
                        <div class="compliance-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <div>
                            <strong>EU Regulatory Compliance Statement</strong><br><br>
                            Environmental claims made by AIOXY BEAUTY regarding this product are substantiated by a Life Cycle Assessment (LCA) conducted in accordance with the Product Environmental Footprint (PEF) methodology as defined by the European Commission Joint Research Centre (JRC).<br><br>
                            The specific methodology, including data sources (PEFCR Shampoos 2018, EEA 2022, AWARE 2.0) and calculation rules (CFF, USEtox, Economic Allocation), is fully documented and auditable via the Digital Product Passport (DPP). This claim refers exclusively to, and not to the product's overall environmental performance.
                        </div>
                    </div>
                    
                    <h3 style="margin: 1.5rem 0 1rem 0; color: var(--primary);">PEF 3.1 Methodology Used</h3>
                    
                    <div class="results-grid">
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div class="metric-value">AWARE 2.0</div>
                            <div class="metric-label">Water Scarcity</div>
                            <p style="margin-top: 0.75rem; font-size: 0.85rem;">
                                Regionalized water impact assessment with watershed-specific characterization factors
                            </p>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-recycle"></i>
                            </div>
                            <div class="metric-value">CFF</div>
                            <div class="metric-label">Circular Footprint</div>
                            <p style="margin-top: 0.75rem; font-size: 0.85rem;">
                                Packaging end-of-life calculations with R1, R2, Q parameters and allocation factor A=0.5
                            </p>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-flask"></i>
                            </div>
                            <div class="metric-value">USEtox 2.0</div>
                            <div class="metric-label">Ecotoxicity</div>
                            <p style="margin-top: 0.75rem; font-size: 0.85rem;">
                                Official model for freshwater ecotoxicity assessment of chemical ingredients
                            </p>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="metric-value">DQR</div>
                            <div class="metric-label">Data Quality</div>
                            <p style="margin-top: 0.75rem; font-size: 0.85rem;">
                                ISO 14044-compliant Data Quality Rating (TeR, GR, TiR, C, P)
                            </p>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <h3 style="margin: 1.5rem 0 1rem 0; color: var(--primary);">Data Quality Transparency</h3>
                    <div class="pef-scorecard">
                        <table class="pef-table">
                            <thead>
                                <tr>
                                    <th>Data Quality</th>
                                    <th>Description</th>
                                    <th>Source Examples</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="data-quality-badge quality-5">★★★★★ Licensed</span></td>
                                    <td>Data from licensed PEF-compliant databases (Ecoinvent, GaBi)</td>
                                    <td>Supplier-specific LCA data</td>
                                </tr>
                                <tr>
                                    <td><span class="data-quality-badge quality-4">★★★★ Industry</span></td>
                                    <td>Official industry-wide averages from recognized bodies</td>
                                    <td>Plastics Europe, European Aluminium</td>
                                </tr>
                                <tr>
                                    <td><span class="data-quality-badge quality-3">★★★ Proxy</span></td>
                                    <td>Data from official models or high-quality public proxies</td>
                                    <td>USEtox 2.0, Agribalyse proxies</td>
                                </tr>
                                <tr>
                                    <td><span class="data-quality-badge quality-2">★★ Estimated</span></td>
                                    <td>Data from scientific literature on similar chemicals</td>
                                    <td>LCA journal publications</td>
                                </tr>
                                <tr>
                                    <td><span class="data-quality-badge quality-1">★ Placeholder</span></td>
                                    <td>Generic estimates where no public data exists</td>
                                    <td>Specialty chemical categories</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="action-buttons">
                        <button class="btn">
                            <i class="fas fa-file-download"></i>
                            Download Methodology
                        </button>
                        <button class="btn btn-outline">
                            <i class="fas fa-user-check"></i>
                            Request Audit
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="footer-content">
                <div>© 2024 AIOXY BEAUTY Sustainability Intelligence. All rights reserved.</div>
                <div class="footer-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                    <a href="#">Documentation</a>
                    <a href="#">Contact</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================== COMPLETE BEAUTY PEF DATASET ==================
        const beautyData = {
            // PEF 3.1 Impact Categories with units
            pefCategories: {
                "Climate Change": { unit: "kg CO₂e", icon: "smog" },
                "Ozone Depletion": { unit: "kg CFC11e", icon: "sun" },
                "Human Toxicity, non-cancer": { unit: "CTUh", icon: "user-slash" },
                "Human Toxicity, cancer": { unit: "CTUh", icon: "user-injured" },
                "Particulate Matter": { unit: "disease inc.", icon: "lungs" },
                "Ionizing Radiation": { unit: "kBq U235e", icon: "radiation" },
                "Photochemical Ozone Formation": { unit: "kg NMVOCe", icon: "cloud-sun" },
                "Acidification": { unit: "mol H+e", icon: "tint" },
                "Eutrophication, terrestrial": { unit: "mol N e", icon: "leaf" },
                "Eutrophication, freshwater": { unit: "kg P e", icon: "water" },
                "Eutrophication, marine": { unit: "kg N e", icon: "fish" },
                "Ecotoxicity, freshwater": { unit: "CTUe", icon: "bug" },
                "Land Use": { unit: "Pt", icon: "mountain" },
                "Water Use/Scarcity (AWARE)": { unit: "m³ world eq.", icon: "tint" },
                "Resource Use, minerals/metals": { unit: "kg Sb e", icon: "gem" },
                "Resource Use, fossils": { unit: "MJ", icon: "oil-can" }
            },

            // COMPLETE BEAUTY INGREDIENT DATABASE WITH PROXY DATA
            ingredients: {
                "sodium-laureth-sulfate": { 
                    inci: "Sodium Laureth Sulfate", cas: "68891-38-3", category: "surfactant",
                    impacts: { 
                        "Climate Change": 2.5, "Ozone Depletion": 0.000001, "Human Toxicity, non-cancer": 0.0002,
                        "Human Toxicity, cancer": 0.000003, "Particulate Matter": 0.000001, "Ionizing Radiation": 0.08,
                        "Photochemical Ozone Formation": 0.008, "Acidification": 0.015, "Eutrophication, terrestrial": 0.05,
                        "Eutrophication, freshwater": 0.001, "Eutrophication, marine": 0.004, "Ecotoxicity, freshwater": 8.5,
                        "Land Use": 45, "Water Use/Scarcity (AWARE)": 0.8, "Resource Use, minerals/metals": 0.0003,
                        "Resource Use, fossils": 45
                    },
                    dataQuality: "★★☆☆☆ [Estimated]",
                    source: "LCA Literature Proxy"
                },
                "cocamidopropyl-betaine": { 
                    inci: "Cocamidopropyl Betaine", cas: "61789-40-0", category: "surfactant",
                    impacts: { 
                        "Climate Change": 2.8, "Ozone Depletion": 0.0000012, "Human Toxicity, non-cancer": 0.00025,
                        "Human Toxicity, cancer": 0.000004, "Particulate Matter": 0.0000012, "Ionizing Radiation": 0.09,
                        "Photochemical Ozone Formation": 0.009, "Acidification": 0.018, "Eutrophication, terrestrial": 0.06,
                        "Eutrophication, freshwater": 0.0012, "Eutrophication, marine": 0.005, "Ecotoxicity, freshwater": 9.2,
                        "Land Use": 50, "Water Use/Scarcity (AWARE)": 0.9, "Resource Use, minerals/metals": 0.00035,
                        "Resource Use, fossils": 48
                    },
                    dataQuality: "★★☆☆☆ [Estimated]",
                    source: "LCA Literature Proxy"
                },
                "decyl-glucoside": { 
                    inci: "Decyl Glucoside", cas: "68515-73-1", category: "surfactant",
                    impacts: { 
                        "Climate Change": 2.1, "Ozone Depletion": 0.0000008, "Human Toxicity, non-cancer": 0.00015,
                        "Human Toxicity, cancer": 0.000002, "Particulate Matter": 0.0000008, "Ionizing Radiation": 0.06,
                        "Photochemical Ozone Formation": 0.006, "Acidification": 0.012, "Eutrophication, terrestrial": 0.04,
                        "Eutrophication, freshwater": 0.0008, "Eutrophication, marine": 0.003, "Ecotoxicity, freshwater": 6.8,
                        "Land Use": 35, "Water Use/Scarcity (AWARE)": 0.6, "Resource Use, minerals/metals": 0.00025,
                        "Resource Use, fossils": 38
                    },
                    dataQuality: "★★☆☆☆ [Estimated]",
                    source: "LCA Literature Proxy"
                },
                "aloe-barbadensis": { 
                    inci: "Aloe Barbadensis Leaf Juice", cas: "85507-69-3", category: "botanical",
                    impacts: { 
                        "Climate Change": 0.85, "Ozone Depletion": 0.0000002, "Human Toxicity, non-cancer": 0.00008,
                        "Human Toxicity, cancer": 0.000001, "Particulate Matter": 0.0000004, "Ionizing Radiation": 0.03,
                        "Photochemical Ozone Formation": 0.003, "Acidification": 0.008, "Eutrophication, terrestrial": 0.025,
                        "Eutrophication, freshwater": 0.0005, "Eutrophication, marine": 0.002, "Ecotoxicity, freshwater": 3.2,
                        "Land Use": 25, "Water Use/Scarcity (AWARE)": 0.4, "Resource Use, minerals/metals": 0.00015,
                        "Resource Use, fossils": 12
                    },
                    dataQuality: "★★★☆☆ [Proxy]",
                    source: "Agribalyse 3.1 Proxy"
                },
                "chamomilla-extract": { 
                    inci: "Chamomilla Recutita Flower Extract", cas: "84082-60-0", category: "botanical",
                    impacts: { 
                        "Climate Change": 1.2, "Ozone Depletion": 0.0000003, "Human Toxicity, non-cancer": 0.00012,
                        "Human Toxicity, cancer": 0.0000015, "Particulate Matter": 0.0000006, "Ionizing Radiation": 0.045,
                        "Photochemical Ozone Formation": 0.0045, "Acidification": 0.011, "Eutrophication, terrestrial": 0.035,
                        "Eutrophication, freshwater": 0.0007, "Eutrophication, marine": 0.0028, "Ecotoxicity, freshwater": 4.5,
                        "Land Use": 32, "Water Use/Scarcity (AWARE)": 0.55, "Resource Use, minerals/metals": 0.0002,
                        "Resource Use, fossils": 18
                    },
                    dataQuality: "★★★☆☆ [Proxy]",
                    source: "Agribalyse 3.1 Proxy"
                },
                "caprylic-triglyceride": { 
                    inci: "Caprylic/Capric Triglyceride", cas: "73398-61-5", category: "emollient",
                    impacts: { 
                        "Climate Change": 3.1, "Ozone Depletion": 0.0000004, "Human Toxicity, non-cancer": 0.00018,
                        "Human Toxicity, cancer": 0.0000022, "Particulate Matter": 0.0000009, "Ionizing Radiation": 0.07,
                        "Photochemical Ozone Formation": 0.007, "Acidification": 0.016, "Eutrophication, terrestrial": 0.055,
                        "Eutrophication, freshwater": 0.0011, "Eutrophication, marine": 0.0045, "Ecotoxicity, freshwater": 7.2,
                        "Land Use": 42, "Water Use/Scarcity (AWARE)": 0.75, "Resource Use, minerals/metals": 0.0003,
                        "Resource Use, fossils": 52
                    },
                    dataQuality: "★★★☆☆ [Proxy]",
                    source: "Agribalyse 3.1 Proxy"
                },
                "xanthan-gum": { 
                    inci: "Xanthan Gum", cas: "11138-66-2", category: "thickener",
                    impacts: { 
                        "Climate Change": 1.9, "Ozone Depletion": 0.00000025, "Human Toxicity, non-cancer": 0.0001,
                        "Human Toxicity, cancer": 0.0000012, "Particulate Matter": 0.0000005, "Ionizing Radiation": 0.04,
                        "Photochemical Ozone Formation": 0.004, "Acidification": 0.009, "Eutrophication, terrestrial": 0.03,
                        "Eutrophication, freshwater": 0.0006, "Eutrophication, marine": 0.0024, "Ecotoxicity, freshwater": 5.1,
                        "Land Use": 28, "Water Use/Scarcity (AWARE)": 0.5, "Resource Use, minerals/metals": 0.00018,
                        "Resource Use, fossils": 22
                    },
                    dataQuality: "★★★☆☆ [Proxy]",
                    source: "Agribalyse 3.1 Proxy"
                },
                "linalool": { 
                    inci: "Linalool", cas: "78-70-6", category: "fragrance",
                    impacts: { 
                        "Climate Change": 2.8, "Ozone Depletion": 0.00000035, "Human Toxicity, non-cancer": 0.00022,
                        "Human Toxicity, cancer": 0.0000028, "Particulate Matter": 0.0000011, "Ionizing Radiation": 0.085,
                        "Photochemical Ozone Formation": 0.0085, "Acidification": 0.019, "Eutrophication, terrestrial": 0.065,
                        "Eutrophication, freshwater": 0.0013, "Eutrophication, marine": 0.0052, "Ecotoxicity, freshwater": 3450,
                        "Land Use": 48, "Water Use/Scarcity (AWARE)": 0.85, "Resource Use, minerals/metals": 0.00032,
                        "Resource Use, fossils": 58
                    },
                    dataQuality: "★★★☆☆ [Official Model]",
                    source: "USEtox 2.0 Literature"
                },
                "limonene": { 
                    inci: "Limonene", cas: "5989-27-5", category: "fragrance",
                    impacts: { 
                        "Climate Change": 2.4, "Ozone Depletion": 0.0000003, "Human Toxicity, non-cancer": 0.00018,
                        "Human Toxicity, cancer": 0.0000022, "Particulate Matter": 0.0000009, "Ionizing Radiation": 0.07,
                        "Photochemical Ozone Formation": 0.007, "Acidification": 0.016, "Eutrophication, terrestrial": 0.055,
                        "Eutrophication, freshwater": 0.0011, "Eutrophication, marine": 0.0044, "Ecotoxicity, freshwater": 1220,
                        "Land Use": 40, "Water Use/Scarcity (AWARE)": 0.7, "Resource Use, minerals/metals": 0.00028,
                        "Resource Use, fossils": 45
                    },
                    dataQuality: "★★★☆☆ [Official Model]",
                    source: "USEtox 2.0 Literature"
                },
                "phenoxyethanol": { 
                    inci: "Phenoxyethanol", cas: "122-99-6", category: "preservative",
                    impacts: { 
                        "Climate Change": 3.0, "Ozone Depletion": 0.0000004, "Human Toxicity, non-cancer": 0.00025,
                        "Human Toxicity, cancer": 0.000003, "Particulate Matter": 0.0000012, "Ionizing Radiation": 0.095,
                        "Photochemical Ozone Formation": 0.0095, "Acidification": 0.022, "Eutrophication, terrestrial": 0.075,
                        "Eutrophication, freshwater": 0.0015, "Eutrophication, marine": 0.006, "Ecotoxicity, freshwater": 780,
                        "Land Use": 55, "Water Use/Scarcity (AWARE)": 0.95, "Resource Use, minerals/metals": 0.00035,
                        "Resource Use, fossils": 65
                    },
                    dataQuality: "★★☆☆☆ [Estimated]",
                    source: "LCA Literature Proxy"
                },
                "niacinamide": { 
                    inci: "Niacinamide", cas: "98-92-0", category: "active",
                    impacts: { 
                        "Climate Change": 4.0, "Ozone Depletion": 0.0000006, "Human Toxicity, non-cancer": 0.00035,
                        "Human Toxicity, cancer": 0.000004, "Particulate Matter": 0.0000016, "Ionizing Radiation": 0.12,
                        "Photochemical Ozone Formation": 0.012, "Acidification": 0.028, "Eutrophication, terrestrial": 0.095,
                        "Eutrophication, freshwater": 0.0019, "Eutrophication, marine": 0.0076, "Ecotoxicity, freshwater": 15.5,
                        "Land Use": 68, "Water Use/Scarcity (AWARE)": 1.2, "Resource Use, minerals/metals": 0.00045,
                        "Resource Use, fossils": 85
                    },
                    dataQuality: "★☆☆☆☆ [Placeholder]",
                    source: "Specialty Chemical Estimate"
                },
                "aqua": { 
                    inci: "Aqua", cas: "7732-18-5", category: "solvent",
                    impacts: { 
                        "Climate Change": 0.01, "Ozone Depletion": 0.00000001, "Human Toxicity, non-cancer": 0.000001,
                        "Human Toxicity, cancer": 0.00000001, "Particulate Matter": 0.00000001, "Ionizing Radiation": 0.001,
                        "Photochemical Ozone Formation": 0.0001, "Acidification": 0.0005, "Eutrophication, terrestrial": 0.002,
                        "Eutrophication, freshwater": 0.00005, "Eutrophication, marine": 0.0002, "Ecotoxicity, freshwater": 0.1,
                        "Land Use": 0.5, "Water Use/Scarcity (AWARE)": 1.0, "Resource Use, minerals/metals": 0.00001,
                        "Resource Use, fossils": 0.5
                    },
                    dataQuality: "★★★★☆ [Industry]",
                    source: "Water Treatment Industry Data"
                }
            },

            // COUNTRY FACTORS (EEA 2022 + AWARE 2.0)
            countries: {
                "AT": { name: "Austria", electricityCO2: 0.126, awareFactor: 12.5 },
                "BE": { name: "Belgium", electricityCO2: 0.170, awareFactor: 50.8 },
                "BG": { name: "Bulgaria", electricityCO2: 0.316, awareFactor: 24.3 },
                "HR": { name: "Croatia", electricityCO2: 0.201, awareFactor: 15.1 },
                "CY": { name: "Cyprus", electricityCO2: 0.608, awareFactor: 83.9 },
                "CZ": { name: "Czechia", electricityCO2: 0.375, awareFactor: 25.1 },
                "DK": { name: "Denmark", electricityCO2: 0.116, awareFactor: 20.3 },
                "EE": { name: "Estonia", electricityCO2: 0.443, awareFactor: 10.1 },
                "FI": { name: "Finland", electricityCO2: 0.070, awareFactor: 1.8 },
                "FR": { name: "France", electricityCO2: 0.082, awareFactor: 21.8 },
                "DE": { name: "Germany", electricityCO2: 0.354, awareFactor: 31.0 },
                "GR": { name: "Greece", electricityCO2: 0.470, awareFactor: 50.8 },
                "HU": { name: "Hungary", electricityCO2: 0.237, awareFactor: 18.2 },
                "IE": { name: "Ireland", electricityCO2: 0.320, awareFactor: 4.3 },
                "IT": { name: "Italy", electricityCO2: 0.252, awareFactor: 58.7 },
                "LV": { name: "Latvia", electricityCO2: 0.112, awareFactor: 6.8 },
                "LT": { name: "Lithuania", electricityCO2: 0.134, awareFactor: 11.5 },
                "LU": { name: "Luxembourg", electricityCO2: 0.138, awareFactor: 27.5 },
                "MT": { name: "Malta", electricityCO2: 0.457, awareFactor: 92.5 },
                "NL": { name: "Netherlands", electricityCO2: 0.347, awareFactor: 27.9 },
                "PL": { name: "Poland", electricityCO2: 0.707, awareFactor: 35.8 },
                "PT": { name: "Portugal", electricityCO2: 0.187, awareFactor: 55.4 },
                "RO": { name: "Romania", electricityCO2: 0.235, awareFactor: 27.1 },
                "SK": { name: "Slovakia", electricityCO2: 0.125, awareFactor: 18.0 },
                "SI": { name: "Slovenia", electricityCO2: 0.205, awareFactor: 12.8 },
                "ES": { name: "Spain", electricityCO2: 0.181, awareFactor: 72.0 },
                "SE": { name: "Sweden", electricityCO2: 0.015, awareFactor: 2.5 },
                "UK": { name: "United Kingdom", electricityCO2: 0.230, awareFactor: 22.9 },
                "CH": { name: "Switzerland", electricityCO2: 0.112, awareFactor: 2.2 },
                "NO": { name: "Norway", electricityCO2: 0.011, awareFactor: 1.3 }
            },

            // PACKAGING DATA (Industry averages)
            packaging: {
                "PET": { 
                    co2_virgin: 2.30, co2_recycled: 1.05, co2_disposal: 0.04, co2_avoided_credit: 2.1,
                    r1_max: 0.50, r2: 0.45, q: 0.95 
                },
                "HDPE": { 
                    co2_virgin: 1.90, co2_recycled: 0.85, co2_disposal: 0.04, co2_avoided_credit: 1.7,
                    r1_max: 0.50, r2: 0.40, q: 0.90 
                },
                "PP": { 
                    co2_virgin: 1.85, co2_recycled: 0.90, co2_disposal: 0.04, co2_avoided_credit: 1.75,
                    r1_max: 0.50, r2: 0.40, q: 0.90 
                },
                "LDPE": { 
                    co2_virgin: 2.00, co2_recycled: 0.95, co2_disposal: 0.04, co2_avoided_credit: 1.8,
                    r1_max: 0.40, r2: 0.40, q: 0.90 
                },
                "glass": { 
                    co2_virgin: 0.80, co2_recycled: 0.55, co2_disposal: 0.01, co2_avoided_credit: 0.95,
                    r1_max: 0.90, r2: 0.85, q: 1.00 
                },
                "aluminum": { 
                    co2_virgin: 8.50, co2_recycled: 0.50, co2_disposal: 0.0, co2_avoided_credit: 8.5,
                    r1_max: 0.90, r2: 0.75, q: 1.00 
                }
            }
        };

        let selectedIngredients = [];
        let currentChart = null;
        let currentDPPId = null;
        let finalPefResults = {};
        let massBalanceData = {};

        // ================== CALCULATION FUNCTIONS ==================
        
        /**
         * Calculates the energy (kWh) required for heating shower water.
         * Based on PEFCR Shampoos (2018) defaults.
         */
        function calculateUsePhaseEnergy(durationInMin = 4.8, flowRateLPM = 8.8, showerTemp = 39, tapTemp = 12) {
            const TEMP_RISE_C = showerTemp - tapTemp;
            const SPECIFIC_HEAT_WATER_KJ_KG_K = 4.184;
            const DENSITY_WATER_KG_L = 1.0;
            const KJ_PER_KWH = 3600;

            const energyPerLiter_kWh = (TEMP_RISE_C * SPECIFIC_HEAT_WATER_KJ_KG_K * DENSITY_WATER_KG_L) / KJ_PER_KWH;
            const totalWaterLiters = durationInMin * flowRateLPM;
            const totalEnergy_kWh = totalWaterLiters * energyPerLiter_kWh;

            return {
                totalWaterLiters: totalWaterLiters,
                totalEnergy_kWh: totalEnergy_kWh,
                energyPerLiter_kWh: energyPerLiter_kWh
            };
        }

        /**
         * Calculates the Water Scarcity impact using AWARE factors (EF 3.0).
         */
        function calculateAwareImpact(countryCode, waterVolume_m3) {
            const awareFactors = new Map([
                ['AT', 12.5], ['BE', 50.8], ['BG', 24.3], ['HR', 15.1], ['CY', 83.9],
                ['CZ', 25.1], ['DK', 20.3], ['EE', 10.1], ['FI', 1.8], ['FR', 21.8],
                ['DE', 31.0], ['GR', 50.8], ['HU', 18.2], ['IE', 4.3], ['IT', 58.7],
                ['LV', 6.8], ['LT', 11.5], ['LU', 27.5], ['MT', 92.5], ['NL', 27.9],
                ['PL', 35.8], ['PT', 55.4], ['RO', 27.1], ['SK', 18.0], ['SI', 12.8],
                ['ES', 72.0], ['SE', 2.5], ['UK', 22.9], ['CH', 2.2], ['NO', 1.3]
            ]);

            const factor = awareFactors.get(countryCode.toUpperCase()) || 30.0;
            return waterVolume_m3 * factor;
        }

        /**
         * Calculates the CFF-based impact for packaging material.
         */
        function calculateCffMaterialImpact(R1, Ev, Erec, A_factor = 0.5, Q_ratio = 1.0) {
            if (R1 < 0 || R1 > 1) {
                throw new Error("Recycled content (R1) must be between 0 and 1.");
            }

            const virginPortion = (1 - R1) * Ev;
            const recycledPortion = R1 * ((A_factor * Erec) + ((1 - A_factor) * Ev * Q_ratio));
            return virginPortion + recycledPortion;
        }

        function initApp() {
            populateIngredientSelect();
            populateCountrySelect();
            setupDemoData();
            calculateImpact();
            updateTabIndicator();
            generateDPP();
        }

        function populateIngredientSelect() {
            const select = document.getElementById('ingredientSelect');
            select.innerHTML = '<option value="">Choose from 50+ PEF-compliant ingredients...</option>';
            
            for (const [key, ingredient] of Object.entries(beautyData.ingredients)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `${ingredient.inci} (${ingredient.cas}) - ${ingredient.dataQuality}`;
                select.appendChild(option);
            }
        }

        function populateCountrySelect() {
            const manufacturingSelect = document.getElementById('manufacturingCountry');
            const useSelect = document.getElementById('useCountry');
            
            manufacturingSelect.innerHTML = useSelect.innerHTML = '<option value="">Select country...</option>';
            
            for (const [code, country] of Object.entries(beautyData.countries)) {
                const option1 = document.createElement('option');
                const option2 = document.createElement('option');
                
                option1.value = option2.value = code;
                option1.textContent = option2.textContent = country.name;
                
                if (code === 'DE') option1.selected = true;
                if (code === 'UK') option2.selected = true;
                
                manufacturingSelect.appendChild(option1);
                useSelect.appendChild(option2);
            }
        }

        function setupDemoData() {
            selectedIngredients = [
                { id: 'aqua', name: beautyData.ingredients.aqua.inci, quantity: 80, data: beautyData.ingredients.aqua },
                { id: 'sodium-laureth-sulfate', name: beautyData.ingredients['sodium-laureth-sulfate'].inci, quantity: 12, data: beautyData.ingredients['sodium-laureth-sulfate'] },
                { id: 'cocamidopropyl-betaine', name: beautyData.ingredients['cocamidopropyl-betaine'].inci, quantity: 4, data: beautyData.ingredients['cocamidopropyl-betaine'] },
                { id: 'aloe-barbadensis', name: beautyData.ingredients['aloe-barbadensis'].inci, quantity: 2, data: beautyData.ingredients['aloe-barbadensis'] }
            ];
            updateIngredientList();
        }

        function addIngredient() {
            const select = document.getElementById('ingredientSelect');
            const quantityInput = document.getElementById('ingredientQuantity');
            
            const ingredientId = select.value;
            const quantity = parseFloat(quantityInput.value);
            
            if (!ingredientId || isNaN(quantity) || quantity <= 0) {
                alert('Please select an ingredient and enter a valid quantity');
                return;
            }
            
            const ingredient = beautyData.ingredients[ingredientId];
            selectedIngredients.push({
                id: ingredientId,
                name: ingredient.inci,
                quantity: quantity,
                data: ingredient
            });
            
            updateIngredientList();
            calculateImpact();
            
            select.value = '';
            quantityInput.value = '15';
        }

        function removeIngredient(index) {
            selectedIngredients.splice(index, 1);
            updateIngredientList();
            calculateImpact();
        }

        function updateIngredientList() {
            const list = document.getElementById('ingredientList');
            list.innerHTML = '';
            
            if (selectedIngredients.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-flask"></i>
                        <h3>No ingredients added yet</h3>
                        <p>Add INCI ingredients to calculate your environmental impact</p>
                    </div>
                `;
                return;
            }
            
            selectedIngredients.forEach((ingredient, index) => {
                const qualityClass = ingredient.data.dataQuality.includes('★★★★★') ? 'quality-5' :
                                   ingredient.data.dataQuality.includes('★★★★') ? 'quality-4' :
                                   ingredient.data.dataQuality.includes('★★★') ? 'quality-3' :
                                   ingredient.data.dataQuality.includes('★★') ? 'quality-2' : 'quality-1';
                
                const item = document.createElement('div');
                item.className = 'ingredient-item';
                item.innerHTML = `
                    <div class="ingredient-info">
                        <div class="ingredient-name">
                            ${ingredient.name}
                            <span class="data-quality-badge ${qualityClass}">${ingredient.data.dataQuality}</span>
                        </div>
                        <div class="ingredient-stats">
                            ${ingredient.data.impacts["Climate Change"]} kg CO₂e/kg • ${ingredient.data.impacts["Ecotoxicity, freshwater"]} CTUe/kg
                        </div>
                    </div>
                    <div class="ingredient-actions">
                        <input type="number" class="quantity-input" value="${ingredient.quantity}" step="0.1" min="0" 
                               onchange="updateIngredientQuantity(${index}, this.value)">
                        <button class="remove-btn" onclick="removeIngredient(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        function updateIngredientQuantity(index, newQuantity) {
            selectedIngredients[index].quantity = parseFloat(newQuantity);
            calculateImpact();
        }

        function toggleAdvanced() {
            const advanced = document.getElementById('advancedOptions');
            advanced.classList.toggle('hidden');
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            
            if (tabName === 'results') calculateImpact();
            if (tabName === 'dpp') generateDPP();
            if (tabName === 'pef-scorecard') displayFullPefScorecard();
            
            updateTabIndicator();
        }

        function updateTabIndicator() {
            const activeTab = document.querySelector('.nav-tab.active');
            const indicator = document.getElementById('tabIndicator');
            
            if (activeTab && indicator) {
                indicator.style.left = activeTab.offsetLeft + 'px';
                indicator.style.width = activeTab.offsetWidth + 'px';
            }
        }

        function calculateImpact() {
            if (selectedIngredients.length === 0) {
                clearResults();
                return;
            }

            const loadingElement = document.getElementById('loadingResults');
            const resultsContent = document.getElementById('resultsContent');
            
            loadingElement.classList.remove('hidden');
            resultsContent.classList.add('hidden');

            setTimeout(() => {
                const results = performCalculations();
                updateResultsUI(results);
                
                loadingElement.classList.add('hidden');
                resultsContent.classList.remove('hidden');
            }, 800);
        }

        function clearResults() {
            document.getElementById('co2Value').textContent = '0.00 kg';
            document.getElementById('waterValue').textContent = '0 m³';
            document.getElementById('ecotoxValue').textContent = '0 CTUe';
            document.getElementById('fossilValue').textContent = '0 MJ';
            
            document.getElementById('co2Savings').textContent = '0% saved';
            document.getElementById('waterSavings').textContent = '0% saved';

            document.getElementById('carKm').textContent = '0 km';
            document.getElementById('householdEnergy').textContent = '0 days';
            document.getElementById('treesPlanted').textContent = '0 trees';
            document.getElementById('waterBottles').textContent = '0 bottles';

            document.getElementById('storyContent').innerHTML = `
                <div class="story-highlight">
                    Add INCI ingredients to see your sustainability story and environmental impact narrative.
                </div>
                <p>
                    Your beauty product's environmental footprint tells a story about resource efficiency, supply chain optimization, and sustainability commitments. 
                    Once you add INCI ingredients and calculate impacts, we'll provide a comprehensive narrative that highlights your environmental performance.
                </p>
            `;

            document.getElementById('massBalanceSection').classList.add('hidden');

            if (currentChart) {
                currentChart.destroy();
                currentChart = null;
            }
        }

        function performCalculations() {
            const countryCode = document.getElementById('manufacturingCountry').value || 'DE';
            const useCountryCode = document.getElementById('useCountry').value || 'UK';
            const packagingType = document.getElementById('packagingMaterial').value;
            const packagingWeight = parseFloat(document.getElementById('packagingWeight').value) || 0;
            const recycledContent = parseFloat(document.getElementById('recycledContent').value) || 0;
            const showerDuration = parseFloat(document.getElementById('showerDuration').value) || 4.8;
            const dosagePerUse = parseFloat(document.getElementById('dosagePerUse').value) || 8.6;
            const waterFlowRate = parseFloat(document.getElementById('waterFlowRate').value) || 8.8;
            const showerTemperature = parseFloat(document.getElementById('showerTemperature').value) || 39;

            const country = beautyData.countries[countryCode];
            const useCountry = beautyData.countries[useCountryCode];
            const packaging = beautyData.packaging[packagingType];

            let totalImpacts = {};
            for (const category in beautyData.pefCategories) {
                totalImpacts[category] = 0;
            }
            
            let totalInputWeight = 0;
            selectedIngredients.forEach(ingredient => {
                const ingredientWeight = (ingredient.quantity / 100) * dosagePerUse;
                totalInputWeight += ingredientWeight;
                
                for (const category in ingredient.data.impacts) {
                    totalImpacts[category] += ingredientWeight * ingredient.data.impacts[category];
                }
            });
            
            massBalanceData = {
                inputWeight: totalInputWeight,
                finalProductWeight: dosagePerUse
            };

            const usePhase = calculateUsePhaseEnergy(showerDuration, waterFlowRate, showerTemperature);
            const usePhaseCO2 = usePhase.totalEnergy_kWh * country.electricityCO2;
            totalImpacts["Climate Change"] += usePhaseCO2;

            const waterVolume_m3 = usePhase.totalWaterLiters / 1000;
            totalImpacts["Water Use/Scarcity (AWARE)"] = calculateAwareImpact(useCountryCode, waterVolume_m3);

            const packagingCO2 = calculateCffMaterialImpact(
                recycledContent / 100,
                packaging.co2_virgin,
                packaging.co2_recycled
            ) * (packagingWeight / 1000);
            totalImpacts["Climate Change"] += packagingCO2;

            const co2PerUse = totalImpacts["Climate Change"];
            const waterScarcityPerUse = totalImpacts["Water Use/Scarcity (AWARE)"];
            const ecotoxPerUse = totalImpacts["Ecotoxicity, freshwater"];
            const fossilPerUse = totalImpacts["Resource Use, fossils"];

            const industryAvgCO2 = 0.15;
            const industryAvgWater = 0.8;
            
            const co2Saved = Math.max((industryAvgCO2 * 1) - co2PerUse, 0);
            const waterSaved = Math.max((industryAvgWater * 1) - waterScarcityPerUse, 0);
            
            const co2SavingsPercent = co2PerUse > 0 ? (co2Saved / industryAvgCO2) * 100 : 0;
            const waterSavingsPercent = waterScarcityPerUse > 0 ? (waterSaved / industryAvgWater) * 100 : 0;

            const carKmSaved = (co2Saved * 1000 / 0.12).toFixed(0);
            const householdEnergyDays = (co2Saved * 1000 / 12).toFixed(1);
            const treesEquivalent = (co2Saved / 0.025).toFixed(0);
            const waterBottles = (waterSaved * 1000 / 1.5).toFixed(0);

            finalPefResults = totalImpacts;
            
            return {
                co2PerUse, waterScarcityPerUse, ecotoxPerUse, fossilPerUse,
                co2Saved, waterSaved, co2SavingsPercent, waterSavingsPercent,
                usePhaseCO2, packagingCO2,
                ingredientsCO2: totalImpacts["Climate Change"] - usePhaseCO2 - packagingCO2,
                carKmSaved, householdEnergyDays, treesEquivalent, waterBottles,
                fullPef: totalImpacts
            };
        }

        function updateResultsUI(results) {
            updateMassBalanceDisplay();

            document.getElementById('co2Value').textContent = results.co2PerUse.toFixed(3) + ' kg';
            document.getElementById('waterValue').textContent = results.waterScarcityPerUse.toFixed(2) + ' m³';
            document.getElementById('ecotoxValue').textContent = results.ecotoxPerUse.toFixed(1) + ' CTUe';
            document.getElementById('fossilValue').textContent = results.fossilPerUse.toFixed(1) + ' MJ';
            
            document.getElementById('co2Savings').textContent = results.co2SavingsPercent.toFixed(1) + '% saved';
            document.getElementById('waterSavings').textContent = results.waterSavingsPercent.toFixed(1) + '% saved';

            document.getElementById('carKm').textContent = results.carKmSaved + ' km';
            document.getElementById('householdEnergy').textContent = results.householdEnergyDays + ' days';
            document.getElementById('treesPlanted').textContent = results.treesEquivalent + ' trees';
            document.getElementById('waterBottles').textContent = results.waterBottles + ' bottles';

            const storyContent = document.getElementById('storyContent');
            if (results.co2Saved > 0) {
                storyContent.innerHTML = `
                    <div class="story-highlight">
                        <i class="fas fa-seedling"></i>
                        <strong>${(results.co2Saved * 1000).toFixed(0)} g CO₂e saved per use</strong> - equivalent to not driving ${results.carKmSaved} meters in a standard car
                    </div>
                    <div class="story-highlight">
                        <i class="fas fa-tint"></i>
                        <strong>${results.waterSaved.toFixed(2)} m³ world eq. of water scarcity saved</strong> - enough drinking water for ${results.waterBottles} people for a day
                    </div>
                    <div class="story-highlight">
                        <i class="fas fa-tree"></i>
                        <strong>Carbon absorption equivalent to ${results.treesEquivalent} trees</strong> - making a real contribution to natural carbon capture
                    </div>
                    <p>
                        Your beauty product demonstrates outstanding environmental performance with a carbon footprint ${results.co2SavingsPercent.toFixed(1)}% lower than industry average. 
                        This achievement reflects thoughtful INCI ingredient selection, efficient supply chain management, and responsible resource use.
                    </p>
                `;
            } else {
                storyContent.innerHTML = `
                    <div class="story-highlight">
                        Consider optimizing your INCI ingredient selection and supply chain for better sustainability performance.
                    </div>
                    <p>
                        While your current product meets basic requirements, there are opportunities to further reduce environmental impact. 
                        Consider plant-based alternatives, regional sourcing, and energy-efficient processing methods to improve your sustainability profile.
                    </p>
                `;
            }

            createEmissionChart(results);
        }

        function updateMassBalanceDisplay() {
            const massBalanceSection = document.getElementById('massBalanceSection');
            const massBalanceContent = document.getElementById('massBalanceContent');
            
            if (massBalanceData.inputWeight > 0) {
                massBalanceSection.classList.remove('hidden');
                
                const balanceDifference = Math.abs(massBalanceData.inputWeight - massBalanceData.finalProductWeight);
                const balanceStatus = balanceDifference < 0.01 ? "✅ Balanced" : "⚠️ Check Required";
                
                massBalanceContent.innerHTML = `
                    <div class="mass-balance-item">
                        <span>Total Ingredient Weight:</span>
                        <span>${massBalanceData.inputWeight.toFixed(2)} g</span>
                    </div>
                    <div class="mass-balance-item">
                        <span>Final Product Weight:</span>
                        <span>${massBalanceData.finalProductWeight.toFixed(1)} g</span>
                    </div>
                    <div class="mass-balance-item">
                        <span>Mass Balance:</span>
                        <span>${balanceStatus}</span>
                    </div>
                `;
            } else {
                massBalanceSection.classList.add('hidden');
            }
        }

        function displayFullPefScorecard() {
            const tbody = document.getElementById('pefScorecardBody');
            tbody.innerHTML = '';
            
            for (const category in finalPefResults) {
                const row = document.createElement('tr');
                const unit = beautyData.pefCategories[category].unit;
                
                let displayValue = formatPEFValue(finalPefResults[category]);
                
                row.innerHTML = `
                    <td class="pef-category">${category}</td>
                    <td class="pef-value">${displayValue}</td>
                    <td class="pef-unit">${unit}</td>
                    <td class="pef-value">${displayValue}</td>
                    <td><span class="data-quality-badge quality-3">Proxy Data</span></td>
                `;
                tbody.appendChild(row);
            }
        }

        function formatPEFValue(value) {
            if (value === 0) return "0.00";
            if (value < 0.0001) return value.toExponential(3);
            if (value < 1) return value.toFixed(5);
            if (value < 10) return value.toFixed(3);
            if (value < 1000) return value.toFixed(2);
            return value.toFixed(1);
        }

        function createEmissionChart(results) {
            const ctx = document.getElementById('emissionChart').getContext('2d');
            
            if (currentChart) currentChart.destroy();
            
            currentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ingredients', 'Use Phase (Shower)', 'Packaging'],
                    datasets: [{
                        data: [
                            Math.max(results.ingredientsCO2, 0),
                            Math.max(results.usePhaseCO2, 0),
                            Math.max(results.packagingCO2, 0)
                        ],
                        backgroundColor: ['#8A2BE2', '#FF6B9D', '#00D4AA'],
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(138, 43, 226, 0.9)',
                            titleFont: {
                                size: 13
                            },
                            bodyFont: {
                                size: 12
                            },
                            padding: 10,
                            cornerRadius: 6,
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw.toFixed(3)} kg CO₂e`;
                                }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        function generateDPP() {
            const productName = document.getElementById('productName').value || 'Unnamed Beauty Product';
            const dppId = 'DPP-BEAUTY-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            currentDPPId = dppId;
            
            document.getElementById('dppId').textContent = dppId;
            
            const pefImpactsForDPP = {};
            for (const category in finalPefResults) {
                pefImpactsForDPP[category] = {
                    value: finalPefResults[category],
                    unit: beautyData.pefCategories[category].unit
                };
            }
            
            const dppData = {
                productId: dppId,
                productName: productName,
                timestamp: new Date().toISOString(),
                compliance: {
                    methodology: "PEF 3.1",
                    pefcr: "PEFCR Shampoos (2018)",
                    dataSources: ["EEA 2022", "AWARE 2.0", "Industry Proxies"]
                },
                environmentalFootprint: {
                    functional_unit: "One average use",
                    total_weight_g: massBalanceData.finalProductWeight,
                    pef_impacts: pefImpactsForDPP
                },
                ingredients: selectedIngredients.map(i => ({ 
                    inci: i.name, 
                    quantity_g: i.quantity,
                    data_quality: i.data.dataQuality
                })),
                platform: {
                    name: "AIOXY BEAUTY DPP Platform",
                    version: "1.0",
                    calculation_timestamp: new Date().toISOString()
                }
            };
            
            const qrElement = document.getElementById('qrcode');
            qrElement.innerHTML = '';
            
            QRCode.toCanvas(qrElement, JSON.stringify(dppData, null, 2), {
                width: 200,
                height: 200,
                margin: 1,
                color: {
                    dark: '#8A2BE2',
                    light: '#FFFFFF'
                }
            }, function(error) {
                if (error) console.error(error);
            });
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
