<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIOXY | EU-Compliant Sustainability Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --primary: #0A2540;
            --primary-light: #1A365D;
            --primary-dark: #061B2E;
            --secondary: #00D4AA;
            --secondary-dark: #00B894;
            --accent: #FF6B6B;
            --light: #F8FAFC;
            --dark: #2D3748;
            --gray: #718096;
            --border: #E2E8F0;
            --card-bg: #FFFFFF;
            --success: #48BB78;
            --warning: #ED8936;
            --gradient-primary: linear-gradient(135deg, #0A2540 0%, #1A365D 100%);
            --gradient-secondary: linear-gradient(135deg, #00D4AA 0%, #00B894 100%);
            --gradient-accent: linear-gradient(135deg, #FF6B6B 0%, #FF8E8E 100%);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 40px rgba(0,0,0,0.15);
        }

        body {
            background: linear-gradient(135deg, #F8FAFC 0%, #EDF2F7 100%);
            min-height: 100vh;
            color: var(--dark);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .header {
            background: var(--gradient-primary);
            color: white;
            padding: 2.5rem 3rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 400px;
            height: 400px;
            background: rgba(255,255,255,0.05);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .logo {
            font-size: 2.75rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            background: var(--gradient-secondary);
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            box-shadow: var(--shadow-md);
        }

        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .compliance-badge {
            background: rgba(255,255,255,0.15);
            padding: 0.6rem 1.25rem;
            border-radius: 50px;
            font-size: 0.875rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid var(--border);
            padding: 0 3rem;
            position: relative;
        }

        .nav-tab {
            padding: 1.25rem 2rem;
            background: none;
            border: none;
            font-weight: 600;
            color: var(--gray);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            overflow: hidden;
        }

        .nav-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--gradient-primary);
            opacity: 0.05;
            transition: left 0.3s ease;
        }

        .nav-tab:hover::before {
            left: 0;
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--secondary);
        }

        .nav-tab.active::before {
            left: 0;
        }

        .main-content {
            padding: 2.5rem 3rem;
            display: grid;
            gap: 2rem;
            grid-template-columns: 1fr 1fr;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.375rem;
            font-weight: 700;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.95rem;
        }

        .form-control {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background: white;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(10, 37, 64, 0.1);
        }

        .btn {
            background: var(--gradient-primary);
            color: white;
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: var(--shadow-sm);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--gradient-secondary);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .ingredient-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1.5rem;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        .ingredient-item:hover {
            background: rgba(0, 212, 170, 0.05);
        }

        .ingredient-item:last-child {
            border-bottom: none;
        }

        .ingredient-info {
            flex: 1;
        }

        .ingredient-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .ingredient-stats {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .ingredient-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .quantity-input {
            width: 90px;
            padding: 0.5rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            text-align: center;
        }

        .remove-btn {
            background: var(--gradient-accent);
            color: white;
            border: none;
            border-radius: 6px;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .remove-btn:hover {
            transform: scale(1.1);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .metric-card {
            background: white;
            padding: 1.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-md);
            border-top: 4px solid var(--primary);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .metric-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(10, 37, 64, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 0.75rem;
            font-size: 1.25rem;
            color: var(--primary);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin: 0.25rem 0;
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .savings-badge {
            background: var(--gradient-secondary);
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: inline-block;
            box-shadow: var(--shadow-sm);
        }

        .chart-container {
            height: 250px;
            margin: 1.5rem 0;
            background: white;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: var(--shadow-md);
        }

        .environmental-story {
            background: var(--gradient-primary);
            color: white;
            padding: 1.75rem;
            border-radius: 14px;
            margin: 1.5rem 0;
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .environmental-story::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: rgba(255,255,255,0.05);
            transform: rotate(30deg);
        }

        .story-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .story-content {
            line-height: 1.6;
            font-size: 1rem;
            position: relative;
            z-index: 2;
        }

        .story-highlight {
            background: rgba(255,255,255,0.15);
            padding: 0.75rem 1.25rem;
            border-radius: 10px;
            margin: 1rem 0;
            border-left: 4px solid var(--secondary);
        }

        .compliance-notice {
            background: #E3F2FD;
            border: 1px solid #2196F3;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1.5rem 0;
            font-size: 0.9rem;
            display: flex;
            align-items: flex-start;
            gap: 1rem;
        }

        .compliance-icon {
            background: #2196F3;
            color: white;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid rgba(10, 37, 64, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .transport-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .advanced-options {
            background: var(--light);
            border-radius: 10px;
            padding: 1.5rem;
            margin-top: 1.5rem;
            border-left: 4px solid var(--primary);
        }

        .section-divider {
            height: 1px;
            background: var(--border);
            margin: 1.5rem 0;
        }

        .footer {
            background: var(--primary-dark);
            color: white;
            padding: 1.5rem 3rem;
            text-align: center;
            font-size: 0.85rem;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .footer-links {
            display: flex;
            gap: 1.5rem;
        }

        .footer-links a {
            color: rgba(255,255,255,0.7);
            text-decoration: none;
            transition: color 0.3s;
        }

        .footer-links a:hover {
            color: white;
        }

        .progress-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            margin: 1rem 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-secondary);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background: var(--dark);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 0.75rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 212, 170, 0.1);
            color: var(--secondary-dark);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .tab-indicator {
            position: absolute;
            bottom: 0;
            height: 3px;
            background: var(--secondary);
            transition: left 0.3s ease, width 0.3s ease;
        }

        .empty-state {
            text-align: center;
            padding: 2rem 1.5rem;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .action-buttons .btn {
            flex: 1;
            min-width: 150px;
            justify-content: center;
        }

        .dpp-section {
            background: var(--light);
            border-radius: 12px;
            padding: 2rem;
            margin: 1.5rem 0;
            text-align: center;
        }

        .qrcode-container {
            display: inline-block;
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            margin: 1rem 0;
        }

        .dpp-id {
            font-family: monospace;
            background: var(--primary);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            display: inline-block;
            margin: 1rem 0;
            font-weight: 600;
        }

        .impact-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .comparison-card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--secondary);
        }

        .comparison-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        .comparison-label {
            font-size: 0.85rem;
            color: var(--gray);
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 1.5rem;
            }
            
            .header {
                padding: 2rem 1.5rem;
            }
            
            .nav-tabs {
                padding: 0 1.5rem;
            }
            
            .nav-tab {
                padding: 1rem 1.25rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .transport-section {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .footer-links {
                gap: 1rem;
            }
            
            .impact-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-leaf"></i>
                    </div>
                    AIOXY
                </div>
                <div class="tagline">EU-Compliant Sustainability Intelligence Platform</div>
                <div class="compliance-badge">
                    <i class="fas fa-shield-alt"></i>
                    EU Green Claims Directive Compliant • PEF Methodology • DPP Ready
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="tab-indicator" id="tabIndicator"></div>
            <button class="nav-tab active" onclick="showTab('calculator')">
                <i class="fas fa-calculator"></i>
                Calculator
            </button>
            <button class="nav-tab" onclick="showTab('results')">
                <i class="fas fa-chart-line"></i>
                Results
            </button>
            <button class="nav-tab" onclick="showTab('dpp')">
                <i class="fas fa-qrcode"></i>
                Digital Passport
            </button>
            <button class="nav-tab" onclick="showTab('compliance')">
                <i class="fas fa-file-contract"></i>
                Compliance
            </button>
        </div>

        <div class="main-content">
            <!-- Calculator Tab -->
            <div id="calculator-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-box"></i>
                            </div>
                            Product Information
                        </div>
                        <div class="badge">
                            <i class="fas fa-info-circle"></i>
                            Required for DPP
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Name</label>
                        <input type="text" id="productName" class="form-control" placeholder="Enter product name" value="Plant-Based Protein Burger">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Category</label>
                        <select id="productCategory" class="form-control">
                            <option>Food & Beverage</option>
                            <option>Personal Care</option>
                            <option>Household Products</option>
                            <option>Textiles</option>
                            <option>Electronics</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Weight (kg)</label>
                        <input type="number" id="productWeight" class="form-control" value="0.200" step="0.001" min="0">
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-apple-alt"></i>
                            </div>
                            Ingredients (PEF-Compliant)
                        </div>
                        <div class="badge">
                            <i class="fas fa-database"></i>
                            35+ Ingredients • PEF Methodology
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select Ingredient</label>
                        <select id="ingredientSelect" class="form-control">
                            <option value="">Choose from 35+ PEF-compliant ingredients...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantity (kg)</label>
                        <input type="number" id="ingredientQuantity" value="0.150" step="0.001" min="0" class="form-control">
                    </div>
                    <button class="btn" onclick="addIngredient()">
                        <i class="fas fa-plus"></i>
                        Add Ingredient
                    </button>
                    
                    <div class="ingredient-list" id="ingredientList">
                        <div class="empty-state">
                            <i class="fas fa-apple-alt"></i>
                            <h3>No ingredients added yet</h3>
                            <p>Add ingredients to calculate your environmental impact</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-industry"></i>
                            </div>
                            Manufacturing & Supply Chain
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Manufacturing Country</label>
                        <select id="manufacturingCountry" class="form-control">
                            <option value="">Select country...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Processing Method</label>
                        <select id="processingMethod" class="form-control">
                            <option value="none">No Additional Processing</option>
                            <option value="pasteurization">Pasteurization</option>
                            <option value="sterilization">Sterilization (UHT)</option>
                            <option value="baking">Baking</option>
                            <option value="frying">Frying</option>
                            <option value="freezing">Freezing (IQF)</option>
                            <option value="drying">Spray Drying</option>
                            <option value="milling">Milling</option>
                            <option value="mixing">Mixing/Blending</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Transportation</label>
                        <div class="transport-section">
                            <div>
                                <label class="form-label">Distance (km)</label>
                                <input type="number" id="transportDistance" value="300" min="0" class="form-control">
                            </div>
                            <div>
                                <label class="form-label">Transport Mode</label>
                                <select id="transportMode" class="form-control">
                                    <option value="road">Road Freight (HGV Diesel)</option>
                                    <option value="rail">Rail Freight (Electric)</option>
                                    <option value="sea">Sea Freight (Container)</option>
                                    <option value="air">Air Freight</option>
                                    <option value="lastmile">Last-mile Delivery</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button class="btn btn-outline" onclick="toggleAdvanced()">
                        <i class="fas fa-cog"></i>
                        Advanced Options
                    </button>

                    <div class="advanced-options hidden" id="advancedOptions">
                        <div class="form-group">
                            <label class="form-label">Refrigerated Transport</label>
                            <select id="refrigeratedTransport" class="form-control">
                                <option value="no">No Refrigeration</option>
                                <option value="yes">Refrigerated (+20-40% emissions)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Energy Source</label>
                            <select id="energySource" class="form-control">
                                <option value="grid">Grid Mix (Regional)</option>
                                <option value="renewable">Renewable Energy</option>
                                <option value="natural_gas">Natural Gas</option>
                                <option value="coal">Coal</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-box-open"></i>
                            </div>
                            Packaging Materials (CFF Compliant)
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Primary Packaging Material</label>
                        <select id="packagingMaterial" class="form-control">
                            <option value="cardboard">Cardboard (Coated)</option>
                            <option value="PET">PET Plastic</option>
                            <option value="HDPE">HDPE Plastic</option>
                            <option value="LDPE">LDPE Plastic</option>
                            <option value="PP">PP Plastic</option>
                            <option value="glass">Glass</option>
                            <option value="aluminum">Aluminum</option>
                            <option value="steel">Steel</option>
                            <option value="PLA">PLA Bioplastic</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Packaging Weight (kg)</label>
                        <input type="number" id="packagingWeight" value="0.050" step="0.001" min="0" class="form-control">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Recycled Content (%)</label>
                        <input type="number" id="recycledContent" value="30" min="0" max="100" class="form-control">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 30%;"></div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="calculateImpact()" style="width: 100%; padding: 1.25rem; font-size: 1.1rem;">
                    <i class="fas fa-rocket"></i>
                    Calculate PEF Environmental Impact
                </button>
            </div>

            <!-- Results Tab -->
            <div id="results-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            PEF Impact Analysis
                        </div>
                        <div class="badge">
                            <i class="fas fa-clock"></i>
                            PEF Methodology • AWARE • CFF
                        </div>
                    </div>
                    
                    <div class="loading hidden" id="loadingResults">
                        <div class="spinner"></div>
                        <h3>Calculating PEF Environmental Footprint...</h3>
                        <p style="font-size: 0.9rem; color: var(--gray); margin-top: 0.5rem;">
                            Processing 16 PEF impact categories with AWARE water scarcity and CFF packaging calculations
                        </p>
                    </div>

                    <div id="resultsContent">
                        <div class="results-grid">
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-smog"></i>
                                </div>
                                <div class="metric-value" id="co2Value">0.00 kg</div>
                                <div class="metric-label">CO₂e per kg</div>
                                <div class="savings-badge" id="co2Savings">0% saved</div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="metric-value" id="waterValue">0 L</div>
                                <div class="metric-label">Water per kg</div>
                                <div class="savings-badge" id="waterSavings">0% saved</div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-mountain"></i>
                                </div>
                                <div class="metric-value" id="landValue">0.00 Pt</div>
                                <div class="metric-label">Land Use per kg</div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-icon">
                                    <i class="fas fa-water"></i>
                                </div>
                                <div class="metric-value" id="waterScarcityValue">0.000</div>
                                <div class="metric-label">Water Scarcity (m³ eq)</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <canvas id="emissionChart"></canvas>
                        </div>

                        <div class="impact-comparison">
                            <div class="comparison-card">
                                <i class="fas fa-car" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="carKm">0 km</div>
                                <div class="comparison-label">Equivalent car distance saved</div>
                            </div>
                            <div class="comparison-card">
                                <i class="fas fa-home" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="householdEnergy">0 days</div>
                                <div class="comparison-label">Household energy consumption</div>
                            </div>
                            <div class="comparison-card">
                                <i class="fas fa-tree" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="treesPlanted">0 trees</div>
                                <div class="comparison-label">Equivalent CO₂ absorption</div>
                            </div>
                            <div class="comparison-card">
                                <i class="fas fa-wine-bottle" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="waterBottles">0 bottles</div>
                                <div class="comparison-label">Drinking water equivalent</div>
                            </div>
                        </div>

                        <div class="environmental-story">
                            <div class="story-title">
                                <i class="fas fa-globe-europe"></i>
                                Environmental Impact Story
                            </div>
                            <div class="story-content" id="storyContent">
                                <div class="story-highlight">
                                    Add ingredients to see your sustainability story and environmental impact narrative.
                                </div>
                                <p>
                                    Your product's environmental footprint tells a story about resource efficiency, supply chain optimization, and sustainability commitments. 
                                    Once you add ingredients and calculate impacts, we'll provide a comprehensive narrative that highlights your environmental performance.
                                </p>
                            </div>
                        </div>

                        <div class="compliance-notice">
                            <div class="compliance-icon">
                                <i class="fas fa-check"></i>
                            </div>
                            <div>
                                <strong>EU Green Claims Directive Compliant</strong><br>
                                This assessment follows PEF methodology using AGRIBALYSE 3.1, JRC EF 3.1, and AWARE 2.0 data. 
                                All claims are substantiated and auditable through the Digital Product Passport (DPP).
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button class="btn" onclick="showTab('dpp')">
                                <i class="fas fa-qrcode"></i>
                                Generate DPP
                            </button>
                            <button class="btn">
                                <i class="fas fa-file-pdf"></i>
                                Export PEF Report
                            </button>
                            <button class="btn btn-outline">
                                <i class="fas fa-share-alt"></i>
                                Share Results
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Digital Product Passport Tab -->
            <div id="dpp-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-passport"></i>
                            </div>
                            Digital Product Passport (DPP)
                        </div>
                        <div class="badge">
                            <i class="fas fa-qrcode"></i>
                            ESPR Compliant
                        </div>
                    </div>

                    <div class="dpp-section">
                        <h3 style="margin-bottom: 1rem; color: var(--primary);">Your Product's Digital Identity</h3>
                        <p style="margin-bottom: 1.5rem; color: var(--gray);">
                            Scan this QR code to access the complete environmental footprint and compliance data
                        </p>
                        
                        <div class="qrcode-container">
                            <div id="qrcode"></div>
                        </div>
                        
                        <div class="dpp-id" id="dppId">DPP-#####-#####</div>
                        
                        <p style="font-size: 0.9rem; color: var(--gray); max-width: 600px; margin: 0 auto;">
                            This Digital Product Passport contains verified PEF data, supply chain transparency information, 
                            and compliance statements aligned with EU Green Claims Directive and ESPR regulations.
                        </p>
                    </div>

                    <div class="compliance-notice">
                        <div class="compliance-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div>
                            <strong>DPP Data Structure</strong><br>
                            This passport uses JSON-LD format with GS1 standards for interoperability. 
                            Contains: PEF impact data, ingredient origins, processing methods, packaging CFF calculations, 
                            and social compliance indicators for CSRD reporting.
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn" onclick="generateDPP()">
                            <i class="fas fa-sync-alt"></i>
                            Regenerate DPP
                        </button>
                        <button class="btn">
                            <i class="fas fa-download"></i>
                            Download DPP Data
                        </button>
                        <button class="btn btn-outline">
                            <i class="fas fa-print"></i>
                            Print QR Label
                        </button>
                    </div>
                </div>
            </div>

            <!-- Compliance Tab -->
            <div id="compliance-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">
                                <i class="fas fa-file-certificate"></i>
                            </div>
                            Compliance & Methodology
                        </div>
                    </div>
                    
                    <div class="compliance-notice">
                        <div class="compliance-icon">
                            <i class="fas fa-gavel"></i>
                        </div>
                        <div>
                            <strong>EU Regulatory Compliance Statement</strong><br><br>
                            Environmental claims made by AIOXY regarding this product are substantiated by a Life Cycle Assessment (LCA) conducted in accordance with the Product Environmental Footprint (PEF) methodology as defined by the European Commission Joint Research Centre (JRC).<br><br>
                            The specific methodology, including data sources (AGRIBALYSE 3.1, JRC EF 3.1, GLEC v3.0) and calculation rules (CFF, AWARE, Economic Allocation), is fully documented and auditable via the Digital Product Passport (DPP). This claim refers exclusively to, and not to the product's overall environmental performance.
                        </div>
                    </div>
                    
                    <h3 style="margin: 1.5rem 0 1rem 0; color: var(--primary);">PEF Methodology Used</h3>
                    
                    <div class="results-grid">
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-tint"></i>
                            </div>
                            <div class="metric-value">AWARE 2.0</div>
                            <div class="metric-label">Water Scarcity</div>
                            <p style="margin-top: 0.75rem; font-size: 0.85rem;">
                                Regionalized water impact assessment with watershed-specific characterization factors
                            </p>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-recycle"></i>
                            </div>
                            <div class="metric-value">CFF</div>
                            <div class="metric-label">Circular Footprint</div>
                            <p style="margin-top: 0.75rem; font-size: 0.85rem;">
                                Packaging end-of-life calculations with R1, R2, Q parameters and allocation factor A=0.5
                            </p>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="metric-value">PEF</div>
                            <div class="metric-label">Allocation</div>
                            <p style="margin-top: 0.75rem; font-size: 0.85rem;">
                                PEF-compliant economic allocation hierarchy for co-products
                            </p>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="metric-value">DQR</div>
                            <div class="metric-label">Data Quality</div>
                            <p style="margin-top: 0.75rem; font-size: 0.85rem;">
                                ISO 14044-compliant Data Quality Rating (TeR, GR, TiR, C, P)
                            </p>
                        </div>
                    </div>

                    <div class="section-divider"></div>

                    <h3 style="margin: 1.5rem 0 1rem 0; color: var(--primary);">Data Sources & Verification</h3>
                    <ul style="line-height: 1.7; margin-left: 1.5rem;">
                        <li><strong>AGRIBALYSE 3.1</strong>: Comprehensive agricultural LCA database (PEF-compliant)</li>
                        <li><strong>JRC EF 3.1</strong>: European Commission's Environmental Footprint method</li>
                        <li><strong>GLEC v3.0</strong>: Global Logistics Emissions Council framework</li>
                        <li><strong>AWARE 2.0</strong>: UNEP/SETAC water scarcity method</li>
                        <li><strong>Ecoinvent 3.8</strong>: Background system data</li>
                        <li><strong>IEA 2023</strong>: Country-specific electricity emission factors</li>
                    </ul>

                    <div class="action-buttons">
                        <button class="btn">
                            <i class="fas fa-file-download"></i>
                            Download Methodology
                        </button>
                        <button class="btn btn-outline">
                            <i class="fas fa-user-check"></i>
                            Request Audit
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <div class="footer-content">
                <div>© 2024 AIOXY Sustainability Intelligence. All rights reserved.</div>
                <div class="footer-links">
                    <a href="#">Privacy Policy</a>
                    <a href="#">Terms of Service</a>
                    <a href="#">Documentation</a>
                    <a href="#">Contact</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================== COMPLETE PEF-COMPLIANT DATASET ==================
        const aioxyData = {
            // PEF-COMPLIANT INGREDIENTS (Based on Agribalyse 3.1 and Ecoinvent 3.8)
            ingredients: {
                "beef": { name: "Beef (EU Conventional)", co2: 32.5, waterScarcity: 8.5, landUse: 12000, fossil: 20.0, loss: 0.02 },
                "chicken": { name: "Chicken (EU Intensive)", co2: 3.5, waterScarcity: 1.8, landUse: 700, fossil: 10.0, loss: 0.01 },
                "pork": { name: "Pork (EU Intensive)", co2: 5.5, waterScarcity: 2.3, landUse: 800, fossil: 12.5, loss: 0.015 },
                "salmon": { name: "Salmon (Farmed, Norway)", co2: 6.5, waterScarcity: 1.0, landUse: 2000, fossil: 25.0, loss: 0.01 },
                "milk": { name: "Milk (Cow, EU Avg)", co2: 1.4, waterScarcity: 1.0, landUse: 800, fossil: 2.0, loss: 0.005 },
                "eggs": { name: "Eggs (Chicken, Barn)", co2: 2.5, waterScarcity: 1.4, landUse: 550, fossil: 7.5, loss: 0.005 },
                "wheat": { name: "Wheat (Grain, EU)", co2: 0.55, waterScarcity: 0.55, landUse: 200, fossil: 3.0, loss: 0.08 },
                "rice": { name: "Rice (Paddy, Global)", co2: 3.0, waterScarcity: 4.5, landUse: 275, fossil: 4.0, loss: 0.10 },
                "corn": { name: "Corn (Maize, EU)", co2: 0.45, waterScarcity: 0.35, landUse: 180, fossil: 2.5, loss: 0.06 },
                "oats": { name: "Oats (Grain, EU)", co2: 0.40, waterScarcity: 0.30, landUse: 150, fossil: 2.0, loss: 0.07 },
                "soybeans": { name: "Soybeans (EU)", co2: 0.8, waterScarcity: 0.85, landUse: 400, fossil: 3.3, loss: 0.04 },
                "peas": { name: "Peas (Dried, EU)", co2: 0.35, waterScarcity: 0.25, landUse: 120, fossil: 1.8, loss: 0.03 },
                "lentils": { name: "Lentils (Dried, Global)", co2: 0.7, waterScarcity: 0.45, landUse: 180, fossil: 2.2, loss: 0.03 },
                "chickpeas": { name: "Chickpeas (Dried, Global)", co2: 0.9, waterScarcity: 0.60, landUse: 220, fossil: 2.8, loss: 0.03 },
                "almonds": { name: "Almonds (Kernel, USA)", co2: 3.2, waterScarcity: 15.0, landUse: 500, fossil: 12.5, loss: 0.01 },
                "potatoes": { name: "Potatoes (Fresh, EU)", co2: 0.3, waterScarcity: 0.2, landUse: 60, fossil: 1.5, loss: 0.15 },
                "tomatoes": { name: "Tomatoes (Field, ES)", co2: 0.45, waterScarcity: 1.0, landUse: 45, fossil: 2.3, loss: 0.20 },
                "onions": { name: "Onions (Fresh, EU)", co2: 0.2, waterScarcity: 0.15, landUse: 35, fossil: 1.2, loss: 0.12 },
                "carrots": { name: "Carrots (Fresh, EU)", co2: 0.18, waterScarcity: 0.12, landUse: 30, fossil: 1.0, loss: 0.10 },
                "apples": { name: "Apples (Fresh, EU)", co2: 0.35, waterScarcity: 0.25, landUse: 55, fossil: 1.8, loss: 0.08 },
                "bananas": { name: "Bananas (Fresh, Import)", co2: 0.9, waterScarcity: 0.35, landUse: 120, fossil: 2.5, loss: 0.06 },
                "oranges": { name: "Oranges (Fresh, ES)", co2: 0.4, waterScarcity: 0.30, landUse: 70, fossil: 2.0, loss: 0.07 },
                "berries": { name: "Berries (Mixed, Fresh)", co2: 1.5, waterScarcity: 0.80, landUse: 150, fossil: 4.0, loss: 0.15 },
                "palm-oil": { name: "Palm Oil (RSPO Segregated)", co2: 2.2, waterScarcity: 1.2, landUse: 150, fossil: 10.0, loss: 0.02 },
                "olive-oil": { name: "Olive Oil (EVOO, ES)", co2: 2.8, waterScarcity: 4.5, landUse: 1250, fossil: 7.5, loss: 0.02 },
                "sunflower-oil": { name: "Sunflower Oil (EU)", co2: 1.8, waterScarcity: 0.95, landUse: 200, fossil: 5.5, loss: 0.02 },
                "sugar-cane": { name: "Sugar Cane (Raw)", co2: 0.6, waterScarcity: 2.5, landUse: 120, fossil: 3.5, loss: 0.08 },
                "sugar-beet": { name: "Sugar Beet (Raw, EU)", co2: 0.5, waterScarcity: 0.35, landUse: 80, fossil: 2.8, loss: 0.06 },
                "honey": { name: "Honey (EU)", co2: 1.1, waterScarcity: 0.05, landUse: 150, fossil: 3.0, loss: 0.01 },
                "coffee": { name: "Coffee (Roasted Arabica)", co2: 20.0, waterScarcity: 3.5, landUse: 1500, fossil: 40.0, loss: 0.02 },
                "cocoa": { name: "Cocoa (Powder, Global)", co2: 15.0, waterScarcity: 2.0, landUse: 2200, fossil: 27.5, loss: 0.02 },
                "tea": { name: "Tea (Black, Dried)", co2: 1.8, waterScarcity: 0.45, landUse: 250, fossil: 5.0, loss: 0.01 },
                "salt": { name: "Salt (Sea, EU)", co2: 0.05, waterScarcity: 0.01, landUse: 5, fossil: 0.5, loss: 0.001 },
                "yeast": { name: "Yeast (Brewer's)", co2: 1.0, waterScarcity: 0.15, landUse: 30, fossil: 2.5, loss: 0.002 },
                "algae-protein": { name: "Algae Protein (Microalgae)", co2: 1.5, waterScarcity: 0.25, landUse: 50, fossil: 3.5, loss: 0.005 }
            },

            // COUNTRY FACTORS (IEA 2023 + AWARE 2.0)
            countries: {
                "DE": { name: "Germany", electricityCO2: 331, awareFactor: 24.5 },
                "FR": { name: "France", electricityCO2: 86, awareFactor: 17.1 },
                "IT": { name: "Italy", electricityCO2: 275, awareFactor: 49.8 },
                "ES": { name: "Spain", electricityCO2: 196, awareFactor: 64.7 },
                "NL": { name: "Netherlands", electricityCO2: 331, awareFactor: 33.6 },
                "PL": { name: "Poland", electricityCO2: 724, awareFactor: 19.8 },
                "SE": { name: "Sweden", electricityCO2: 22, awareFactor: 1.3 },
                "DK": { name: "Denmark", electricityCO2: 110, awareFactor: 14.5 },
                "BE": { name: "Belgium", electricityCO2: 190, awareFactor: 42.1 },
                "UK": { name: "United Kingdom", electricityCO2: 215, awareFactor: 22.9 },
                "IE": { name: "Ireland", electricityCO2: 340, awareFactor: 1.8 },
                "AT": { name: "Austria", electricityCO2: 126, awareFactor: 2.5 },
                "FI": { name: "Finland", electricityCO2: 68, awareFactor: 0.5 },
                "PT": { name: "Portugal", electricityCO2: 216, awareFactor: 43.1 },
                "GR": { name: "Greece", electricityCO2: 418, awareFactor: 61.2 },
                "US": { name: "United States", electricityCO2: 385, awareFactor: 32.9 },
                "CA": { name: "Canada", electricityCO2: 110, awareFactor: 2.2 },
                "AU": { name: "Australia", electricityCO2: 592, awareFactor: 60.1 },
                "JP": { name: "Japan", electricityCO2: 436, awareFactor: 36.5 },
                "CN": { name: "China", electricityCO2: 531, awareFactor: 41.0 },
                "IN": { name: "India", electricityCO2: 708, awareFactor: 70.4 },
                "BR": { name: "Brazil", electricityCO2: 106, awareFactor: 3.1 }
            },

            // PROCESSING METHODS (PEF-COMPLIANT)
            processing: {
                "none": { energy: 0, water: 0, yield: 1.00, loss: 0.000 },
                "pasteurization": { energy: 0.075, water: 0.2, yield: 0.995, loss: 0.005 },
                "sterilization": { energy: 0.15, water: 0.35, yield: 0.985, loss: 0.015 },
                "baking": { energy: 0.6, water: 0.15, yield: 0.88, loss: 0.120 },
                "frying": { energy: 0.75, water: 1.0, yield: 0.75, loss: 0.250 },
                "freezing": { energy: 0.3, water: 1.25, yield: 0.975, loss: 0.025 },
                "drying": { energy: 2.0, water: 0.2, yield: 0.97, loss: 0.030 },
                "milling": { energy: 0.045, water: 0.05, yield: 0.78, loss: 0.220 },
                "mixing": { energy: 0.02, water: 0.05, yield: 0.995, loss: 0.005 }
            },

            // TRANSPORTATION (GLEC v3.0 COMPLIANT)
            transportation: {
                "road": { co2: 0.08, refrigerated: 0.30 },
                "rail": { co2: 0.02, refrigerated: 0.00 },
                "sea": { co2: 0.01, refrigerated: 0.75 },
                "air": { co2: 0.525, refrigerated: 0.00 },
                "lastmile": { co2: 0.20, refrigerated: 0.00 }
            },

            // PACKAGING (CFF COMPLIANT)
            packaging: {
                "cardboard": { co2: 1.4, r1: 0.25, r2: 0.85, q: 0.90 },
                "PET": { co2: 2.5, r1: 0.10, r2: 0.90, q: 0.95 },
                "HDPE": { co2: 2.0, r1: 0.05, r2: 0.80, q: 0.90 },
                "LDPE": { co2: 2.2, r1: 0.05, r2: 0.80, q: 0.90 },
                "PP": { co2: 2.1, r1: 0.05, r2: 0.80, q: 0.90 },
                "glass": { co2: 1.05, r1: 0.50, r2: 0.95, q: 1.00 },
                "aluminum": { co2: 9.0, r1: 0.50, r2: 0.95, q: 1.00 },
                "steel": { co2: 2.0, r1: 0.50, r2: 0.95, q: 1.00 },
                "PLA": { co2: 2.0, r1: 0.05, r2: 0.01, q: 0.80 }
            }
        };

        let selectedIngredients = [];
        let currentChart = null;
        let currentDPPId = null;

        function initApp() {
            populateIngredientSelect();
            populateCountrySelect();
            setupDemoData();
            calculateImpact();
            updateTabIndicator();
            generateDPP();
        }

        function populateIngredientSelect() {
            const select = document.getElementById('ingredientSelect');
            select.innerHTML = '<option value="">Choose from 35+ PEF-compliant ingredients...</option>';
            
            for (const [key, ingredient] of Object.entries(aioxyData.ingredients)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = ingredient.name;
                select.appendChild(option);
            }
        }

        function populateCountrySelect() {
            const select = document.getElementById('manufacturingCountry');
            select.innerHTML = '<option value="">Select country...</option>';
            
            for (const [code, country] of Object.entries(aioxyData.countries)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = country.name;
                if (code === 'FR') option.selected = true;
                select.appendChild(option);
            }
        }

        function setupDemoData() {
            selectedIngredients = [
                { id: 'peas', name: 'Peas (Dried, EU)', quantity: 0.15, data: aioxyData.ingredients.peas },
                { id: 'wheat', name: 'Wheat (Grain, EU)', quantity: 0.10, data: aioxyData.ingredients.wheat },
                { id: 'tomatoes', name: 'Tomatoes (Field, ES)', quantity: 0.05, data: aioxyData.ingredients.tomatoes }
            ];
            updateIngredientList();
        }

        function addIngredient() {
            const select = document.getElementById('ingredientSelect');
            const quantityInput = document.getElementById('ingredientQuantity');
            
            const ingredientId = select.value;
            const quantity = parseFloat(quantityInput.value);
            
            if (!ingredientId || isNaN(quantity) || quantity <= 0) {
                alert('Please select an ingredient and enter a valid quantity');
                return;
            }
            
            const ingredient = aioxyData.ingredients[ingredientId];
            selectedIngredients.push({
                id: ingredientId,
                name: ingredient.name,
                quantity: quantity,
                data: ingredient
            });
            
            updateIngredientList();
            calculateImpact();
            
            select.value = '';
            quantityInput.value = '0.150';
        }

        function removeIngredient(index) {
            selectedIngredients.splice(index, 1);
            updateIngredientList();
            calculateImpact();
        }

        function updateIngredientList() {
            const list = document.getElementById('ingredientList');
            list.innerHTML = '';
            
            if (selectedIngredients.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-apple-alt"></i>
                        <h3>No ingredients added yet</h3>
                        <p>Add ingredients to calculate your environmental impact</p>
                    </div>
                `;
                return;
            }
            
            selectedIngredients.forEach((ingredient, index) => {
                const item = document.createElement('div');
                item.className = 'ingredient-item';
                item.innerHTML = `
                    <div class="ingredient-info">
                        <div class="ingredient-name">${ingredient.name}</div>
                        <div class="ingredient-stats">
                            ${ingredient.data.co2} kg CO₂e/kg • ${ingredient.data.waterScarcity} m³ water scarcity/kg
                        </div>
                    </div>
                    <div class="ingredient-actions">
                        <input type="number" class="quantity-input" value="${ingredient.quantity}" step="0.001" min="0" 
                               onchange="updateIngredientQuantity(${index}, this.value)">
                        <button class="remove-btn" onclick="removeIngredient(${index})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        function updateIngredientQuantity(index, newQuantity) {
            selectedIngredients[index].quantity = parseFloat(newQuantity);
            calculateImpact();
        }

        function toggleAdvanced() {
            const advanced = document.getElementById('advancedOptions');
            advanced.classList.toggle('hidden');
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            
            if (tabName === 'results') calculateImpact();
            if (tabName === 'dpp') generateDPP();
            
            updateTabIndicator();
        }

        function updateTabIndicator() {
            const activeTab = document.querySelector('.nav-tab.active');
            const indicator = document.getElementById('tabIndicator');
            
            if (activeTab && indicator) {
                indicator.style.left = activeTab.offsetLeft + 'px';
                indicator.style.width = activeTab.offsetWidth + 'px';
            }
        }

        function calculateImpact() {
            if (selectedIngredients.length === 0) return;

            const loadingElement = document.getElementById('loadingResults');
            const resultsContent = document.getElementById('resultsContent');
            
            loadingElement.classList.remove('hidden');
            resultsContent.classList.add('hidden');

            setTimeout(() => {
                const results = performCalculations();
                updateResultsUI(results);
                
                loadingElement.classList.add('hidden');
                resultsContent.classList.remove('hidden');
            }, 800);
        }

        function performCalculations() {
            // Get all inputs
            const countryCode = document.getElementById('manufacturingCountry').value || 'FR';
            const processingType = document.getElementById('processingMethod').value;
            const transportMode = document.getElementById('transportMode').value;
            const transportDistance = parseFloat(document.getElementById('transportDistance').value) || 0;
            const packagingType = document.getElementById('packagingMaterial').value;
            const packagingWeight = parseFloat(document.getElementById('packagingWeight').value) || 0;
            const recycledContent = parseFloat(document.getElementById('recycledContent').value) || 0;
            const isRefrigerated = document.getElementById('refrigeratedTransport').value === 'yes';
            const productWeight = parseFloat(document.getElementById('productWeight').value) || 0.2;

            const country = aioxyData.countries[countryCode];
            const processing = aioxyData.processing[processingType];
            const transport = aioxyData.transportation[transportMode];
            const packaging = aioxyData.packaging[packagingType];

            // Calculate ingredient impacts with food loss adjustment
            let totalCO2 = 0;
            let totalWaterScarcity = 0;
            let totalLandUse = 0;
            let totalFossil = 0;
            let totalWeight = 0;

            selectedIngredients.forEach(ingredient => {
                const adjustedQuantity = ingredient.quantity / (1 - ingredient.data.loss);
                
                totalCO2 += adjustedQuantity * ingredient.data.co2;
                totalWaterScarcity += adjustedQuantity * ingredient.data.waterScarcity;
                totalLandUse += adjustedQuantity * ingredient.data.landUse;
                totalFossil += adjustedQuantity * ingredient.data.fossil;
                totalWeight += ingredient.quantity;
            });

            // Add processing impact with regional electricity factor
            const processingCO2 = processing.energy * (country.electricityCO2 / 1000) * totalWeight;
            totalCO2 += processingCO2;
            totalWeight *= processing.yield;

            // Add transportation impact
            let transportCO2 = transportDistance * transport.co2 * (totalWeight / 1000);
            if (isRefrigerated) {
                transportCO2 *= (1 + transport.refrigerated);
            }
            totalCO2 += transportCO2;

            // Add packaging impact with CFF calculation
            const packagingCO2 = calculateCFFImpact(packaging, packagingWeight, recycledContent);
            totalCO2 += packagingCO2;

            // Calculate water scarcity using AWARE method
            const waterScarcity = calculateAWAREImpact(totalWaterScarcity, country.awareFactor);

            // Calculate per kg values
            const co2PerKg = totalWeight > 0 ? totalCO2 / totalWeight : 0;
            const waterScarcityPerKg = totalWeight > 0 ? waterScarcity / totalWeight : 0;
            const landUsePerKg = totalWeight > 0 ? totalLandUse / totalWeight : 0;

            // Calculate savings vs industry average
            const industryAvgCO2 = 3.5;
            const industryAvgWater = 2.0;
            
            const co2Saved = Math.max(industryAvgCO2 - co2PerKg, 0) * totalWeight;
            const waterSaved = Math.max(industryAvgWater - waterScarcityPerKg, 0) * totalWeight;
            
            const co2SavingsPercent = totalWeight > 0 ? ((co2Saved / (industryAvgCO2 * totalWeight)) * 100) : 0;
            const waterSavingsPercent = totalWeight > 0 ? ((waterSaved / (industryAvgWater * totalWeight)) * 100) : 0;

            // Calculate impact comparisons for storytelling
            const carKmSaved = (co2Saved * 1000 / 120).toFixed(0); // 120g CO2/km for average car
            const householdEnergyDays = (co2Saved * 1000 / 12000).toFixed(1); // 12kg CO2/day for average EU household
            const treesEquivalent = (co2Saved / 0.025).toFixed(0); // 25kg CO2/year per tree
            const waterBottles = (waterSaved * 1000 / 1.5).toFixed(0); // 1.5L per bottle

            return {
                co2PerKg, waterScarcityPerKg, landUsePerKg,
                co2Saved, waterSaved, co2SavingsPercent, waterSavingsPercent,
                processingCO2, transportCO2, packagingCO2,
                ingredientsCO2: totalCO2 - processingCO2 - transportCO2 - packagingCO2,
                carKmSaved, householdEnergyDays, treesEquivalent, waterBottles,
                totalWeight
            };
        }

        // PEF CFF Calculation
        function calculateCFFImpact(packaging, weight, recycledContent) {
            const R1 = Math.min(recycledContent / 100, packaging.r1);
            const virginImpact = packaging.co2 * weight * (1 - R1);
            const recycledImpact = packaging.co2 * weight * R1 * packaging.q;
            return virginImpact + recycledImpact;
        }

        // PEF AWARE Water Scarcity
        function calculateAWAREImpact(waterScarcity, awareFactor) {
            const cf_constrained = Math.min(Math.max(awareFactor, 0.1), 100.0);
            return waterScarcity * cf_constrained;
        }

        function updateResultsUI(results) {
            document.getElementById('co2Value').textContent = results.co2PerKg.toFixed(2) + ' kg';
            document.getElementById('waterValue').textContent = results.waterScarcityPerKg.toFixed(2) + ' m³';
            document.getElementById('landValue').textContent = results.landUsePerKg.toFixed(0) + ' Pt';
            document.getElementById('waterScarcityValue').textContent = results.waterScarcityPerKg.toFixed(3);
            
            document.getElementById('co2Savings').textContent = results.co2SavingsPercent.toFixed(1) + '% saved';
            document.getElementById('waterSavings').textContent = results.waterSavingsPercent.toFixed(1) + '% saved';

            // Impact comparison storytelling
            document.getElementById('carKm').textContent = results.carKmSaved + ' km';
            document.getElementById('householdEnergy').textContent = results.householdEnergyDays + ' days';
            document.getElementById('treesPlanted').textContent = results.treesEquivalent + ' trees';
            document.getElementById('waterBottles').textContent = results.waterBottles + ' bottles';

            // Environmental story
            const storyContent = document.getElementById('storyContent');
            if (results.co2Saved > 0) {
                storyContent.innerHTML = `
                    <div class="story-highlight">
                        <i class="fas fa-seedling"></i>
                        <strong>${results.co2Saved.toFixed(1)} kg CO₂e saved</strong> - equivalent to not driving ${results.carKmSaved} km in a standard car
                    </div>
                    <div class="story-highlight">
                        <i class="fas fa-tint"></i>
                        <strong>${results.waterSaved.toFixed(1)} m³ world eq. of water scarcity saved</strong> - enough drinking water for ${results.waterBottles} people for a day
                    </div>
                    <div class="story-highlight">
                        <i class="fas fa-tree"></i>
                        <strong>Carbon absorption equivalent to ${results.treesEquivalent} trees</strong> - making a real contribution to natural carbon capture
                    </div>
                    <p>
                        Your product demonstrates outstanding environmental performance with a carbon footprint ${results.co2SavingsPercent.toFixed(1)}% lower than industry average. 
                        This achievement reflects thoughtful ingredient selection, efficient supply chain management, and responsible resource use.
                        The water savings are particularly significant in addressing global water scarcity challenges.
                    </p>
                `;
            } else {
                storyContent.innerHTML = `
                    <div class="story-highlight">
                        Consider optimizing your ingredient selection and supply chain for better sustainability performance.
                    </div>
                    <p>
                        While your current product meets basic requirements, there are opportunities to further reduce environmental impact. 
                        Consider plant-based alternatives, regional sourcing, and energy-efficient processing methods to improve your sustainability profile.
                        Even small changes can lead to significant environmental benefits when scaled across your product portfolio.
                    </p>
                `;
            }

            createEmissionChart(results);
        }

        function createEmissionChart(results) {
            const ctx = document.getElementById('emissionChart').getContext('2d');
            
            if (currentChart) currentChart.destroy();
            
            currentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ingredients', 'Processing', 'Transportation', 'Packaging'],
                    datasets: [{
                        data: [
                            Math.max(results.ingredientsCO2, 0),
                            Math.max(results.processingCO2, 0),
                            Math.max(results.transportCO2, 0),
                            Math.max(results.packagingCO2, 0)
                        ],
                        backgroundColor: ['#2E86C1', '#27AE60', '#F39C12', '#E74C3C'],
                        borderWidth: 3,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                usePointStyle: true,
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(10, 37, 64, 0.9)',
                            titleFont: {
                                size: 13
                            },
                            bodyFont: {
                                size: 12
                            },
                            padding: 10,
                            cornerRadius: 6,
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw.toFixed(2)} kg CO₂e`;
                                }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        function generateDPP() {
            const productName = document.getElementById('productName').value || 'Unnamed Product';
            const dppId = 'DPP-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            currentDPPId = dppId;
            
            document.getElementById('dppId').textContent = dppId;
            
            // Generate QR Code
            const qrElement = document.getElementById('qrcode');
            qrElement.innerHTML = '';
            
            const dppData = {
                productId: dppId,
                productName: productName,
                timestamp: new Date().toISOString(),
                compliance: {
                    methodology: "PEF",
                    version: "3.1",
                    standards: ["EU Green Claims Directive", "ESPR DPP", "CSRD"]
                },
                dataSource: "AIOXY PEF Platform"
            };
            
            QRCode.toCanvas(qrElement, JSON.stringify(dppData), {
                width: 200,
                height: 200,
                margin: 1,
                color: {
                    dark: '#0A2540',
                    light: '#FFFFFF'
                }
            }, function(error) {
                if (error) console.error(error);
            });
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
    </html>
