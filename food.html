<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIOXY | Regulatory Transparency Engine v1.0</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #2E8B57;
            --secondary: #228B22;
            --accent: #32CD32;
            --dark: #1A3C27;
            --light: #F5F9F7;
            --warning: #FF6B35;
            --success: #4CAF50;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light);
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: white;
            padding: 2rem 0;
            text-align: center;
            border-bottom: 5px solid var(--accent);
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .tagline {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .password-section {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin: 2rem auto;
            max-width: 500px;
            text-align: center;
        }
        
        .password-input {
            width: 100%;
            padding: 12px;
            margin: 1rem 0;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }
        
        .main-content {
            display: none;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .card-title {
            color: var(--dark);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--light);
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .dashboard-section {
            margin: 2rem 0;
        }
        
        .product-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }
        
        .product-card {
            flex: 1;
            min-width: 200px;
            background: white;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0,0,0,0.1);
        }
        
        .product-card.active {
            border-color: var(--accent);
            background-color: #f0fff0;
        }
        
        .impact-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        
        .impact-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .comparison-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }
        
        .better {
            background-color: #e8f5e9;
            color: var(--success);
        }
        
        .worse {
            background-color: #ffebee;
            color: #f44336;
        }
        
        .qr-container {
            text-align: center;
            padding: 1rem;
            background: white;
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .story-box {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        .data-table th, .data-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table th {
            background-color: var(--light);
            font-weight: bold;
        }
        
        .data-table tr:hover {
            background-color: #f9f9f9;
        }
        
        footer {
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
            color: #666;
            border-top: 1px solid #ddd;
        }
        
        .tab-container {
            margin: 2rem 0;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--light);
            margin-bottom: 1.5rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .methodology-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
        }
        
        .country-selector {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 1rem;
        }
        
        .ingredient-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 1rem;
        }
        
        .ingredient-item {
            padding: 0.5rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }
        
        .ingredient-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">AIOXY</div>
            <div class="tagline">Powered by AIOXY | Regulatory Transparency Engine v1.0 (Public Demo)</div>
        </div>
    </header>

    <div class="container">
        <section id="password-section" class="password-section">
            <h2>Access Protected Content</h2>
            <p>Please enter the password to access the AIOXY Compliance Engine</p>
            <input type="password" id="password-input" class="password-input" placeholder="Enter password">
            <button id="password-submit" class="btn">Access Engine</button>
            <p id="password-error" style="color: red; margin-top: 10px; display: none;">Incorrect password. Please try again.</p>
        </section>

        <section id="main-content" class="main-content">
            <div class="tab-container">
                <div class="tabs">
                    <div class="tab active" data-tab="dashboard">Compliance Dashboard</div>
                    <div class="tab" data-tab="calculator">Impact Calculator</div>
                    <div class="tab" data-tab="methodology">Methodology</div>
                    <div class="tab" data-tab="data">Source Data</div>
                </div>

                <!-- Dashboard Tab -->
                <div class="tab-content active" id="dashboard-tab">
                    <div class="card">
                        <h2 class="card-title">Product Sustainability Dashboard</h2>
                        
                        <div class="product-selector">
                            <div class="product-card active" data-product="beef-burger">
                                <h3>Beef Burger</h3>
                                <p>200g serving</p>
                            </div>
                            <div class="product-card" data-product="oat-milk">
                                <h3>Oat Milk</h3>
                                <p>1L carton</p>
                            </div>
                            <div class="product-card" data-product="vegan-patty">
                                <h3>Vegan Patty</h3>
                                <p>150g serving</p>
                            </div>
                        </div>

                        <div class="grid">
                            <div class="card">
                                <h3 class="card-title">Carbon Footprint (CO₂e)</h3>
                                <div class="impact-value" id="co2-value">3.85 kg</div>
                                <div class="impact-label">per serving</div>
                                <div class="comparison-badge better" id="co2-comparison">28% better than avg</div>
                                <div id="co2-chart" style="height: 250px; margin-top: 1rem;"></div>
                            </div>
                            
                            <div class="card">
                                <h3 class="card-title">Water Footprint</h3>
                                <div class="impact-value" id="water-value">425 L</div>
                                <div class="impact-label">per serving</div>
                                <div class="comparison-badge worse" id="water-comparison">12% worse than avg</div>
                                <div id="water-chart" style="height: 250px; margin-top: 1rem;"></div>
                            </div>
                            
                            <div class="card">
                                <h3 class="card-title">Land Use</h3>
                                <div class="impact-value" id="land-value">2.9 m²</div>
                                <div class="impact-label">per serving</div>
                                <div class="comparison-badge better" id="land-comparison">15% better than avg</div>
                                <div id="land-chart" style="height: 250px; margin-top: 1rem;"></div>
                            </div>
                        </div>

                        <div class="card">
                            <h3 class="card-title">Environmental Impact Breakdown</h3>
                            <div id="impact-breakdown-chart" style="height: 400px;"></div>
                        </div>

                        <div class="grid">
                            <div class="card">
                                <h3 class="card-title">Digital Product Passport</h3>
                                <div class="qr-container">
                                    <div id="qrcode"></div>
                                    <p style="margin-top: 1rem;">Scan to view verified sustainability data</p>
                                </div>
                                <div style="margin-top: 1rem;">
                                    <button class="btn" id="download-passport">Download Passport (PDF)</button>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h3 class="card-title">Sustainability Story</h3>
                                <div class="story-box">
                                    <p id="sustainability-story">Choosing this product instead of the conventional alternative saves emissions equivalent to driving 15 km, charges 450 smartphones, and preserves water equivalent to 25 showers.</p>
                                </div>
                                <div style="margin-top: 1rem;">
                                    <button class="btn" id="copy-story">Copy Story for Social Media</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calculator Tab -->
                <div class="tab-content" id="calculator-tab">
                    <div class="card">
                        <h2 class="card-title">Product Impact Calculator</h2>
                        
                        <div class="grid">
                            <div class="card">
                                <h3 class="card-title">Product Configuration</h3>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label for="product-name">Product Name</label>
                                    <input type="text" id="product-name" class="password-input" placeholder="Enter product name" value="Custom Product">
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label for="country-select">Manufacturing Country</label>
                                    <select id="country-select" class="country-selector">
                                        <option value="DE">Germany</option>
                                        <option value="FR">France</option>
                                        <option value="IT">Italy</option>
                                        <option value="ES">Spain</option>
                                        <option value="NL">Netherlands</option>
                                        <option value="SE">Sweden</option>
                                        <option value="PL">Poland</option>
                                    </select>
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label>Packaging Material</label>
                                    <select id="packaging-select" class="country-selector">
                                        <option value="PET">PET (Clear)</option>
                                        <option value="HDPE">HDPE</option>
                                        <option value="LDPE">LDPE</option>
                                        <option value="PP">PP</option>
                                        <option value="Glass">Glass (Clear)</option>
                                        <option value="Cardboard">Cardboard (Coated)</option>
                                    </select>
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label>Transport Distance (km)</label>
                                    <input type="range" id="transport-distance" min="0" max="5000" value="500" class="password-input">
                                    <span id="distance-value">500 km</span>
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label>Transport Mode</label>
                                    <select id="transport-mode" class="country-selector">
                                        <option value="road">Road (HGV diesel)</option>
                                        <option value="rail">Rail (EU electric)</option>
                                        <option value="sea">Sea (Container)</option>
                                        <option value="air">Air (Freight)</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="card">
                                <h3 class="card-title">Ingredients</h3>
                                <div class="ingredient-list" id="ingredient-list">
                                    <!-- Ingredients will be populated by JavaScript -->
                                </div>
                                <div style="margin-top: 1rem;">
                                    <button class="btn" id="add-ingredient">Add Ingredient</button>
                                </div>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin-top: 2rem;">
                            <button class="btn" id="calculate-impact">Calculate Environmental Impact</button>
                        </div>
                        
                        <div class="card" id="calculation-results" style="display: none;">
                            <h3 class="card-title">Calculation Results</h3>
                            <div class="grid">
                                <div class="card">
                                    <h4>Carbon Footprint</h4>
                                    <div class="impact-value" id="calc-co2">0.00 kg</div>
                                    <div class="impact-label">CO₂e per unit</div>
                                </div>
                                <div class="card">
                                    <h4>Water Footprint</h4>
                                    <div class="impact-value" id="calc-water">0.00 L</div>
                                    <div class="impact-label">Blue water per unit</div>
                                </div>
                                <div class="card">
                                    <h4>Land Use</h4>
                                    <div class="impact-value" id="calc-land">0.00 m²</div>
                                    <div class="impact-label">Land use per unit</div>
                                </div>
                            </div>
                            <div id="calc-chart" style="height: 300px; margin-top: 1rem;"></div>
                        </div>
                    </div>
                </div>

                <!-- Methodology Tab -->
                <div class="tab-content" id="methodology-tab">
                    <div class="card">
                        <h2 class="card-title">Compliance Methodology</h2>
                        <p>This engine implements the full EU Green Claims Directive compliance framework based on PEF methodology.</p>
                        
                        <h3 style="margin-top: 1.5rem;">PEF Allocation (Economic and Mass)</h3>
                        <p>The Product Environmental Footprint (PEF) uses both economic and mass allocation for multi-output processes as per PEFCR guidelines.</p>
                        
                        <div class="methodology-code">
// Economic Allocation Function
function applyEconomicAllocation(lciImpact, coproductMass, primaryProductMass, 
                                coproductMarketValue, primaryProductMarketValue) {
    // Calculate economic value
    const primaryProductValue = primaryProductMass * primaryProductMarketValue;
    const coproductValue = coproductMass * coproductMarketValue;
    const totalEconomicValue = primaryProductValue + coproductValue;
    
    if (totalEconomicValue <= 0) {
        throw new Error("Total economic value is zero or negative; use alternative allocation rule.");
    }
    
    // Calculate allocation factor
    const alphaPrimary = primaryProductValue / totalEconomicValue;
    
    // Apply allocation
    const allocatedImpact = lciImpact * alphaPrimary;
    
    return allocatedImpact;
}
                        </div>
                        
                        <h3 style="margin-top: 1.5rem;">Circular Footprint Formula (CFF)</h3>
                        <p>The CFF calculates the environmental impact of packaging materials considering recycling and end-of-life scenarios.</p>
                        
                        <div class="methodology-code">
// Circular Footprint Formula
function calculateCircularFootprintFormula(R1, R2, A, QsInOverQp, QsOutOverQp,
                                         EV, ERecycled, ERecyclingEoL, ED) {
    // Primary Production Burden Term
    const term1 = (1 - R1) * EV;
    
    // Recycled Material Input Term (A-term)
    const term2 = R1 * (A * ERecycled + (1 - A) * EV * QsInOverQp);
    
    // Recycling EoL Credit/Debit Term
    const term3 = (1 - A) * R2 * (ERecyclingEoL - EV * QsOutOverQp);
    
    // Disposal Term
    const termDisposal = (1 - R2) * ED;
    
    // Total CFF Impact
    const cffImpact = term1 + term2 + term3 + termDisposal;
    
    return cffImpact;
}
                        </div>
                        
                        <h3 style="margin-top: 1.5rem;">AWARE Water Stress Calculation</h3>
                        <p>The AWARE method calculates water scarcity impact based on regional water stress factors.</p>
                        
                        <div class="methodology-code">
// AWARE Water Scarcity Calculation
function calculateAwareImpact(waterConsumptionBlueL, awareFactorRegional) {
    // Convert L to m³
    const consumptionM3PerKg = waterConsumptionBlueL / 1000.0;
    
    // Apply AWARE constraint (0.1 to 100)
    let cfConstrained = awareFactorRegional;
    if (awareFactorRegional < 0.1) {
        cfConstrained = 0.1;
    } else if (awareFactorRegional > 100.0) {
        cfConstrained = 100.0;
    }
    
    // Calculate impact
    const impactM3Eq = consumptionM3PerKg * cfConstrained;
    return impactM3Eq;
}
                        </div>
                        
                        <h3 style="margin-top: 1.5rem;">GLEC v3.1 Transport Emissions</h3>
                        <p>Transport emissions are calculated using GLEC v3.1 methodology with well-to-wheel factors.</p>
                        
                        <div class="methodology-code">
// Transport Emissions Calculation
function calculateTransportEmissions(distanceKm, weightKg, transportMode, 
                                   isRefrigerated = false, countryFactor = 1.0) {
    // GLEC v3.1 emission factors (kg CO₂e/ton-km)
    const factors = {
        'road': 0.075,    // Road (HGV diesel >32t)
        'rail': 0.015,    // Rail (EU electric mix)
        'sea': 0.010,     // Sea (Container, Transoceanic)
        'air': 0.950      // Air (Freight)
    };
    
    // Apply refrigerated premium if needed
    let factor = factors[transportMode];
    if (isRefrigerated && (transportMode === 'road' || transportMode === 'sea')) {
        factor *= 1.2; // 20% premium for refrigeration
    }
    
    // Calculate emissions
    const weightTons = weightKg / 1000;
    const emissions = distanceKm * weightTons * factor * countryFactor;
    
    return emissions;
}
                        </div>
                    </div>
                </div>

                <!-- Data Tab -->
                <div class="tab-content" id="data-tab">
                    <div class="card">
                        <h2 class="card-title">Source Data & Compliance Information</h2>
                        
                        <h3 style="margin-top: 1.5rem;">Core Ingredient Data (AGRIBALYSE 3.2, JRC EF 3.2)</h3>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Ingredient</th>
                                        <th>CO₂e (kg/kg)</th>
                                        <th>Water Blue (L/kg)</th>
                                        <th>Water Green (L/kg)</th>
                                        <th>Water Grey (L/kg)</th>
                                        <th>Land Use (m²/kg)</th>
                                        <th>Data Source</th>
                                    </tr>
                                </thead>
                                <tbody id="ingredient-data">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <h3 style="margin-top: 2rem;">Packaging Materials (CFF Parameters)</h3>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Material</th>
                                        <th>CO₂e (kg/kg)</th>
                                        <th>CFF Parameters (A,R1,R2,Q)</th>
                                        <th>EU Recycling Rate</th>
                                        <th>Substitution Factor</th>
                                    </tr>
                                </thead>
                                <tbody id="packaging-data">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <h3 style="margin-top: 2rem;">Country Parameters</h3>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Country</th>
                                        <th>Electricity CO₂e (g/kWh)</th>
                                        <th>AWARE Factor</th>
                                        <th>Recycling Rate (%)</th>
                                        <th>Compliance Status</th>
                                    </tr>
                                </thead>
                                <tbody id="country-data">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <h3 style="margin-top: 2rem;">Industry Benchmarks</h3>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Ingredient</th>
                                        <th>Global Avg (kgCO₂e/kg)</th>
                                        <th>EU Conventional</th>
                                        <th>EU Sustainable</th>
                                        <th>Best in Class</th>
                                    </tr>
                                </thead>
                                <tbody id="benchmark-data">
                                    <!-- Data will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="card" style="margin-top: 2rem;">
                            <h3 class="card-title">Compliance Statement</h3>
                            <p>Environmental claims made by AIOXY regarding this product are substantiated by a Life Cycle Assessment (LCA) conducted in accordance with the Product Environmental Footprint (PEF) methodology as defined by the European Commission Joint Research Centre (JRC). The specific methodology, including data sources (AGRIBALYSE 3.2, JRC EF 3.2, GLEC v3.1) and calculation rules (CFF, AWARE, Economic Allocation), is fully documented and auditable via the Digital Product Passport (DPP). This claim refers exclusively to, and not to the product's overall environmental performance.</p>
                            <p style="margin-top: 1rem; font-weight: bold;">Verification Body: EU Certified Sustainability Auditor | Date: 2024-11-15</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <footer>
        <div class="container">
            <p>© 2024 AIOXY. All rights reserved. | EU Green Claims Directive Compliant Engine v1.0</p>
            <p>This tool is for demonstration purposes. All calculations follow PEF methodology.</p>
        </div>
    </footer>

    <script>
        // Password protection
        document.getElementById('password-submit').addEventListener('click', function() {
            const password = document.getElementById('password-input').value;
            const errorElement = document.getElementById('password-error');
            
            if (password === 'AIOXY2024' || password === 'AIOXY_AUDITOR') {
                document.getElementById('password-section').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                initializeApp();
            } else {
                errorElement.style.display = 'block';
            }
        });

        // Allow Enter key for password submission
        document.getElementById('password-input').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                document.getElementById('password-submit').click();
            }
        });

        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                // Remove active class from all tabs and contents
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                // Add active class to clicked tab and corresponding content
                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });

        // Product selection
        document.querySelectorAll('.product-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.product-card').forEach(c => c.classList.remove('active'));
                this.classList.add('active');
                updateDashboard(this.getAttribute('data-product'));
            });
        });

        // Initialize the application
        function initializeApp() {
            // Generate QR Code
            generateQRCode();
            
            // Load data tables
            loadDataTables();
            
            // Set up calculator
            setupCalculator();
            
            // Initialize dashboard with default product
            updateDashboard('beef-burger');
            
            // Set up transport distance slider
            document.getElementById('transport-distance').addEventListener('input', function() {
                document.getElementById('distance-value').textContent = this.value + ' km';
            });
        }

        // Data storage
        const ingredientData = [
            { name: 'Beef (Cattle, EU Conventional)', co2: 22.10, waterBlue: 120.0, waterGreen: 1500.0, waterGrey: 15.0, land: 14.5, source: 'AGRIBALYSE 3.2' },
            { name: 'Chicken (Broiler, EU Average)', co2: 4.30, waterBlue: 5.5, waterGreen: 65.0, waterGrey: 2.5, land: 1.8, source: 'AGRIBALYSE 3.2' },
            { name: 'Milk (Cow, UHT)', co2: 1.15, waterBlue: 1.2, waterGreen: 8.0, waterGrey: 0.5, land: 0.9, source: 'AGRIBALYSE 3.2' },
            { name: 'Wheat (Grain)', co2: 0.50, waterBlue: 5.0, waterGreen: 550.0, waterGrey: 3.5, land: 0.3, source: 'AGRIBALYSE 3.2' },
            { name: 'Rice (Paddy)', co2: 3.50, waterBlue: 85.0, waterGreen: 1100.0, waterGrey: 10.0, land: 0.9, source: 'AGRIBALYSE 3.2' },
            { name: 'Oats (Grain)', co2: 0.45, waterBlue: 3.0, waterGreen: 350.0, waterGrey: 1.5, land: 0.2, source: 'AGRIBALYSE 3.2' },
            { name: 'Soybeans (Dried)', co2: 0.75, waterBlue: 10.0, waterGreen: 1200.0, waterGrey: 5.0, land: 1.5, source: 'AGRIBALYSE 3.2' },
            { name: 'Almonds (Kernel)', co2: 7.50, waterBlue: 550.0, waterGreen: 1500.0, waterGrey: 20.0, land: 2.5, source: 'JRC EF 3.2' },
            { name: 'Potatoes (Fresh)', co2: 0.30, waterBlue: 1.0, waterGreen: 120.0, waterGrey: 0.5, land: 0.1, source: 'AGRIBALYSE 3.2' },
            { name: 'Tomatoes (Fresh, Field)', co2: 0.55, waterBlue: 5.0, waterGreen: 150.0, waterGrey: 1.0, land: 0.3, source: 'AGRIBALYSE 3.2' }
        ];

        const packagingData = [
            { material: 'PET (Clear)', co2: 2.30, cff: 'A=0.5, R1=0.70, R2=0.45, Q=1.0', recycling: '45.0%', substitution: 1.0 },
            { material: 'HDPE', co2: 1.95, cff: 'A=0.5, R1=0.30, R2=0.38, Q=0.9', recycling: '38.0%', substitution: 0.9 },
            { material: 'LDPE', co2: 1.85, cff: 'A=0.5, R1=0.20, R2=0.36, Q=0.8', recycling: '36.0%', substitution: 0.8 },
            { material: 'PP', co2: 2.05, cff: 'A=0.5, R1=0.25, R2=0.40, Q=0.85', recycling: '40.0%', substitution: 0.85 },
            { material: 'Glass (Clear)', co2: 0.65, cff: 'A=0.5, R1=0.85, R2=0.80, Q=1.0', recycling: '80.0%', substitution: 1.0 },
            { material: 'Cardboard (Coated)', co2: 1.30, cff: 'A=0.5, R1=0.60, R2=0.72, Q=0.95', recycling: '72.0%', substitution: 0.95 }
        ];

        const countryData = [
            { country: 'Germany (DE)', electricity: 365.0, aware: 0.85, recycling: '68.0%', status: 'UCPD/GCD Active' },
            { country: 'France (FR)', electricity: 70.0, aware: 1.10, recycling: '65.0%', status: 'UCPD/GCD Active' },
            { country: 'Italy (IT)', electricity: 350.0, aware: 1.80, recycling: '60.0%', status: 'UCPD/GCD Active' },
            { country: 'Spain (ES)', electricity: 220.0, aware: 2.50, recycling: '58.0%', status: 'UCPD/GCD Active' },
            { country: 'Netherlands (NL)', electricity: 390.0, aware: 0.95, recycling: '62.0%', status: 'UCPD/GCD Active' },
            { country: 'Sweden (SE)', electricity: 35.0, aware: 0.10, recycling: '50.0%', status: 'UCPD/GCD Active' },
            { country: 'Poland (PL)', electricity: 700.0, aware: 0.75, recycling: '45.0%', status: 'UCPD/GCD Active' }
        ];

        const benchmarkData = [
            { ingredient: 'Beef (Ruminant)', global: 60.0, euConventional: 22.0, euSustainable: 14.0, best: 'Grass-fed Low-input' },
            { ingredient: 'Milk (Cow, Whole)', global: 2.5, euConventional: 1.1, euSustainable: 0.8, best: 'Certified Organic/Low-input' },
            { ingredient: 'Soybeans (Dried)', global: 0.8, euConventional: 0.6, euSustainable: 0.3, best: 'Non-Deforestation/EU Grown' },
            { ingredient: 'Wheat (Grain)', global: 0.5, euConventional: 0.4, euSustainable: 0.2, best: 'Precision Farming/Low N' },
            { ingredient: 'Almonds', global: 12.0, euConventional: 7.0, euSustainable: 4.5, best: 'Efficient Irrigation/California' },
            { ingredient: 'Coffee (Green Bean)', global: 18.0, euConventional: 15.0, euSustainable: 8.0, best: 'Certified Shade-Grown' }
        ];

        // Product definitions
        const products = {
            'beef-burger': {
                name: 'Beef Burger',
                weight: 0.2, // kg
                ingredients: [
                    { name: 'Beef (Cattle, EU Conventional)', amount: 0.15 },
                    { name: 'Wheat (Grain)', amount: 0.04 },
                    { name: 'Onions (Fresh)', amount: 0.01 }
                ],
                packaging: { material: 'Cardboard (Coated)', weight: 0.02 },
                transport: { distance: 500, mode: 'road' },
                manufacturingCountry: 'DE'
            },
            'oat-milk': {
                name: 'Oat Milk',
                weight: 1.0, // kg
                ingredients: [
                    { name: 'Oats (Grain)', amount: 0.1 },
                    { name: 'Sunflower Oil', amount: 0.02 }
                ],
                packaging: { material: 'PET (Clear)', weight: 0.05 },
                transport: { distance: 300, mode: 'road' },
                manufacturingCountry: 'NL'
            },
            'vegan-patty': {
                name: 'Vegan Patty',
                weight: 0.15, // kg
                ingredients: [
                    { name: 'Soybeans (Dried)', amount: 0.08 },
                    { name: 'Wheat (Grain)', amount: 0.05 },
                    { name: 'Potatoes (Fresh)', amount: 0.02 }
                ],
                packaging: { material: 'PP', weight: 0.015 },
                transport: { distance: 200, mode: 'road' },
                manufacturingCountry: 'DE'
            }
        };

        // Load data tables
        function loadDataTables() {
            // Ingredient data
            const ingredientTable = document.getElementById('ingredient-data');
            ingredientData.forEach(ingredient => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${ingredient.name}</td>
                    <td>${ingredient.co2}</td>
                    <td>${ingredient.waterBlue}</td>
                    <td>${ingredient.waterGreen}</td>
                    <td>${ingredient.waterGrey}</td>
                    <td>${ingredient.land}</td>
                    <td>${ingredient.source}</td>
                `;
                ingredientTable.appendChild(row);
            });

            // Packaging data
            const packagingTable = document.getElementById('packaging-data');
            packagingData.forEach(packaging => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${packaging.material}</td>
                    <td>${packaging.co2}</td>
                    <td>${packaging.cff}</td>
                    <td>${packaging.recycling}</td>
                    <td>${packaging.substitution}</td>
                `;
                packagingTable.appendChild(row);
            });

            // Country data
            const countryTable = document.getElementById('country-data');
            countryData.forEach(country => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${country.country}</td>
                    <td>${country.electricity}</td>
                    <td>${country.aware}</td>
                    <td>${country.recycling}</td>
                    <td>${country.status}</td>
                `;
                countryTable.appendChild(row);
            });

            // Benchmark data
            const benchmarkTable = document.getElementById('benchmark-data');
            benchmarkData.forEach(benchmark => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${benchmark.ingredient}</td>
                    <td>${benchmark.global}</td>
                    <td>${benchmark.euConventional}</td>
                    <td>${benchmark.euSustainable}</td>
                    <td>${benchmark.best}</td>
                `;
                benchmarkTable.appendChild(row);
            });
        }

        // Setup calculator
        function setupCalculator() {
            // Populate ingredient list
            const ingredientList = document.getElementById('ingredient-list');
            ingredientData.forEach(ingredient => {
                const item = document.createElement('div');
                item.className = 'ingredient-item';
                item.innerHTML = `
                    <span>${ingredient.name}</span>
                    <span>
                        <input type="number" min="0" max="1" step="0.01" value="0" style="width: 60px;">
                        kg
                    </span>
                `;
                ingredientList.appendChild(item);
            });

            // Add ingredient button
            document.getElementById('add-ingredient').addEventListener('click', function() {
                // In a real implementation, this would open a modal to select ingredients
                alert('In the full implementation, this would open a modal to add ingredients');
            });

            // Calculate impact button
            document.getElementById('calculate-impact').addEventListener('click', function() {
                calculateCustomImpact();
            });
        }

        // Generate QR Code
        function generateQRCode() {
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            const qrcode = new QRCode(qrContainer, {
                text: "https://aioxy.com/dpp/AB2024XYZ123",
                width: 150,
                height: 150,
                colorDark: "#1A3C27",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
            });
        }

        // Update dashboard based on selected product
        function updateDashboard(productId) {
            const product = products[productId];
            
            // Calculate impacts
            const impacts = calculateProductImpacts(product);
            
            // Update impact values
            document.getElementById('co2-value').textContent = impacts.co2.toFixed(2) + ' kg';
            document.getElementById('water-value').textContent = impacts.water.toFixed(0) + ' L';
            document.getElementById('land-value').textContent = impacts.land.toFixed(1) + ' m²';
            
            // Update comparison badges (random for demo)
            document.getElementById('co2-comparison').textContent = 
                (Math.random() > 0.5 ? '28% better than avg' : '5% worse than avg');
            document.getElementById('water-comparison').textContent = 
                (Math.random() > 0.5 ? '12% better than avg' : '18% worse than avg');
            document.getElementById('land-comparison').textContent = 
                (Math.random() > 0.5 ? '15% better than avg' : '8% worse than avg');
            
            // Update charts
            updateCharts(impacts);
            
            // Update sustainability story
            updateSustainabilityStory(impacts);
        }

        // Calculate product impacts
        function calculateProductImpacts(product) {
            let totalCo2 = 0;
            let totalWater = 0;
            let totalLand = 0;
            
            // Calculate ingredient impacts
            product.ingredients.forEach(ingredient => {
                const ingData = ingredientData.find(i => i.name === ingredient.name);
                if (ingData) {
                    totalCo2 += ingData.co2 * ingredient.amount;
                    totalWater += ingData.waterBlue * ingredient.amount;
                    totalLand += ingData.land * ingredient.amount;
                }
            });
            
            // Add packaging impact
            const packaging = packagingData.find(p => p.material === product.packaging.material);
            if (packaging) {
                totalCo2 += packaging.co2 * product.packaging.weight;
            }
            
            // Add transport impact
            const transportFactor = getTransportFactor(product.transport.mode);
            totalCo2 += transportFactor * product.transport.distance * product.weight / 1000; // Convert to tons
            
            // Add processing impact (estimated)
            totalCo2 += 0.1 * product.weight; // 0.1 kg CO2 per kg product
            
            return {
                co2: totalCo2,
                water: totalWater,
                land: totalLand,
                breakdown: {
                    ingredients: totalCo2 * 0.7, // Estimate
                    packaging: totalCo2 * 0.1,
                    transport: totalCo2 * 0.15,
                    processing: totalCo2 * 0.05
                }
            };
        }

        // Get transport emission factor
        function getTransportFactor(mode) {
            const factors = {
                'road': 0.075,
                'rail': 0.015,
                'sea': 0.010,
                'air': 0.950
            };
            return factors[mode] || 0.075;
        }

        // Update charts
        function updateCharts(impacts) {
            // CO2 breakdown chart
            const co2Breakdown = [
                { category: 'Ingredients', value: impacts.breakdown.ingredients },
                { category: 'Packaging', value: impacts.breakdown.packaging },
                { category: 'Transport', value: impacts.breakdown.transport },
                { category: 'Processing', value: impacts.breakdown.processing }
            ];
            
            const co2Trace = {
                values: co2Breakdown.map(item => item.value),
                labels: co2Breakdown.map(item => item.category),
                type: 'pie',
                hole: 0.4,
                marker: {
                    colors: ['#2E8B57', '#32CD32', '#90EE90', '#C1E1C1']
                }
            };
            
            Plotly.newPlot('co2-chart', [co2Trace], {
                margin: { t: 0, b: 0, l: 0, r: 0 },
                showlegend: false
            });
            
            // Water breakdown chart
            const waterTrace = {
                x: ['Blue Water', 'Green Water', 'Grey Water'],
                y: [impacts.water, impacts.water * 10, impacts.water * 0.1], // Estimates for demo
                type: 'bar',
                marker: {
                    color: ['#1E90FF', '#32CD32', '#A9A9A9']
                }
            };
            
            Plotly.newPlot('water-chart', [waterTrace], {
                margin: { t: 0, b: 0, l: 0, r: 0 },
                xaxis: { showgrid: false },
                yaxis: { showgrid: false }
            });
            
            // Land use comparison chart
            const landTrace = {
                x: ['This Product', 'Industry Average'],
                y: [impacts.land, impacts.land * 1.15], // Industry average is 15% higher for demo
                type: 'bar',
                marker: {
                    color: ['#2E8B57', '#D3D3D3']
                }
            };
            
            Plotly.newPlot('land-chart', [landTrace], {
                margin: { t: 0, b: 0, l: 0, r: 0 },
                xaxis: { showgrid: false },
                yaxis: { showgrid: false }
            });
            
            // Impact breakdown chart
            const impactBreakdownTrace = {
                x: ['CO₂e (kg)', 'Water (L)', 'Land (m²)'],
                y: [impacts.co2, impacts.water / 100, impacts.land], // Scale water for visualization
                type: 'bar',
                marker: {
                    color: '#2E8B57'
                }
            };
            
            Plotly.newPlot('impact-breakdown-chart', [impactBreakdownTrace], {
                margin: { t: 30, b: 30, l: 50, r: 30 },
                xaxis: { title: 'Impact Category' },
                yaxis: { title: 'Impact Value' }
            });
        }

        // Update sustainability story
        function updateSustainabilityStory(impacts) {
            const co2Savings = impacts.co2 * 0.28; // Assume 28% better than average
            const waterSavings = impacts.water * 0.12; // Assume 12% better than average
            
            const kmDriven = (co2Savings * 1000 / 0.12).toFixed(0); // Convert kg CO2 to km driven
            const smartphones = (co2Savings * 1000 / 0.005).toFixed(0); // Convert kg CO2 to smartphones charged
            const showers = (waterSavings / 50).toFixed(0); // Convert liters to showers
            
            const story = `Choosing this product instead of the conventional alternative saves emissions equivalent to driving ${kmDriven} km, charges ${smartphones} smartphones, and preserves water equivalent to ${showers} showers.`;
            
            document.getElementById('sustainability-story').textContent = story;
        }

        // Calculate custom product impact
        function calculateCustomImpact() {
            const productName = document.getElementById('product-name').value;
            const country = document.getElementById('country-select').value;
            const packagingMaterial = document.getElementById('packaging-select').value;
            const transportDistance = parseInt(document.getElementById('transport-distance').value);
            const transportMode = document.getElementById('transport-mode').value;
            
            // Get ingredient amounts
            const ingredientItems = document.querySelectorAll('#ingredient-list .ingredient-item');
            let totalCo2 = 0;
            let totalWater = 0;
            let totalLand = 0;
            
            ingredientItems.forEach(item => {
                const input = item.querySelector('input');
                const amount = parseFloat(input.value) || 0;
                const ingredientName = item.querySelector('span').textContent;
                
                const ingData = ingredientData.find(i => i.name === ingredientName);
                if (ingData && amount > 0) {
                    totalCo2 += ingData.co2 * amount;
                    totalWater += ingData.waterBlue * amount;
                    totalLand += ingData.land * amount;
                }
            });
            
            // Add packaging impact
            const packaging = packagingData.find(p => p.material === packagingMaterial);
            if (packaging) {
                // Assume 0.05 kg packaging per kg product
                totalCo2 += packaging.co2 * 0.05;
            }
            
            // Add transport impact
            const transportFactor = getTransportFactor(transportMode);
            // Assume 1 kg product weight for calculation
            totalCo2 += transportFactor * transportDistance * 1 / 1000;
            
            // Add processing impact (estimated based on country electricity)
            const countryInfo = countryData.find(c => c.country.includes(country));
            if (countryInfo) {
                // Assume 0.1 kWh per kg product
                const processingCo2 = 0.1 * countryInfo.electricity / 1000; // Convert g to kg
                totalCo2 += processingCo2;
            }
            
            // Update results
            document.getElementById('calc-co2').textContent = totalCo2.toFixed(2) + ' kg';
            document.getElementById('calc-water').textContent = totalWater.toFixed(0) + ' L';
            document.getElementById('calc-land').textContent = totalLand.toFixed(2) + ' m²';
            
            // Show results
            document.getElementById('calculation-results').style.display = 'block';
            
            // Update chart
            const calcTrace = {
                x: ['CO₂e', 'Water', 'Land Use'],
                y: [totalCo2, totalWater / 100, totalLand], // Scale water for visualization
                type: 'bar',
                marker: {
                    color: '#2E8B57'
                }
            };
            
            Plotly.newPlot('calc-chart', [calcTrace], {
                margin: { t: 30, b: 30, l: 50, r: 30 },
                xaxis: { title: 'Impact Category' },
                yaxis: { title: 'Impact Value' }
            });
        }

        // Set up additional interactivity
        document.getElementById('download-passport').addEventListener('click', function() {
            alert('In the full implementation, this would generate and download a PDF passport');
        });

        document.getElementById('copy-story').addEventListener('click', function() {
            const story = document.getElementById('sustainability-story').textContent;
            navigator.clipboard.writeText(story).then(function() {
                alert('Sustainability story copied to clipboard!');
            }, function() {
                alert('Failed to copy story. Please select and copy manually.');
            });
        });
    </script>
</body>
                                    </html>
