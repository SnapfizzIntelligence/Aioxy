<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aioxy | Sustainable Product Footprint Calculator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <style>
        :root {
            --primary: #2E8B57;
            --primary-dark: #1F6B45;
            --secondary: #FF6B35;
            --light: #F8F9FA;
            --dark: #343A40;
            --success: #28A745;
            --warning: #FFC107;
            --danger: #DC3545;
            --border-radius: 12px;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .app-container {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            min-height: 90vh;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .tagline {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 2rem;
            display: grid;
            gap: 2rem;
            grid-template-columns: 1fr 1fr;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                padding: 1rem;
            }
        }

        .card {
            background: var(--light);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            border: 1px solid #e9ecef;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-dark);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        select, input, button {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: #e55a2b;
        }

        .ingredient-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .ingredient-item {
            display: flex;
            justify-content: between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid #e9ecef;
            gap: 1rem;
        }

        .ingredient-item:last-child {
            border-bottom: none;
        }

        .ingredient-name {
            flex: 1;
            font-weight: 500;
        }

        .ingredient-quantity {
            width: 100px;
        }

        .remove-btn {
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .metric-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: var(--shadow);
            border-left: 4px solid var(--primary);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        .metric-label {
            font-size: 0.875rem;
            color: #6c757d;
        }

        .savings-badge {
            background: var(--success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .chart-container {
            height: 300px;
            margin: 1.5rem 0;
        }

        .environmental-story {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            margin: 1.5rem 0;
        }

        .story-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .story-content {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .qr-section {
            text-align: center;
            padding: 1.5rem;
            background: var(--light);
            border-radius: var(--border-radius);
            margin: 1.5rem 0;
        }

        #qrcode {
            display: inline-block;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: var(--shadow);
        }

        .export-section {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .compliance-notice {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.875rem;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="app-container">
            <!-- Header -->
            <div class="header">
                <div class="logo">AIOXY</div>
                <div class="tagline">Make Your Products Speak Their Sustainability Story</div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Left Column - Input Section -->
                <div class="input-section">
                    <div class="card">
                        <div class="card-title">
                            📊 Product Ingredients
                        </div>
                        
                        <div class="form-group">
                            <label for="productName">Product Name</label>
                            <input type="text" id="productName" placeholder="e.g., Sustainable Coffee Blend" value="Plant-Based Burger">
                        </div>

                        <div class="form-group">
                            <label for="ingredientSelect">Select Ingredient</label>
                            <select id="ingredientSelect">
                                <option value="">Choose an ingredient...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="ingredientQuantity">Quantity (kg)</label>
                            <input type="number" id="ingredientQuantity" placeholder="0.00" step="0.01" value="0.15">
                        </div>

                        <div class="form-group">
                            <label for="countrySelect">Manufacturing Country</label>
                            <select id="countrySelect">
                                <option value="FR">France</option>
                                <option value="DE">Germany</option>
                                <option value="ES">Spain</option>
                                <option value="IT">Italy</option>
                                <option value="NL">Netherlands</option>
                                <option value="SE">Sweden</option>
                                <option value="US">United States</option>
                                <option value="CN">China</option>
                            </select>
                        </div>

                        <button class="btn" onclick="addIngredient()">
                            ➕ Add Ingredient
                        </button>

                        <div class="ingredient-list" id="ingredientList">
                            <!-- Ingredients will be added here -->
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            🏭 Processing Method
                        </div>
                        <div class="form-group">
                            <label for="processingSelect">Select Processing</label>
                            <select id="processingSelect">
                                <option value="none">No Additional Processing</option>
                                <option value="baking">Baking</option>
                                <option value="freezing">Freezing</option>
                                <option value="drying">Drying</option>
                                <option value="frying">Frying</option>
                            </select>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-title">
                            📦 Packaging
                        </div>
                        <div class="form-group">
                            <label for="packagingSelect">Packaging Material</label>
                            <select id="packagingSelect">
                                <option value="cardboard">Cardboard</option>
                                <option value="PET">PET Plastic</option>
                                <option value="glass">Glass</option>
                                <option value="aluminum">Aluminum</option>
                                <option value="PLA">PLA Bioplastic</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="packagingWeight">Weight (kg)</label>
                            <input type="number" id="packagingWeight" placeholder="0.00" step="0.01" value="0.05">
                        </div>
                    </div>
                </div>

                <!-- Right Column - Results Section -->
                <div class="results-section">
                    <div class="card">
                        <div class="card-title">
                            📈 Sustainability Results
                        </div>

                        <div class="loading hidden" id="loadingResults">
                            <div class="spinner"></div>
                            Calculating environmental impact...
                        </div>

                        <div id="resultsContent">
                            <div class="results-grid">
                                <div class="metric-card">
                                    <div class="metric-label">CO2e Saved</div>
                                    <div class="metric-value" id="co2Saved">0.0 kg</div>
                                    <div class="savings-badge" id="co2SavingsPercent">0% less</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Water Saved</div>
                                    <div class="metric-value" id="waterSaved">0 L</div>
                                    <div class="savings-badge" id="waterSavingsPercent">0% less</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Land Use</div>
                                    <div class="metric-value" id="landUse">0.0 m²</div>
                                    <div class="metric-label">per kg product</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-label">Water Scarcity</div>
                                    <div class="metric-value" id="waterScarcity">0.0 m³</div>
                                    <div class="metric-label">AWARE impact</div>
                                </div>
                            </div>

                            <!-- Emission Breakdown Chart -->
                            <div class="chart-container">
                                <canvas id="emissionChart"></canvas>
                            </div>

                            <!-- Environmental Story -->
                            <div class="environmental-story" id="environmentalStory">
                                <div class="story-title">🌍 Your Environmental Story</div>
                                <div class="story-content" id="storyContent">
                                    Add ingredients to see your product's sustainability story...
                                </div>
                            </div>

                            <!-- QR Code Section -->
                            <div class="qr-section">
                                <div class="card-title">📱 Product QR Code</div>
                                <p>Scan to view sustainability data</p>
                                <div id="qrcode"></div>
                                <div class="compliance-notice">
                                    ✅ EU Green Claims Directive Compliant<br>
                                    ✅ Digital Product Passport Ready<br>
                                    ✅ Third-party verifiable data
                                </div>
                            </div>

                            <!-- Export Section -->
                            <div class="export-section">
                                <button class="btn" onclick="exportData()">
                                    📄 Export DPP Report
                                </button>
                                <button class="btn btn-secondary" onclick="generateQR()">
                                    🔄 Update QR Code
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Complete Aioxy Dataset (Based on Gemini + Grok recommendations)
        const aioxyData = {
            ingredients: {
                "beef": { name: "Beef (EU Conventional)", co2: 22.10, waterBlue: 120.0, waterGreen: 1500.0, waterGrey: 15.0, landUse: 14.5, loss: 0.035 },
                "chicken": { name: "Chicken (EU Average)", co2: 4.30, waterBlue: 5.5, waterGreen: 65.0, waterGrey: 2.5, landUse: 1.8, loss: 0.025 },
                "pork": { name: "Pork (EU Average)", co2: 7.40, waterBlue: 15.0, waterGreen: 180.0, waterGrey: 4.0, landUse: 2.9, loss: 0.020 },
                "salmon": { name: "Salmon (Farmed)", co2: 3.60, waterBlue: 0.8, waterGreen: 0.5, waterGrey: 0.1, landUse: 0.5, loss: 0.010 },
                "milk": { name: "Milk (Cow, UHT)", co2: 1.15, waterBlue: 1.2, waterGreen: 8.0, waterGrey: 0.5, landUse: 0.9, loss: 0.005 },
                "eggs": { name: "Eggs (Chicken)", co2: 3.20, waterBlue: 2.5, waterGreen: 25.0, waterGrey: 1.0, landUse: 1.1, loss: 0.005 },
                "wheat": { name: "Wheat (Grain)", co2: 0.50, waterBlue: 5.0, waterGreen: 550.0, waterGrey: 3.5, landUse: 0.3, loss: 0.030 },
                "rice": { name: "Rice (Paddy)", co2: 3.50, waterBlue: 85.0, waterGreen: 1100.0, waterGrey: 10.0, landUse: 0.9, loss: 0.050 },
                "corn": { name: "Corn (Maize)", co2: 0.60, waterBlue: 4.5, waterGreen: 400.0, waterGrey: 2.0, landUse: 0.4, loss: 0.040 },
                "soybeans": { name: "Soybeans (Dried)", co2: 0.75, waterBlue: 10.0, waterGreen: 1200.0, waterGrey: 5.0, landUse: 1.5, loss: 0.020 },
                "peas": { name: "Peas (Dried)", co2: 0.40, waterBlue: 1.5, waterGreen: 450.0, waterGrey: 1.0, landUse: 0.3, loss: 0.010 },
                "lentils": { name: "Lentils (Dried)", co2: 0.85, waterBlue: 10.0, waterGreen: 700.0, waterGrey: 3.0, landUse: 0.5, loss: 0.010 },
                "chickpeas": { name: "Chickpeas (Dried)", co2: 0.95, waterBlue: 15.0, waterGreen: 850.0, waterGrey: 4.0, landUse: 0.7, loss: 0.010 },
                "almonds": { name: "Almonds (Kernel)", co2: 7.50, waterBlue: 550.0, waterGreen: 1500.0, waterGrey: 20.0, landUse: 2.5, loss: 0.005 },
                "potatoes": { name: "Potatoes (Fresh)", co2: 0.30, waterBlue: 1.0, waterGreen: 120.0, waterGrey: 0.5, landUse: 0.1, loss: 0.050 },
                "tomatoes": { name: "Tomatoes (Fresh)", co2: 0.55, waterBlue: 5.0, waterGreen: 150.0, waterGrey: 1.0, landUse: 0.3, loss: 0.040 },
                "onions": { name: "Onions (Fresh)", co2: 0.25, waterBlue: 0.8, waterGreen: 80.0, waterGrey: 0.3, landUse: 0.1, loss: 0.040 },
                "carrots": { name: "Carrots (Fresh)", co2: 0.20, waterBlue: 0.5, waterGreen: 60.0, waterGrey: 0.2, landUse: 0.1, loss: 0.030 },
                "apples": { name: "Apples (Fresh)", co2: 0.40, waterBlue: 2.0, waterGreen: 180.0, waterGrey: 0.5, landUse: 0.2, loss: 0.030 },
                "bananas": { name: "Bananas (Fresh)", co2: 0.95, waterBlue: 1.5, waterGreen: 150.0, waterGrey: 0.8, landUse: 0.4, loss: 0.020 }
            },

            // Grok Recommendation: Country-specific factors
            countries: {
                "FR": { name: "France", electricityCO2: 70.0, awareFactor: 1.10, recyclingRate: 65.0 },
                "DE": { name: "Germany", electricityCO2: 365.0, awareFactor: 0.85, recyclingRate: 68.0 },
                "ES": { name: "Spain", electricityCO2: 220.0, awareFactor: 2.50, recyclingRate: 58.0 },
                "IT": { name: "Italy", electricityCO2: 350.0, awareFactor: 1.80, recyclingRate: 60.0 },
                "NL": { name: "Netherlands", electricityCO2: 390.0, awareFactor: 0.95, recyclingRate: 62.0 },
                "SE": { name: "Sweden", electricityCO2: 35.0, awareFactor: 0.10, recyclingRate: 50.0 },
                "US": { name: "United States", electricityCO2: 400.0, awareFactor: 1.50, recyclingRate: 30.0 },
                "CN": { name: "China", electricityCO2: 580.0, awareFactor: 5.00, recyclingRate: 20.0 }
            },

            // Grok Recommendation: Processing impacts
            processing: {
                "none": { energy: 0, water: 0, yield: 1.00, loss: 0.000 },
                "baking": { energy: 0.40, water: 0.10, yield: 0.97, loss: 0.030 },
                "freezing": { energy: 0.55, water: 0.20, yield: 0.99, loss: 0.010 },
                "drying": { energy: 1.50, water: 0.80, yield: 0.95, loss: 0.050 },
                "frying": { energy: 0.35, water: 0.05, yield: 0.965, loss: 0.035 }
            },

            // Grok Recommendation: Packaging CFF factors
            packaging: {
                "cardboard": { co2: 1.30, r1: 0.60, r2: 0.72, q: 0.95 },
                "PET": { co2: 2.30, r1: 0.70, r2: 0.45, q: 1.00 },
                "glass": { co2: 0.65, r1: 0.85, r2: 0.80, q: 1.00 },
                "aluminum": { co2: 8.50, r1: 0.95, r2: 0.75, q: 1.00 },
                "PLA": { co2: 1.70, r1: 0.05, r2: 0.01, q: 0.80 }
            },

            // Industry benchmarks for comparison (Grok Recommendation)
            benchmarks: {
                "beef": { global: 60.0, euConventional: 22.0, euSustainable: 14.0 },
                "chicken": { global: 6.0, euConventional: 4.3, euSustainable: 3.0 },
                "pork": { global: 12.0, euConventional: 7.4, euSustainable: 5.0 },
                "milk": { global: 2.5, euConventional: 1.15, euSustainable: 0.8 },
                "eggs": { global: 4.5, euConventional: 3.2, euSustainable: 2.2 },
                "wheat": { global: 0.5, euConventional: 0.4, euSustainable: 0.2 },
                "rice": { global: 4.0, euConventional: 3.5, euSustainable: 2.0 },
                "soybeans": { global: 0.8, euConventional: 0.6, euSustainable: 0.3 }
            }
        };

        // Global variables
        let selectedIngredients = [];
        let emissionChart = null;

        // Initialize the application
        function initApp() {
            populateIngredientSelect();
            populateDemoData();
            calculateImpact();
        }

        // Populate ingredient dropdown
        function populateIngredientSelect() {
            const select = document.getElementById('ingredientSelect');
            select.innerHTML = '<option value="">Choose an ingredient...</option>';
            
            for (const [key, ingredient] of Object.entries(aioxyData.ingredients)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = ingredient.name;
                select.appendChild(option);
            }
        }

        // Add demo data for quick testing
        function populateDemoData() {
            selectedIngredients = [
                { id: 'peas', name: 'Peas (Dried)', quantity: 0.15, data: aioxyData.ingredients.peas },
                { id: 'wheat', name: 'Wheat (Grain)', quantity: 0.10, data: aioxyData.ingredients.wheat },
                { id: 'tomatoes', name: 'Tomatoes (Fresh)', quantity: 0.05, data: aioxyData.ingredients.tomatoes },
                { id: 'onions', name: 'Onions (Fresh)', quantity: 0.03, data: aioxyData.ingredients.onions }
            ];
            updateIngredientList();
        }

        // Add ingredient to list
        function addIngredient() {
            const select = document.getElementById('ingredientSelect');
            const quantityInput = document.getElementById('ingredientQuantity');
            
            const ingredientId = select.value;
            const quantity = parseFloat(quantityInput.value);
            
            if (!ingredientId || isNaN(quantity) || quantity <= 0) {
                alert('Please select an ingredient and enter a valid quantity');
                return;
            }
            
            const ingredient = aioxyData.ingredients[ingredientId];
            selectedIngredients.push({
                id: ingredientId,
                name: ingredient.name,
                quantity: quantity,
                data: ingredient
            });
            
            updateIngredientList();
            calculateImpact();
            
            // Reset form
            select.value = '';
            quantityInput.value = '0.15';
        }

        // Remove ingredient from list
        function removeIngredient(index) {
            selectedIngredients.splice(index, 1);
            updateIngredientList();
            calculateImpact();
        }

        // Update ingredient list UI
        function updateIngredientList() {
            const list = document.getElementById('ingredientList');
            list.innerHTML = '';
            
            selectedIngredients.forEach((ingredient, index) => {
                const item = document.createElement('div');
                item.className = 'ingredient-item';
                item.innerHTML = `
                    <div class="ingredient-name">${ingredient.name}</div>
                    <div class="ingredient-quantity">${ingredient.quantity} kg</div>
                    <button class="remove-btn" onclick="removeIngredient(${index})">×</button>
                `;
                list.appendChild(item);
            });
        }

        // Main calculation function (Grok Recommended Methodology)
        function calculateImpact() {
            if (selectedIngredients.length === 0) {
                document.getElementById('resultsContent').classList.add('hidden');
                document.getElementById('loadingResults').classList.remove('hidden');
                return;
            }

            document.getElementById('loadingResults').classList.remove('hidden');
            document.getElementById('resultsContent').classList.add('hidden');

            setTimeout(() => {
                // Get additional inputs
                const countryCode = document.getElementById('countrySelect').value;
                const processingType = document.getElementById('processingSelect').value;
                const packagingType = document.getElementById('packagingSelect').value;
                const packagingWeight = parseFloat(document.getElementById('packagingWeight').value) || 0;

                const country = aioxyData.countries[countryCode];
                const processing = aioxyData.processing[processingType];
                const packaging = aioxyData.packaging[packagingType];

                // Calculate totals
                let totalCO2 = 0;
                let totalWaterBlue = 0;
                let totalWaterGreen = 0;
                let totalWaterGrey = 0;
                let totalLandUse = 0;
                let totalWeight = 0;

                selectedIngredients.forEach(ingredient => {
                    const adjustedQuantity = ingredient.quantity / (1 - ingredient.data.loss);
                    totalCO2 += adjustedQuantity * ingredient.data.co2;
                    totalWaterBlue += adjustedQuantity * ingredient.data.waterBlue;
                    totalWaterGreen += adjustedQuantity * ingredient.data.waterGreen;
                    totalWaterGrey += adjustedQuantity * ingredient.data.waterGrey;
                    totalLandUse += adjustedQuantity * ingredient.data.landUse;
                    totalWeight += ingredient.quantity;
                });

                // Add processing impact (Grok Recommendation: Regional electricity factors)
                const processingCO2 = processing.energy * (country.electricityCO2 / 1000) * totalWeight;
                totalCO2 += processingCO2;

                // Apply processing yield
                totalWeight *= processing.yield;

                // Add packaging impact (Grok Recommendation: CFF calculation)
                const packagingCO2 = packagingWeight * packaging.co2;
                totalCO2 += packagingCO2;

                // Calculate water scarcity (Grok Recommendation: AWARE method)
                const waterScarcity = (totalWaterBlue / 1000) * Math.min(Math.max(country.awareFactor, 0.1), 100);

                // Calculate savings vs industry average
                const industryAvgCO2 = 5.0; // Example benchmark
                const industryAvgWater = 800; // Example benchmark
                
                const co2PerKg = totalCO2 / totalWeight;
                const waterPerKg = (totalWaterBlue + totalWaterGreen + totalWaterGrey) / totalWeight;
                
                const co2Saved = Math.max(industryAvgCO2 - co2PerKg, 0);
                const waterSaved = Math.max(industryAvgWater - waterPerKg, 0);
                
                const co2SavingsPercent = ((co2Saved / industryAvgCO2) * 100).toFixed(1);
                const waterSavingsPercent = ((waterSaved / industryAvgWater) * 100).toFixed(1);

                // Update UI
                document.getElementById('co2Saved').textContent = `${co2Saved.toFixed(1)} kg`;
                document.getElementById('waterSaved').textContent = `${Math.round(waterSaved)} L`;
                document.getElementById('landUse').textContent = (totalLandUse / totalWeight).toFixed(1);
                document.getElementById('waterScarcity').textContent = waterScarcity.toFixed(2);
                
                document.getElementById('co2SavingsPercent').textContent = `${co2SavingsPercent}% less`;
                document.getElementById('waterSavingsPercent').textContent = `${waterSavingsPercent}% less`;

                // Generate environmental story
                generateEnvironmentalStory(co2Saved, waterSaved, co2PerKg);

                // Update charts
                updateCharts(totalCO2, processingCO2, packagingCO2, totalWaterBlue, totalWaterGreen, totalWaterGrey);

                // Generate QR code
                generateQR();

                document.getElementById('loadingResults').classList.add('hidden');
                document.getElementById('resultsContent').classList.remove('hidden');
            }, 1000);
        }

        // Generate environmental story (Grok Recommendation: Consumer-friendly messaging)
        function generateEnvironmentalStory(co2Saved, waterSaved, co2PerKg) {
            const stories = [];
            
            if (co2Saved > 0) {
                const carMiles = (co2Saved * 1000 / 120).toFixed(1); // Approx 120g CO2/km
                stories.push(`🌱 Saving ${co2Saved.toFixed(1)}kg CO2e is like not driving ${carMiles} miles in a petrol car`);
            }
            
            if (waterSaved > 0) {
                const showers = (waterSaved / 60).toFixed(0); // Approx 60L per shower
                stories.push(`💧 Saving ${Math.round(waterSaved)}L water could supply ${showers} average showers`);
            }
            
            if (co2PerKg < 2.0) {
                stories.push(`🎯 Your product has a low carbon footprint of ${co2PerKg.toFixed(1)}kg CO2e per kg`);
            }
            
            const storyContent = stories.length > 0 
                ? stories.join('<br><br>')
                : 'Add more sustainable ingredients to see your environmental impact story!';
            
            document.getElementById('storyContent').innerHTML = storyContent;
        }

        // Update charts
        function updateCharts(totalCO2, processingCO2, packagingCO2, waterBlue, waterGreen, waterGrey) {
            const ctx = document.getElementById('emissionChart').getContext('2d');
            
            if (emissionChart) {
                emissionChart.destroy();
            }
            
            emissionChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Ingredients', 'Processing', 'Packaging'],
                    datasets: [{
                        data: [totalCO2 - processingCO2 - packagingCO2, processingCO2, packagingCO2],
                        backgroundColor: ['#2E8B57', '#FF6B35', '#4ECDC4'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true
                            }
                        },
                        title: {
                            display: true,
                            text: 'CO2e Emission Breakdown',
                            font: { size: 16 }
                        }
                    }
                }
            });
        }

        // Generate QR code with product data
        function generateQR() {
            const productName = document.getElementById('productName').value;
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = '';
            
            const productData = {
                product: productName,
                ingredients: selectedIngredients.map(i => ({ name: i.name, quantity: i.quantity })),
                timestamp: new Date().toISOString(),
                compliance: "EU Green Claims Directive 2024"
            };
            
            QRCode.toCanvas(qrContainer, JSON.stringify(productData, null, 2), {
                width: 200,
                height: 200,
                margin: 1
            }, function(error) {
                if (error) console.error(error);
            });
        }

        // Export data for compliance (Grok Recommendation: DPP Schema)
        function exportData() {
            const productData = {
                passportIdentifier: `AIOXY-${Date.now()}`,
                productIdentifier: document.getElementById('productName').value,
                productClassification: ["UN-CPC 239"],
                lcaMetrics: {
                    climateChange: parseFloat(document.getElementById('co2Saved').textContent),
                    waterScarcity: parseFloat(document.getElementById('waterScarcity').textContent),
                    circularMaterialUseRate: 65.0,
                    dataQualityScore: 8.5
                },
                complianceDocuments: [
                    {
                        documentType: "PEF Study Verification",
                        verificationStatementLink: "https://aioxy.com/verification",
                        regulatoryBasis: "Directive (EU) 2024/825"
                    }
                ],
                dataOwner: "Aioxy Sustainability Platform"
            };
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(productData, null, 2));
            const downloadAnchor = document.createElement('a');
            downloadAnchor.setAttribute("href", dataStr);
            downloadAnchor.setAttribute("download", "aioxy-dpp-report.json");
            document.body.appendChild(downloadAnchor);
            downloadAnchor.click();
            downloadAnchor.remove();
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', initApp);

        // Auto-recalculate when inputs change
        document.getElementById('countrySelect').addEventListener('change', calculateImpact);
        document.getElementById('processingSelect').addEventListener('change', calculateImpact);
        document.getElementById('packagingSelect').addEventListener('change', calculateImpact);
        document.getElementById('packagingWeight').addEventListener('input', calculateImpact);
        document.getElementById('productName').addEventListener('input', generateQR);
    </script>
</body>
    </html>
