<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AIOXY Regulatory Transparency Engine v1.0 – Public Demo</title>
    <style>
        body {
            background-color: #1a1a1a;
            color: #ffffff;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            background-color: #2a2a2a;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        select, input, button {
            background-color: #3a3a3a;
            color: #ffffff;
            border: 1px solid #4a4a4a;
            padding: 8px;
            border-radius: 5px;
        }
        button {
            cursor: pointer;
        }
        #password-prompt {
            text-align: center;
            margin-top: 100px;
        }
        #dashboard {
            display: none;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
        }
        canvas {
            background-color: #1a1a1a;
        }
    </style>
</head>
<body>
    <div id="password-prompt" class="container">
        <input type="password" id="password" placeholder="Enter password">
        <button onclick="checkPassword()">Submit</button>
    </div>
    <div id="dashboard" class="container">
        <h1>AIOXY Regulatory Transparency Engine v1.0 – Public Demo</h1>
        <div>
            <label for="product-select">Product:</label>
            <select id="product-select">
                <option value="Beef Burger">Beef Burger</option>
                <option value="Oat Milk">Oat Milk</option>
                <option value="Vegan Patty">Vegan Patty</option>
            </select>
            <label for="country-select">Country:</label>
            <select id="country-select">
                <option value="DE (Germany)">Germany</option>
                <option value="FR (France)">France</option>
                <option value="IT (Italy)">Italy</option>
                <option value="ES (Spain)">Spain</option>
                <option value="NL (Netherlands)">Netherlands</option>
                <option value="PL (Poland)">Poland</option>
                <option value="SE (Sweden)">Sweden</option>
                <option value="DK (Denmark)">Denmark</option>
                <option value="BE (Belgium)">Belgium</option>
                <option value="UK (United Kingdom)">United Kingdom</option>
                <option value="IE (Ireland)">Ireland</option>
                <option value="AT (Austria)">Austria</option>
                <option value="FI (Finland)">Finland</option>
                <option value="PT (Portugal)">Portugal</option>
                <option value="GR (Greece)">Greece</option>
                <option value="US (United States)">United States</option>
                <option value="CA (Canada)">Canada</option>
                <option value="AU (Australia)">Australia</option>
                <option value="JP (Japan)">Japan</option>
                <option value="CN (China)">China</option>
                <option value="IN (India)">India</option>
                <option value="BR (Brazil)">Brazil</option>
            </select>
            <label>Sustainable Scenario: <input type="checkbox" id="sustainable-toggle"></label>
        </div>
        <div class="card">
            <h2>Impact Breakdown</h2>
            <canvas id="pieChart" width="400" height="400"></canvas>
        </div>
        <div class="card">
            <h2>Comparison vs Industry Benchmarks</h2>
            <canvas id="barChart" width="400" height="400"></canvas>
        </div>
        <div class="card" id="story">
            <h2>Storytelling Summary</h2>
        </div>
        <div class="card" id="qr">
            <h2>Digital Product Passport QR Code</h2>
        </div>
        <div class="footer">
            AIOXY Logo Placeholder
            <p>AIOXY Regulatory Transparency Engine v1.0 – Public Demo</p>
        </div>
    </div>
    <script>
        // Embed qrcode.js here (minified code would go here; for this example, assume it's loaded or use placeholder)
        // For real implementation, include the full minified code from https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js
        // Placeholder for QRCode class
        // var QRCode = ... ;

        // To make it work without the library, we'll use a placeholder text for QR
        function generateQRPlaceholder(data) {
            const qrDiv = document.getElementById('qr');
            qrDiv.innerHTML = '<p>QR Code Placeholder: ' + data + '</p>'; // Replace with actual QR generation
        }

        // Piechart class from snippet
        class Piechart {
            constructor(options) {
                this.options = options;
                this.canvas = options.canvas;
                this.ctx = this.canvas.getContext('2d');
                this.colors = options.colors;
            }
            draw() {
                let total_value = 0;
                let color_index = 0;
                for (let categ in this.options.data) {
                    let val = this.options.data[categ];
                    total_value += val;
                }
                let start_angle = 0;
                for (let categ in this.options.data) {
                    let val = this.options.data[categ];
                    let slice_angle = 2 * Math.PI * val / total_value;
                    this.drawPieSlice(
                        this.ctx,
                        this.canvas.width / 2,
                        this.canvas.height / 2,
                        Math.min(this.canvas.width / 2, this.canvas.height / 2),
                        start_angle,
                        start_angle + slice_angle,
                        this.colors[color_index % this.colors.length]
                    );
                    start_angle += slice_angle;
                    color_index++;
                }
            }
            drawPieSlice(ctx, centerX, centerY, radius, startAngle, endAngle, color) {
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, endAngle);
                ctx.closePath();
                ctx.fill();
            }
        }

        // Barchart class from snippet
        class Barchart {
            constructor(options) {
                this.options = options;
                this.canvas = options.canvas;
                this.ctx = this.canvas.getContext('2d');
                this.colors = options.colors;
                this.options.padding = 20;
                this.options.gridLineWidth = 1;
            }
            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                let maxValue = 0;
                for (let categ in this.options.data) {
                    maxValue = Math.max(maxValue, this.options.data[categ]);
                }
                let canvasActualHeight = this.canvas.height - this.options.padding * 2;
                let canvasActualWidth = this.canvas.width - this.options.padding * 2;
                let barIndex = 0;
                let numberOfBars = Object.keys(this.options.data).length;
                let barSize = canvasActualWidth / numberOfBars;
                for (let categ in this.options.data) {
                    let val = this.options.data[categ];
                    let barHeight = Math.round(canvasActualHeight * val / maxValue);
                    this.ctx.fillStyle = this.colors[barIndex % this.colors.length];
                    this.ctx.fillRect(
                        this.options.padding + barIndex * barSize,
                        this.canvas.height - barHeight - this.options.padding,
                        barSize - 10, // add some padding between bars
                        barHeight
                    );
                    barIndex++;
                }
                // Draw axes
                this.ctx.strokeStyle = "#ffffff";
                this.ctx.beginPath();
                this.ctx.moveTo(this.options.padding, this.options.padding);
                this.ctx.lineTo(this.options.padding, this.canvas.height - this.options.padding);
                this.ctx.lineTo(this.canvas.width - this.options.padding, this.canvas.height - this.options.padding);
                this.ctx.stroke();
            }
        }

        // Data from Gemini response
        const ingredients = [
            {name: "Beef (Cattle, EU Conventional)", co2e: 22.10, waterBlue: 120.0, waterGreen: 1500.0, waterGrey: 15.0, landUse: 14.5, source: "AGRIBALYSE 3.2 LCI ID: CATT_001", allocation: "Economic", regionalFactor: "EU Average (PEF Default)", foodLoss: 3.5},
            {name: "Chicken (Broiler, EU Average)", co2e: 4.30, waterBlue: 5.5, waterGreen: 65.0, waterGrey: 2.5, landUse: 1.8, source: "AGRIBALYSE 3.2 LCI ID: POUL_002", allocation: "Economic/Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 2.5},
            {name: "Pork (Pig, EU Average)", co2e: 7.40, waterBlue: 15.0, waterGreen: 180.0, waterGrey: 4.0, landUse: 2.9, source: "AGRIBALYSE 3.2 LCI ID: PIG_001", allocation: "Economic", regionalFactor: "EU Average (PEF Default)", foodLoss: 2.0},
            {name: "Salmon (Farmed)", co2e: 3.60, waterBlue: 0.8, waterGreen: 0.5, waterGrey: 0.1, landUse: 0.5, source: "JRC EF 3.2 LCI ID: AQUA_005", allocation: "Economic", regionalFactor: "EU Average (PEF Default)", foodLoss: 1.0},
            {name: "Milk (Cow, UHT)", co2e: 1.15, waterBlue: 1.2, waterGreen: 8.0, waterGrey: 0.5, landUse: 0.9, source: "AGRIBALYSE 3.2 LCI ID: DAIRY_010", allocation: "Economic", regionalFactor: "EU Average (PEF Default)", foodLoss: 0.5},
            {name: "Eggs (Chicken)", co2e: 3.20, waterBlue: 2.5, waterGreen: 25.0, waterGrey: 1.0, landUse: 1.1, source: "AGRIBALYSE 3.2 LCI ID: EGG_003", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 0.5},
            {name: "Wheat (Grain)", co2e: 0.50, waterBlue: 5.0, waterGreen: 550.0, waterGrey: 3.5, landUse: 0.3, source: "AGRIBALYSE 3.2 LCI ID: CEREAL_001", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 3.0},
            {name: "Rice (Paddy)", co2e: 3.50, waterBlue: 85.0, waterGreen: 1100.0, waterGrey: 10.0, landUse: 0.9, source: "AGRIBALYSE 3.2 LCI ID: CEREAL_015", allocation: "Mass", regionalFactor: "Imported (WFLDB Background Data)", foodLoss: 5.0},
            {name: "Corn (Maize)", co2e: 0.60, waterBlue: 4.5, waterGreen: 400.0, waterGrey: 2.0, landUse: 0.4, source: "AGRIBALYSE 3.2 LCI ID: CEREAL_005", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 4.0},
            {name: "Oats (Grain)", co2e: 0.45, waterBlue: 3.0, waterGreen: 350.0, waterGrey: 1.5, landUse: 0.2, source: "AGRIBALYSE 3.2 LCI ID: CEREAL_011", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 3.0},
            {name: "Soybeans (Dried)", co2e: 0.75, waterBlue: 10.0, waterGreen: 1200.0, waterGrey: 5.0, landUse: 1.5, source: "AGRIBALYSE 3.2 LCI ID: PULSE_001", allocation: "Economic", regionalFactor: "Imported (WFLDB Background Data)", foodLoss: 2.0},
            {name: "Peas (Dried)", co2e: 0.40, waterBlue: 1.5, waterGreen: 450.0, waterGrey: 1.0, landUse: 0.3, source: "AGRIBALYSE 3.2 LCI ID: PULSE_004", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 1.0},
            {name: "Lentils (Dried)", co2e: 0.85, waterBlue: 10.0, waterGreen: 700.0, waterGrey: 3.0, landUse: 0.5, source: "AGRIBALYSE 3.2 LCI ID: PULSE_008", allocation: "Mass", regionalFactor: "Imported (Ecoinvent Background Data)", foodLoss: 1.0},
            {name: "Chickpeas (Dried)", co2e: 0.95, waterBlue: 15.0, waterGreen: 850.0, waterGrey: 4.0, landUse: 0.7, source: "AGRIBALYSE 3.2 LCI ID: PULSE_006", allocation: "Mass", regionalFactor: "Imported (Ecoinvent Background Data)", foodLoss: 1.0},
            {name: "Almonds (Kernel)", co2e: 7.50, waterBlue: 550.0, waterGreen: 1500.0, waterGrey: 20.0, landUse: 2.5, source: "JRC EF 3.2 LCI ID: NUTS_001", allocation: "Mass", regionalFactor: "Imported (WFLDB Background Data)", foodLoss: 0.5},
            {name: "Potatoes (Fresh)", co2e: 0.30, waterBlue: 1.0, waterGreen: 120.0, waterGrey: 0.5, landUse: 0.1, source: "AGRIBALYSE 3.2 LCI ID: VEG_001", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 5.0},
            {name: "Tomatoes (Fresh, Field)", co2e: 0.55, waterBlue: 5.0, waterGreen: 150.0, waterGrey: 1.0, landUse: 0.3, source: "AGRIBALYSE 3.2 LCI ID: VEG_010", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 4.0},
            {name: "Onions (Fresh)", co2e: 0.25, waterBlue: 0.8, waterGreen: 80.0, waterGrey: 0.3, landUse: 0.1, source: "AGRIBALYSE 3.2 LCI ID: VEG_005", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 4.0},
            {name: "Carrots (Fresh)", co2e: 0.20, waterBlue: 0.5, waterGreen: 60.0, waterGrey: 0.2, landUse: 0.1, source: "AGRIBALYSE 3.2 LCI ID: VEG_003", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 3.0},
            {name: "Apples (Fresh)", co2e: 0.40, waterBlue: 2.0, waterGreen: 180.0, waterGrey: 0.5, landUse: 0.2, source: "AGRIBALYSE 3.2 LCI ID: FRUIT_001", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 3.0},
            {name: "Bananas (Fresh)", co2e: 0.95, waterBlue: 1.5, waterGreen: 150.0, waterGrey: 0.8, landUse: 0.4, source: "JRC EF 3.2 LCI ID: FRUIT_003", allocation: "Mass", regionalFactor: "Imported (Ecoinvent Background Data)", foodLoss: 2.0},
            {name: "Oranges (Fresh)", co2e: 0.50, waterBlue: 3.0, waterGreen: 200.0, waterGrey: 1.0, landUse: 0.3, source: "AGRIBALYSE 3.2 LCI ID: FRUIT_005", allocation: "Mass", regionalFactor: "Imported (Ecoinvent Background Data)", foodLoss: 2.0},
            {name: "Berries (Mixed, Fresh)", co2e: 1.80, waterBlue: 10.0, waterGreen: 300.0, waterGrey: 5.0, landUse: 0.6, source: "AGRIBALYSE 3.2 LCI ID: FRUIT_008", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 5.0},
            {name: "Palm Oil (Crude)", co2e: 3.50, waterBlue: 15.0, waterGreen: 200.0, waterGrey: 5.0, landUse: 3.0, source: "JRC EF 3.2 LCI ID: OIL_001", allocation: "Mass", regionalFactor: "Imported (Ecoinvent Background Data)", foodLoss: 1.0},
            {name: "Olive Oil", co2e: 6.00, waterBlue: 120.0, waterGreen: 1500.0, waterGrey: 8.0, landUse: 4.0, source: "AGRIBALYSE 3.2 LCI ID: OIL_005", allocation: "Economic", regionalFactor: "EU Average (PEF Default)", foodLoss: 1.0},
            {name: "Sunflower Oil", co2e: 1.50, waterBlue: 5.0, waterGreen: 500.0, waterGrey: 2.5, landUse: 0.8, source: "AGRIBALYSE 3.2 LCI ID: OIL_002", allocation: "Economic", regionalFactor: "EU Average (PEF Default)", foodLoss: 1.0},
            {name: "Sugar Cane", co2e: 0.70, waterBlue: 80.0, waterGreen: 1000.0, waterGrey: 6.0, landUse: 0.5, source: "JRC EF 3.2 LCI ID: SUGAR_001", allocation: "Mass", regionalFactor: "Imported (WFLDB Background Data)", foodLoss: 3.0},
            {name: "Sugar Beet", co2e: 0.60, waterBlue: 5.0, waterGreen: 400.0, waterGrey: 2.0, landUse: 0.3, source: "AGRIBALYSE 3.2 LCI ID: SUGAR_003", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 2.0},
            {name: "Honey", co2e: 1.30, waterBlue: 1.0, waterGreen: 20.0, waterGrey: 0.1, landUse: 0.5, source: "AGRIBALYSE 3.2 LCI ID: OTHER_001", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 0.5},
            {name: "Coffee (Roasted)", co2e: 17.50, waterBlue: 80.0, waterGreen: 1500.0, waterGrey: 12.0, landUse: 8.0, source: "JRC EF 3.2 LCI ID: OTHER_005", allocation: "Mass", regionalFactor: "Imported (Ecoinvent Background Data)", foodLoss: 1.0},
            {name: "Cocoa (Powder)", co2e: 22.50, waterBlue: 150.0, waterGreen: 2500.0, waterGrey: 18.0, landUse: 12.0, source: "JRC EF 3.2 LCI ID: OTHER_007", allocation: "Economic", regionalFactor: "Imported (WFLDB Background Data)", foodLoss: 1.0},
            {name: "Tea (Black, Dried)", co2e: 2.20, waterBlue: 5.0, waterGreen: 400.0, waterGrey: 3.0, landUse: 0.8, source: "JRC EF 3.2 LCI ID: OTHER_009", allocation: "Mass", regionalFactor: "Imported (Ecoinvent Background Data)", foodLoss: 0.5},
            {name: "Salt", co2e: 0.01, waterBlue: 0.0, waterGreen: 0.0, waterGrey: 0.0, landUse: 0.0, source: "JRC EF 3.2 LCI ID: OTHER_010", allocation: "Mass", regionalFactor: "EU Average (PEF Default)", foodLoss: 0.0},
            {name: "Yeast (Brewer's)", co2e: 1.20, waterBlue: 4.0, waterGreen: 10.0, waterGrey: 0.5, landUse: 0.1, source: "AGRIBALYSE 3.2 LCI ID: PROCESS_020", allocation: "Economic", regionalFactor: "EU Average (PEF Default)", foodLoss: 0.1},
            {name: "Algae Protein (Microalgae)", co2e: 1.70, waterBlue: 8.0, waterGreen: 2.0, waterGrey: 0.1, landUse: 0.2, source: "PEFCR ID: ALGAE_001", allocation: "System Expansion", regionalFactor: "EU Average (PEF Default)", foodLoss: 0.5}
        ];

        const packaging = [
            {material: "PET (Clear)", co2e: 2.30, A: 0.5, R1: 0.70, R2: 0.45, Q: 1.0, recyclingRate: 45.0, eol: "Recycling/Incineration", substitution: 1.0, source: "PEFCR Annex C/Eurostat 2024"},
            {material: "HDPE", co2e: 1.95, A: 0.5, R1: 0.30, R2: 0.38, Q: 0.9, recyclingRate: 38.0, eol: "Recycling/Incineration", substitution: 0.9, source: "PEFCR Annex C/Eurostat 2024"},
            {material: "LDPE", co2e: 1.85, A: 0.5, R1: 0.20, R2: 0.36, Q: 0.8, recyclingRate: 36.0, eol: "Recycling/Incineration", substitution: 0.8, source: "PEFCR Annex C/Eurostat 2024"},
            {material: "PP", co2e: 2.05, A: 0.5, R1: 0.25, R2: 0.40, Q: 0.85, recyclingRate: 40.0, eol: "Recycling/Incineration", substitution: 0.85, source: "PEFCR Annex C/Eurostat 2024"},
            {material: "Glass (Clear)", co2e: 0.65, A: 0.5, R1: 0.85, R2: 0.80, Q: 1.0, recyclingRate: 80.0, eol: "Recycling/Landfill", substitution: 1.0, source: "PEFCR Annex C/Eurostat 2024"},
            {material: "Aluminum", co2e: 8.50, A: 0.5, R1: 0.95, R2: 0.75, Q: 1.0, recyclingRate: 75.0, eol: "Recycling/Incineration", substitution: 1.0, source: "PEFCR Annex C/Eurostat 2024"},
            {material: "Steel", co2e: 1.90, A: 0.5, R1: 0.95, R2: 0.84, Q: 1.0, recyclingRate: 84.0, eol: "Recycling/Landfill", substitution: 1.0, source: "PEFCR Annex C/Eurostat 2024"},
            {material: "Cardboard (Coated)", co2e: 1.30, A: 0.5, R1: 0.60, R2: 0.72, Q: 0.95, recyclingRate: 72.0, eol: "Recycling/Incineration", substitution: 0.95, source: "PEFCR Annex C/Eurostat 2024"},
            {material: "PLA (Bioplastic)", co2e: 1.70, A: 0.5, R1: 0.05, R2: 0.01, Q: 0.8, recyclingRate: 1.0, eol: "Industrial Composting/Incineration", substitution: 0.8, source: "PEFCR Bioplastics Guidance"},
        ];

        const processing = [
            {process: "Pasteurization (Milk)", energy: 0.05, water: 0.50, yield: 99.5, loss: 0.5, co2e: 0.012, source: "PEFCR Dairy/EF 3.2 LCI ID"},
            {process: "Sterilization (Liquid)", energy: 0.12, water: 0.70, yield: 98.0, loss: 2.0, co2e: 0.029, source: "PEFCR General Food LCI ID"},
            {process: "Baking (Bread/Cereal)", energy: 0.40, water: 0.10, yield: 97.0, loss: 3.0, co2e: 0.096, source: "PEFCR Cereals (2024 Update)"},
            {process: "Frying (Snacks)", energy: 0.35, water: 0.05, yield: 96.5, loss: 3.5, co2e: 0.084, source: "EF 3.2 LCI ID: FRYING_001"},
            {process: "Freezing (IQF)", energy: 0.55, water: 0.20, yield: 99.0, loss: 1.0, co2e: 0.132, source: "EF 3.2 LCI ID: FREEZE_001"},
            {process: "Drying (Spray Drying)", energy: 1.50, water: 0.80, yield: 95.0, loss: 5.0, co2e: 0.360, source: "PEFCR Dairy/Feed LCI ID"},
            {process: "Milling (Wheat)", energy: 0.03, water: 0.05, yield: 98.5, loss: 1.5, co2e: 0.007, source: "PEFCR Feed/EF 3.2 LCI ID"},
            {process: "Mixing (Wet)", energy: 0.01, water: 0.15, yield: 99.8, loss: 0.2, co2e: 0.002, source: "PEFCR General Food LCI ID"},
        ];

        const transportModes = [
            {mode: "Road (HGV diesel >32t)", co2e: 0.075, load: 64.0, empty: 36.0, refrigerated: 20, countryFactor: "EU Average", source: "JRC EF 3.2 LCI ID: 938d5ba6"},
            {mode: "Rail (EU electric mix)", co2e: 0.015, load: 70.0, empty: 30.0, refrigerated: 0, countryFactor: "EU Average", source: "JRC EF 3.2 LCI ID: 02e87631"},
            {mode: "Sea (Container, Transoceanic)", co2e: 0.010, load: 65.0, empty: 35.0, refrigerated: 5, countryFactor: "Global Average", source: "JRC EF 3.2 LCI ID: 6ca61112"},
            {mode: "Air (Freight)", co2e: 0.950, load: 60.0, empty: 40.0, refrigerated: 0, countryFactor: "Global Average", source: "JRC EF 3.2 LCI ID: 1cc5d465"},
            {mode: "Last-mile (Van, EU diesel)", co2e: 0.350, load: 45.0, empty: 55.0, refrigerated: 0, countryFactor: "EU Average", source: "GLEC v3.1/ISO 14083"},
            {mode: "Last-mile (E-bike/Cargo)", co2e: 0.005, load: 100.0, empty: 0.0, refrigerated: 0, countryFactor: "EU Average", source: "GLEC v3.1 (Non-fossil)"},
        ];

        const countries = [
            {country: "DE (Germany)", elecCo2e: 365.0, aware: 0.85, recycling: 68.0, wasteEm: 0.05, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "FR (France)", elecCo2e: 70.0, aware: 1.10, recycling: 65.0, wasteEm: 0.03, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "IT (Italy)", elecCo2e: 350.0, aware: 1.80, recycling: 60.0, wasteEm: 0.06, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "ES (Spain)", elecCo2e: 220.0, aware: 2.50, recycling: 58.0, wasteEm: 0.07, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "NL (Netherlands)", elecCo2e: 390.0, aware: 0.95, recycling: 62.0, wasteEm: 0.04, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "PL (Poland)", elecCo2e: 700.0, aware: 0.75, recycling: 45.0, wasteEm: 0.15, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "SE (Sweden)", elecCo2e: 35.0, aware: 0.10, recycling: 50.0, wasteEm: 0.02, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "DK (Denmark)", elecCo2e: 150.0, aware: 0.15, recycling: 55.0, wasteEm: 0.01, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "BE (Belgium)", elecCo2e: 250.0, aware: 1.00, recycling: 59.0, wasteEm: 0.05, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "UK (United Kingdom)", elecCo2e: 270.0, aware: 1.20, recycling: 52.0, wasteEm: 0.08, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "IE (Ireland)", elecCo2e: 330.0, aware: 0.90, recycling: 48.0, wasteEm: 0.10, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "AT (Austria)", elecCo2e: 120.0, aware: 0.50, recycling: 60.0, wasteEm: 0.03, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "FI (Finland)", elecCo2e: 110.0, aware: 0.10, recycling: 42.0, wasteEm: 0.02, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "PT (Portugal)", elecCo2e: 180.0, aware: 1.90, recycling: 54.0, wasteEm: 0.06, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "GR (Greece)", elecCo2e: 480.0, aware: 3.00, recycling: 38.0, wasteEm: 0.12, status: "UCPD/GCD Active", source: "EEA 2024 / AWARE 2.0 / Eurostat"},
            {country: "US (United States)", elecCo2e: 400.0, aware: 1.50, recycling: 30.0, wasteEm: 0.18, status: "Non-EU Baseline", source: "IEA 2024/AWARE 2.0"},
            {country: "CA (Canada)", elecCo2e: 150.0, aware: 0.40, recycling: 35.0, wasteEm: 0.10, status: "Non-EU Baseline", source: "IEA 2024/AWARE 2.0"},
            {country: "AU (Australia)", elecCo2e: 550.0, aware: 2.20, recycling: 25.0, wasteEm: 0.20, status: "Non-EU Baseline", source: "IEA 2024/AWARE 2.0"},
            {country: "JP (Japan)", elecCo2e: 450.0, aware: 0.80, recycling: 40.0, wasteEm: 0.05, status: "Non-EU Baseline", source: "IEA 2024/AWARE 2.0"},
            {country: "CN (China)", elecCo2e: 580.0, aware: 5.00, recycling: 20.0, wasteEm: 0.25, status: "Non-EU Baseline", source: "IEA 2024/AWARE 2.0"},
            {country: "IN (India)", elecCo2e: 650.0, aware: 15.00, recycling: 15.0, wasteEm: 0.30, status: "Non-EU Baseline", source: "IEA 2024/AWARE 2.0"},
            {country: "BR (Brazil)", elecCo2e: 120.0, aware: 3.50, recycling: 25.0, wasteEm: 0.10, status: "Non-EU Baseline", source: "IEA 2024/AWARE 2.0"},
        ];

        const benchmarks = [
            {ingredient: "Beef (Ruminant)", globalAvg: 60.0, euConventional: 22.0, euSustainable: 14.0, best: "Grass-fed Low-input", source: "GFI 2024/AGRIBALYSE 3.2"},
            {ingredient: "Milk (Cow, Whole)", globalAvg: 2.5, euConventional: 1.1, euSustainable: 0.8, best: "Certified Organic/Low-input", source: "PEFCR Dairy/AGRIBALYSE 3.2"},
            {ingredient: "Soybeans (Dried)", globalAvg: 0.8, euConventional: 0.6, euSustainable: 0.3, best: "Non-Deforestation/EU Grown", source: "AGRIBALYSE 3.2/GFI 2024"},
            {ingredient: "Wheat (Grain)", globalAvg: 0.5, euConventional: 0.4, euSustainable: 0.2, best: "Precision Farming/Low N", source: "AGRIBALYSE 3.2"},
            {ingredient: "Almonds", globalAvg: 12.0, euConventional: 7.0, euSustainable: 4.5, best: "Efficient Irrigation/California", source: "PEFCR Nuts/AGRIBALYSE 3.2"},
            {ingredient: "Coffee (Green Bean)", globalAvg: 18.0, euConventional: 15.0, euSustainable: 8.0, best: "Certified Shade-Grown", source: "Scientific LCA (2024)"},
            {ingredient: "Cocoa (Bean)", globalAvg: 25.0, euConventional: 20.0, euSustainable: 12.0, best: "Zero Deforestation/Agroforestry", source: "Scientific LCA (2024)"},
            {ingredient: "Tomatoes (Fresh, Open field)", globalAvg: 0.8, euConventional: 0.5, euSustainable: 0.3, best: "Regional/Seasonal", source: "AGRIBALYSE 3.2"},
        ];

        const products = {
            "Beef Burger": {
                ingredients: [
                    {name: "Beef (Cattle, EU Conventional)", quantity: 0.2},
                    {name: "Wheat (Grain)", quantity: 0.1},
                    {name: "Tomatoes (Fresh, Field)", quantity: 0.05},
                    {name: "Onions (Fresh)", quantity: 0.03},
                ],
                totalWeight: 0.38,
                packaging: {material: "Cardboard (Coated)", weight: 0.02},
                processing: "Baking (Bread/Cereal)",
                transport: {mode: "Road (HGV diesel >32t)", distance: 500, refrigerated: false},
                benchmark: 5.0
            },
            "Oat Milk": {
                ingredients: [
                    {name: "Oats (Grain)", quantity: 0.1},
                ],
                totalWeight: 1.0,
                packaging: {material: "PET (Clear)", weight: 0.05},
                processing: "Pasteurization (Milk)",
                transport: {mode: "Road (HGV diesel >32t)", distance: 200, refrigerated: true},
                benchmark: 0.5
            },
            "Vegan Patty": {
                ingredients: [
                    {name: "Peas (Dried)", quantity: 0.15},
                    {name: "Soybeans (Dried)", quantity: 0.05},
                ],
                totalWeight: 0.2,
                packaging: {material: "LDPE", weight: 0.01},
                processing: "Mixing (Wet)",
                transport: {mode: "Sea (Container, Transoceanic)", distance: 1000, refrigerated: false},
                benchmark: 1.0
            }
        };

        // Computation functions
        function calculateAware(waterConsumptionBlueL, awareFactorRegional) {
            let consumptionM3PerKg = waterConsumptionBlueL / 1000.0;
            let cfConstrained = Math.max(0.1, Math.min(100.0, awareFactorRegional));
            return consumptionM3PerKg * cfConstrained;
        }

        function calculateCircularFootprintFormula(R1, R2, A, QsInOverQp, QsOutOverQp, EV, ERecycled, ERecyclingEoL, ED) {
            let term1 = (1 - R1) * EV;
            let term2 = R1 * (A * ERecycled + (1 - A) * EV * QsInOverQp);
            let term3 = (1 - A) * R2 * (ERecyclingEoL - EV * QsOutOverQp);
            let termDisposal = (1 - R2) * ED;
            return term1 + term2 + term3 + termDisposal;
        }

        function getSustainableFactor(ingredientName) {
            let ben = benchmarks.find(b => b.ingredient.includes(ingredientName));
            if (ben) {
                return ben.euSustainable / ben.euConventional;
            }
            return 0.7;
        }

        function calculateProductImpact(productName, countryCode, sustainable) {
            let product = products[productName];
            let country = countries.find(c => c.country === countryCode);
            let awareFactor = country.aware;
            let elecCo2e = country.elecCo2e / 1000; // kg per kWh

            let totalCo2e = 0;
            let totalWater = 0;
            let totalWaterStress = 0;
            let totalLand = 0;

            // Processing
            let processingObj = processing.find(p => p.process === product.processing);
            let ingredientLossFactor = 1;
            if (processingObj) {
                ingredientLossFactor = 1 / (processingObj.yield / 100);
                let processingCo2e = processingObj.energy * elecCo2e;
                totalCo2e += processingCo2e;
                totalWater += processingObj.water;
            }

            // Ingredients
            let ingCo2e = 0;
            let ingWater = 0;
            let ingWaterStress = 0;
            let ingLand = 0;
            for (let ing of product.ingredients) {
                let ingObj = ingredients.find(i => i.name === ing.name);
                if (ingObj) {
                    let factor = sustainable ? getSustainableFactor(ing.name) : 1;
                    ingCo2e += ing.quantity * ingObj.co2e * factor * ingredientLossFactor;
                    let blue = ing.quantity * ingObj.waterBlue * ingredientLossFactor;
                    ingWater += blue + ing.quantity * (ingObj.waterGreen + ingObj.waterGrey) * ingredientLossFactor;
                    ingWaterStress += calculateAware(blue, awareFactor);
                    ingLand += ing.quantity * ingObj.landUse * ingredientLossFactor;
                }
            }
            totalCo2e += ingCo2e;
            totalWater += ingWater;
            totalWaterStress += ingWaterStress;
            totalLand += ingLand;

            // Packaging
            let packObj = packaging.find(p => p.material === product.packaging.material);
            if (packObj) {
                // Assume some values for missing params
                let EV = packObj.co2e;
                let ERecycled = EV * 0.5; // assumption
                let ERecyclingEoL = EV * 0.2; // assumption
                let ED = EV * 0.1; // assumption
                let packCo2e = calculateCircularFootprintFormula(packObj.R1, packObj.R2, packObj.A, packObj.Q, packObj.Q, EV, ERecycled, ERecyclingEoL, ED);
                totalCo2e += packCo2e * product.packaging.weight;
            }

            // Transport
            let transObj = transportModes.find(t => t.mode === product.transport.mode);
            if (transObj) {
                let factor = transObj.co2e;
                if (product.transport.refrigerated) {
                    factor *= 1 + (transObj.refrigerated / 100);
                }
                let ton = product.totalWeight / 1000;
                totalCo2e += ton * product.transport.distance * factor;
            }

            return {co2e: totalCo2e, water: totalWater, waterStress: totalWaterStress, land: totalLand, ingCo2e, processCo2e: processingObj ? processingObj.energy * elecCo2e : 0, packCo2e: packObj ? packCo2e * product.packaging.weight : 0, transCo2e: transObj ? ton * product.transport.distance * factor : 0};
        }

        function updateDashboard() {
            let productName = document.getElementById('product-select').value;
            let countryCode = document.getElementById('country-select').value;
            let sustainable = document.getElementById('sustainable-toggle').checked;

            let impact = calculateProductImpact(productName, countryCode, sustainable);

            // Pie chart: Impact breakdown (approximate percentages based on co2e contributions)
            let pieData = {
                'Ingredients': impact.ingCo2e,
                'Processing': impact.processCo2e,
                'Packaging': impact.packCo2e,
                'Transport': impact.transCo2e
            };
            let pieColors = ["#ff6384", "#36a2eb", "#ffce56", "#4bc0c0"];
            let pieChartCanvas = document.getElementById('pieChart');
            let pieChart = new Piechart({
                canvas: pieChartCanvas,
                data: pieData,
                colors: pieColors
            });
            pieChart.draw();

            // Bar chart: Comparison vs benchmark
            let benchmark = products[productName].benchmark;
            let barData = {
                'Product CO₂e': impact.co2e,
                'Industry Benchmark': benchmark
            };
            let barColors = ["#ff6384", "#36a2eb"];
            let barChartCanvas = document.getElementById('barChart');
            let barChart = new Barchart({
                canvas: barChartCanvas,
                data: barData,
                colors: barColors
            });
            barChart.draw();

            // Storytelling
            let co2EquivCar = (impact.co2e / 0.2).toFixed(2); // assuming 0.2 kg CO2e per km
            let waterEquivShowers = (impact.water / 65).toFixed(2); // 65 L per shower
            let landEquivFields = (impact.land / 7140).toFixed(2); // 7140 m2 per field
            let story = `<p>The ${productName} has a carbon footprint of ${impact.co2e.toFixed(2)} kg CO₂e, equivalent to driving ${co2EquivCar} km in an average car or charging ${ (impact.co2e / 0.01).toFixed(0) } smartphones. It consumes ${impact.water.toFixed(2)} L of water, equivalent to ${waterEquivShowers} showers. The land use is ${impact.land.toFixed(2)} m², comparable to ${landEquivFields} football fields.</p>`;
            document.getElementById('story').innerHTML = story;

            // QR Code
            let qrData = `Product: ${productName}\nCO₂e: ${impact.co2e.toFixed(2)} kg\nWater: ${impact.water.toFixed(2)} L\nLand: ${impact.land.toFixed(2)} m²\nData Source: AIOXY\nTimestamp: ${new Date().toISOString()}\nHash: ${Math.random().toString(36).substring(2)}`;
            generateQRPlaceholder(qrData); // Replace with actual QR if library is embedded
        }

        function checkPassword() {
            let pw = document.getElementById('password').value;
            if (pw === "AIOXY2024") {
                document.getElementById('password-prompt').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                updateDashboard();
            } else {
                alert("Incorrect password");
            }
        }

        // Event listeners
        document.getElementById('product-select').addEventListener('change', updateDashboard);
        document.getElementById('country-select').addEventListener('change', updateDashboard);
        document.getElementById('sustainable-toggle').addEventListener('change', updateDashboard);

        // Initial load (hidden)
        // updateDashboard(); // Called after password
    </script>
</body>
</html>
