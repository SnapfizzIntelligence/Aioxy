<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIOXY | Science-Based Sustainability Intelligence</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* CSS REMAINS EXACTLY THE SAME TO PRESERVE DESIGN */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', 'Segoe UI', system-ui, sans-serif; }
        :root {
            --primary: #0A2540; --primary-light: #1A365D; --primary-dark: #061B2E;
            --secondary: #00D4AA; --secondary-dark: #00B894; --accent: #FF6B6B;
            --light: #F8FAFC; --dark: #2D3748; --gray: #718096; --border: #E2E8F0;
            --card-bg: #FFFFFF; --success: #48BB78; --warning: #ED8936;
            --gradient-primary: linear-gradient(135deg, #0A2540 0%, #1A365D 100%);
            --gradient-secondary: linear-gradient(135deg, #00D4AA 0%, #00B894 100%);
            --gradient-accent: linear-gradient(135deg, #FF6B6B 0%, #FF8E8E 100%);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1); --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.1); --shadow-xl: 0 20px 40px rgba(0,0,0,0.15);
            --dqr-excellent: #48BB78; --dqr-very-good: #68D391; --dqr-good: #ECC94B; --dqr-fair: #ED8936; --dqr-poor: #FC8181;
        }
        body { background: linear-gradient(135deg, #F8FAFC 0%, #EDF2F7 100%); min-height: 100vh; color: var(--dark); line-height: 1.6; }
        .container { max-width: 1400px; margin: 0 auto; background: var(--card-bg); border-radius: 20px; box-shadow: var(--shadow-xl); overflow: hidden; margin-top: 20px; margin-bottom: 20px; }
        .header { background: var(--gradient-primary); color: white; padding: 2.5rem 3rem; position: relative; overflow: hidden; }
        .header::before { content: ''; position: absolute; top: 0; right: 0; width: 400px; height: 400px; background: rgba(255,255,255,0.05); border-radius: 50%; transform: translate(30%, -30%); }
        .header-content { position: relative; z-index: 2; }
        .logo { font-size: 2.75rem; font-weight: 800; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 1rem; }
        .logo-icon { background: var(--gradient-secondary); width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; box-shadow: var(--shadow-md); }
        .tagline { font-size: 1.1rem; opacity: 0.9; margin-bottom: 1rem; }
        .compliance-badge { background: rgba(255,255,255,0.15); padding: 0.6rem 1.25rem; border-radius: 50px; font-size: 0.875rem; font-weight: 600; backdrop-filter: blur(10px); display: inline-flex; align-items: center; gap: 0.5rem; margin-top: 0.5rem; border: 1px solid rgba(255,255,255,0.2); }
        .nav-tabs { display: flex; background: white; border-bottom: 1px solid var(--border); padding: 0 3rem; position: relative; overflow-x: auto; }
        .nav-tab { padding: 1.25rem 2rem; background: none; border: none; font-weight: 600; color: var(--gray); cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.3s ease; display: flex; align-items: center; gap: 0.75rem; position: relative; overflow: hidden; white-space: nowrap; flex-shrink: 0; }
        .nav-tab::before { content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%; background: var(--gradient-primary); opacity: 0.05; transition: left 0.3s ease; }
        .nav-tab:hover::before { left: 0; }
        .nav-tab.active { color: var(--primary); border-bottom-color: var(--secondary); }
        .nav-tab.active::before { left: 0; }
        .main-content { padding: 2.5rem 3rem; display: grid; gap: 2rem; grid-template-columns: 1fr 1fr; }
        @media (max-width: 1200px) { .main-content { grid-template-columns: 1fr; } }
        .card { background: var(--card-bg); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; box-shadow: var(--shadow-md); border: 1px solid var(--border); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; }
        .card-title { font-size: 1.375rem; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 0.75rem; }
        .card-icon { width: 40px; height: 40px; border-radius: 10px; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; color: white; font-size: 1.2rem; }
        .form-group { margin-bottom: 1.5rem; }
        .form-label { display: block; margin-bottom: 0.75rem; font-weight: 600; color: var(--dark); font-size: 0.95rem; }
        .form-control { width: 100%; padding: 0.875rem 1rem; border: 2px solid var(--border); border-radius: 10px; font-size: 1rem; transition: all 0.3s; background: white; }
        .form-control:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(10, 37, 64, 0.1); }
        .btn { background: var(--gradient-primary); color: white; border: none; padding: 0.875rem 1.75rem; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.75rem; box-shadow: var(--shadow-sm); }
        .btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .btn-success { background: var(--gradient-secondary); }
        .btn-outline { background: transparent; border: 2px solid var(--primary); color: var(--primary); }
        .btn-accent { background: var(--gradient-accent); }
        .ingredient-list { border: 1px solid var(--border); border-radius: 12px; padding: 1rem; margin-top: 1.5rem; }
        .ingredient-item { display: flex; justify-content: space-between; align-items: center; padding: 1.25rem; border-bottom: 1px solid var(--border); transition: background 0.2s; }
        .ingredient-item:hover { background: rgba(0, 212, 170, 0.05); }
        .ingredient-item:last-child { border-bottom: none; }
        .ingredient-info { flex: 1; }
        .ingredient-name { font-weight: 600; margin-bottom: 0.25rem; }
        .ingredient-stats { font-size: 0.85rem; color: var(--gray); }
        .ingredient-actions { display: flex; align-items: center; gap: 0.75rem; }
        .quantity-input { width: 90px; padding: 0.5rem; border: 1px solid var(--border); border-radius: 6px; text-align: center; }
        .remove-btn { background: var(--gradient-accent); color: white; border: none; border-radius: 6px; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .remove-btn:hover { transform: scale(1.1); }
        .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; margin: 1.5rem 0; }
        .metric-card { background: white; padding: 1.5rem 1rem; border-radius: 12px; text-align: center; box-shadow: var(--shadow-md); border-top: 4px solid var(--primary); transition: transform 0.3s ease; position: relative; }
        .metric-card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--gradient-primary); }
        .metric-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-lg); }
        .metric-icon { width: 50px; height: 50px; border-radius: 50%; background: rgba(10, 37, 64, 0.1); display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem; font-size: 1.25rem; color: var(--primary); }
        .metric-value { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin: 0.25rem 0; }
        .metric-label { font-size: 0.8rem; color: var(--gray); text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; }
        .savings-badge { background: var(--gradient-secondary); color: white; padding: 0.4rem 0.8rem; border-radius: 50px; font-size: 0.8rem; font-weight: 600; margin-top: 0.5rem; display: inline-block; }
        .chart-container { height: 250px; margin: 1.5rem 0; background: white; border-radius: 12px; padding: 1.25rem; box-shadow: var(--shadow-md); }
        .environmental-story { background: var(--gradient-primary); color: white; padding: 1.75rem; border-radius: 14px; margin: 1.5rem 0; box-shadow: var(--shadow-lg); position: relative; }
        .environmental-story::before { content: ''; position: absolute; top: -50%; right: -50%; width: 100%; height: 200%; background: rgba(255,255,255,0.05); transform: rotate(30deg); }
        .story-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.75rem; }
        .story-content { line-height: 1.6; font-size: 1rem; position: relative; z-index: 2; }
        .story-highlight { background: rgba(255,255,255,0.15); padding: 0.75rem 1.25rem; border-radius: 10px; margin: 1rem 0; border-left: 4px solid var(--secondary); }
        .compliance-notice { background: #E3F2FD; border: 1px solid #2196F3; border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; font-size: 0.9rem; display: flex; align-items: flex-start; gap: 1rem; }
        .compliance-icon { background: #2196F3; color: white; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .hidden { display: none; }
        .loading { text-align: center; padding: 2rem; }
        .spinner { border: 4px solid rgba(10, 37, 64, 0.1); border-top: 4px solid var(--primary); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .transport-section { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 1rem; }
        .advanced-options { background: var(--light); border-radius: 10px; padding: 1.5rem; margin-top: 1.5rem; border-left: 4px solid var(--primary); }
        .section-divider { height: 1px; background: var(--border); margin: 1.5rem 0; }
        .footer { background: var(--primary-dark); color: white; padding: 1.5rem 3rem; text-align: center; font-size: 0.85rem; }
        .footer-content { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
        .footer-links { display: flex; gap: 1.5rem; }
        .footer-links a { color: rgba(255,255,255,0.7); text-decoration: none; transition: color 0.3s; }
        .footer-links a:hover { color: white; }
        .progress-bar { height: 6px; background: var(--border); border-radius: 3px; margin: 1rem 0; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--gradient-secondary); border-radius: 3px; transition: width 0.5s ease; }
        .badge { display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(0, 212, 170, 0.1); color: var(--secondary-dark); padding: 0.5rem 1rem; border-radius: 50px; font-size: 0.85rem; font-weight: 600; }
        .tab-indicator { position: absolute; bottom: 0; height: 3px; background: var(--secondary); transition: left 0.3s ease, width 0.3s ease; }
        .empty-state { text-align: center; padding: 2rem 1.5rem; color: var(--gray); }
        .empty-state i { font-size: 2.5rem; margin-bottom: 1rem; opacity: 0.5; }
        .action-buttons { display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap; }
        .action-buttons .btn { flex: 1; min-width: 150px; justify-content: center; }
        .dpp-section { background: var(--light); border-radius: 12px; padding: 2rem; margin: 1.5rem 0; text-align: center; }
        .qrcode-container { display: inline-block; background: white; padding: 1.5rem; border-radius: 12px; box-shadow: var(--shadow-md); margin: 1rem 0; }
        .dpp-id { font-family: monospace; background: var(--primary); color: white; padding: 0.75rem 1.5rem; border-radius: 8px; display: inline-block; margin: 1rem 0; font-weight: 600; }
        .impact-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1.5rem 0; }
        .comparison-card { background: white; padding: 1.5rem; border-radius: 12px; text-align: center; box-shadow: var(--shadow-md); border-left: 4px solid var(--secondary); }
        .comparison-value { font-size: 1.25rem; font-weight: 700; color: var(--primary); margin: 0.5rem 0; }
        .comparison-label { font-size: 0.85rem; color: var(--gray); }
        .pef-scorecard { background: white; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0; box-shadow: var(--shadow-md); overflow-x: auto; }
        .pef-table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        .pef-table th { background: var(--light); padding: 12px 15px; text-align: left; font-weight: 600; color: var(--primary); border-bottom: 2px solid var(--border); }
        .pef-table td { padding: 10px 15px; border-bottom: 1px solid var(--border); }
        .pef-table tr:hover { background: rgba(0, 212, 170, 0.05); }
        .pef-category { font-weight: 600; color: var(--primary); }
        .pef-value { font-family: monospace; font-weight: 600; }
        .pef-unit { color: var(--gray); font-size: 0.85rem; }
        .mass-balance { background: var(--light); border-radius: 10px; padding: 1.25rem; margin: 1rem 0; border-left: 4px solid var(--secondary); }
        .mass-balance-title { font-weight: 600; color: var(--primary); margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .mass-balance-item { display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border); }
        .mass-balance-item:last-child { border-bottom: none; font-weight: 600; color: var(--primary); }
        .dqr-badge { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0.8rem; border-radius: 50px; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .dqr-excellent { background: var(--dqr-excellent); color: white; }
        .dqr-very-good { background: var(--dqr-very-good); color: white; }
        .dqr-good { background: var(--dqr-good); color: var(--dark); }
        .dqr-fair { background: var(--dqr-fair); color: white; }
        .dqr-poor { background: var(--dqr-poor); color: white; }
        .source-badge { background: rgba(10, 37, 64, 0.1); color: var(--primary); padding: 0.3rem 0.6rem; border-radius: 4px; font-size: 0.7rem; font-family: monospace; }
        .data-quality-section { background: var(--light); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
        .dqr-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .dqr-factor { text-align: center; padding: 1rem; background: white; border-radius: 8px; box-shadow: var(--shadow-sm); }
        .dqr-factor-value { font-size: 1.5rem; font-weight: 800; margin-bottom: 0.5rem; }
        .dqr-factor-label { font-size: 0.75rem; color: var(--gray); text-transform: uppercase; letter-spacing: 0.5px; }
        .audit-trail-section { background: var(--light); border-radius: 10px; padding: 1.5rem; margin: 1.5rem 0; }
        .audit-category { background: white; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; box-shadow: var(--shadow-sm); }
        .audit-category-header { font-weight: 600; color: var(--primary); margin-bottom: 0.75rem; display: flex; justify-content: space-between; align-items: center; }
        .audit-component { background: rgba(10, 37, 64, 0.03); border-radius: 6px; padding: 0.75rem; margin-bottom: 0.5rem; }
        .audit-component-header { font-weight: 600; color: var(--dark); margin-bottom: 0.5rem; display: flex; justify-content: space-between; }
        .audit-item { display: flex; justify-content: space-between; padding: 0.25rem 0; font-size: 0.85rem; }
        .audit-item-name { flex: 2; }
        .audit-item-value { flex: 1; text-align: right; font-family: monospace; }
        .story-comparison { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 1.5rem 0; }
        .story-item { background: rgba(255,255,255,0.1); padding: 1.5rem; border-radius: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2); }
        .story-icon { font-size: 2rem; margin-bottom: 1rem; opacity: 0.9; }
        .story-value { font-size: 1.5rem; font-weight: 700; margin: 0.5rem 0; }
        .story-label { font-size: 0.9rem; opacity: 0.8; }
        .export-section { background: var(--light); border-radius: 12px; padding: 2rem; margin: 1.5rem 0; text-align: center; }
        .export-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 2rem 0; }
        .export-card { background: white; padding: 2rem 1.5rem; border-radius: 12px; text-align: center; box-shadow: var(--shadow-md); border: 2px solid transparent; transition: all 0.3s ease; cursor: pointer; }
        .export-card:hover { transform: translateY(-5px); border-color: var(--secondary); box-shadow: var(--shadow-lg); }
        .export-icon { width: 70px; height: 70px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.8rem; color: white; }
        .export-title { font-size: 1.2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem; }
        .export-desc { font-size: 0.9rem; color: var(--gray); line-height: 1.5; }
        #pdf-loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 37, 64, 0.85); display: none; align-items: center; justify-content: center; z-index: 9999; color: white; flex-direction: column; gap: 1rem; backdrop-filter: blur(5px); }
        #pdf-loading-overlay .spinner { width: 60px; height: 60px; border: 6px solid rgba(255, 255, 255, 0.3); border-top: 6px solid var(--secondary); border-radius: 50%; animation: spin 1s linear infinite; }
        #pdf-loading-overlay h3 { font-size: 1.25rem; font-weight: 600; }
        .business-case { background: var(--light); border-radius: 12px; padding: 2rem; margin: 1.5rem 0; }
        .business-metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin: 1.5rem 0; }
        .business-card { background: white; padding: 1.5rem; border-radius: 10px; text-align: center; box-shadow: var(--shadow-md); }
        .business-value { font-size: 1.75rem; font-weight: 800; color: var(--primary); margin: 0.5rem 0; }
        .business-label { font-size: 0.9rem; color: var(--gray); }
        .roi-badge { background: var(--gradient-secondary); color: white; padding: 0.5rem 1rem; border-radius: 50px; font-size: 0.85rem; font-weight: 600; margin-top: 0.5rem; display: inline-block; }
        .scenario-buttons { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1.5rem 0; }
        .scenario-card { background: white; padding: 1.5rem; border-radius: 10px; text-align: center; box-shadow: var(--shadow-md); border: 2px solid transparent; transition: all 0.3s ease; cursor: pointer; }
        .scenario-card:hover { transform: translateY(-3px); border-color: var(--secondary); box-shadow: var(--shadow-lg); }
        .scenario-icon { width: 50px; height: 50px; border-radius: 50%; background: var(--gradient-primary); display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 1.5rem; color: white; }
        .scenario-title { font-size: 1.1rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem; }
        .scenario-desc { font-size: 0.85rem; color: var(--gray); line-height: 1.4; }
        .multi-comparison { background: white; border-radius: 12px; padding: 1.5rem; margin: 1.5rem 0; box-shadow: var(--shadow-md); }
        .comparison-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin: 1rem 0; }
        .comparison-item { text-align: center; padding: 1rem; border-radius: 8px; background: var(--light); border: 2px solid transparent; }
        .comparison-item.best { border-color: var(--success); background: rgba(72, 187, 120, 0.1); }
        .comparison-item.worst { border-color: var(--accent); background: rgba(255, 107, 107, 0.1); }
        .comparison-item-name { font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; }
        .comparison-item-value { font-size: 1.1rem; font-weight: 700; color: var(--primary); margin-bottom: 0.25rem; }
        .comparison-item-savings { font-size: 0.8rem; font-weight: 600; }
        .savings-positive { color: var(--success); }
        .savings-negative { color: var(--accent); }
        .universal-comparison-grid { display: grid; grid-template-columns: 1fr; gap: 0.8rem; margin-top: 1rem; }
        .universal-comparison-item { padding: 1rem; border-radius: 8px; background: white; border: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .universal-comparison-item.highlight { border: 2px solid var(--success); background: rgba(72, 187, 120, 0.05); }
        .bar-container { flex-grow: 1; margin: 0 15px; background: #eee; height: 8px; border-radius: 4px; overflow: hidden; }
        .bar-fill { height: 100%; background: var(--primary); transition: width 1s ease; }
        .highlight .bar-fill { background: var(--success); }
        .scenario-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.8rem; margin-bottom: 1.5rem; }
        .scenario-btn { background: white; border: 1px solid var(--border); padding: 1rem; border-radius: 8px; text-align: center; cursor: pointer; transition: 0.2s; }
        .scenario-btn:hover, .scenario-btn.active { border-color: var(--secondary); background: var(--light); transform: translateY(-2px); }
        .scenario-btn i { font-size: 1.5rem; color: var(--primary); margin-bottom: 0.5rem; display: block; }
        .ledger-table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .ledger-table th { text-align: left; padding: 10px; color: #718096; border-bottom: 2px solid var(--border); }
        .ledger-table td { padding: 10px; border-bottom: 1px solid var(--border); }
        .money-positive { color: var(--success); font-weight: 700; font-family: monospace; }
        @media (max-width: 768px) {
            .main-content { padding: 1.5rem; }
            .header { padding: 2rem 1.5rem; }
            .nav-tabs { padding: 0 1.5rem; }
            .nav-tab { padding: 1rem 1.25rem; }
            .card { padding: 1.5rem; }
            .results-grid { grid-template-columns: repeat(2, 1fr); }
            .transport-section { grid-template-columns: 1fr; }
            .footer-content { flex-direction: column; gap: 1rem; }
            .footer-links { gap: 1rem; }
            .impact-comparison { grid-template-columns: 1fr; }
            .pef-table { font-size: 0.8rem; }
            .pef-table th, .pef-table td { padding: 8px 10px; }
            .dqr-breakdown { grid-template-columns: repeat(3, 1fr); }
            .story-comparison { grid-template-columns: 1fr; }
            .export-options { grid-template-columns: 1fr; }
            .business-metrics { grid-template-columns: 1fr; }
            .scenario-buttons { grid-template-columns: 1fr; }
            .comparison-grid { grid-template-columns: repeat(2, 1fr); }
            .universal-comparison-grid { grid-template-columns: 1fr; }
            .scenario-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon"><i class="fas fa-leaf"></i></div>
                    AIOXY
                </div>
                <div class="tagline">Science-Based Sustainability Intelligence Platform</div>
                <div class="compliance-badge">
                    <i class="fas fa-shield-alt"></i> Standard-Aligned • PEF 3.1 Methodology • Verification-Ready
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="tab-indicator" id="tabIndicator"></div>
            <button class="nav-tab active" onclick="showTab('calculator')"><i class="fas fa-calculator"></i> Calculator</button>
            <button class="nav-tab" onclick="showTab('results')"><i class="fas fa-chart-line"></i> Results</button>
            <button class="nav-tab" onclick="showTab('business-case')"><i class="fas fa-euro-sign"></i> Business Case</button>
            <button class="nav-tab" onclick="showTab('pef-scorecard')"><i class="fas fa-list-ol"></i> PEF Scorecard</button>
            <button class="nav-tab" onclick="showTab('dpp')"><i class="fas fa-qrcode"></i> Transparency Card</button>
            <button class="nav-tab" onclick="showTab('export')"><i class="fas fa-file-export"></i> Export Reports</button>
            <button class="nav-tab" onclick="showTab('transparency')"><i class="fas fa-search"></i> Transparency Log</button>
            <button class="nav-tab" onclick="showTab('methodology')"><i class="fas fa-file-contract"></i> Methodology</button>
        </div>

        <div class="main-content">
            <div id="calculator-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon"><i class="fas fa-box"></i></div>
                            Product Information
                        </div>
                        <div class="badge"><i class="fas fa-info-circle"></i> Required for Transparency Card</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Name</label>
                        <input type="text" id="productName" class="form-control" placeholder="Enter product name" value="Plant-Based Protein Burger">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Category (Smart Baseline Detection)</label>
                        <select id="productCategory" class="form-control" onchange="updateComparison()">
                            <option value="auto">✨ Auto-Detect (Recommended)</option>
                            <option value="dairy_alt">Plant-Based Milk</option>
                            <option value="meat_alt">Plant-Based Meat</option>
                            <option value="dairy">Dairy Product</option>
                            <option value="meat">Meat Product</option>
                            <option>Personal Care</option>
                            <option>Household Products</option>
                            <option>Textiles</option>
                            <option>Electronics</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Weight (kg)</label>
                        <input type="number" id="productWeight" class="form-control" value="0.200" step="0.001" min="0">
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon"><i class="fas fa-balance-scale"></i></div>
                            Performance Comparison
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Compare Against</label>
                        <select id="comparisonBaseline" class="form-control" onchange="updateComparison()">
                            <option value="auto">Auto-detect (Recommended)</option>
                            <optgroup label="Food Products">
                                <option value="beef-product">Conventional Beef Product</option>
                                <option value="chicken-product">Conventional Chicken Product</option>
                                <option value="pork-product">Conventional Pork Product</option>
                                <option value="cheese-product">Conventional Cheese Product</option>
                                <option value="coffee-product">Conventional Coffee Product</option>
                                <option value="chocolate-product">Conventional Chocolate Product</option>
                                <option value="bread-product">Conventional Bread Product</option>
                            </optgroup>
                            <optgroup label="Personal Care">
                                <option value="shampoo-conventional">Conventional Shampoo</option>
                                <option value="soap-conventional">Conventional Soap</option>
                                <option value="lotion-conventional">Conventional Lotion</option>
                            </optgroup>
                            <optgroup label="Textiles">
                                <option value="cotton-tshirt">Conventional Cotton T-Shirt</option>
                                <option value="polyester-tshirt">Conventional Polyester T-Shirt</option>
                            </optgroup>
                            <optgroup label="Beverages">
                                <option value="soda-drink">Conventional Soda Drink</option>
                                <option value="juice-drink">Conventional Juice Drink</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Custom Baseline (kg CO₂e/kg)</label>
                        <input type="number" id="customBaseline" class="form-control" placeholder="Enter custom competitor baseline" step="0.1" min="0">
                        <small style="color: var(--gray); font-size: 0.8rem;">Use this to compare against specific competitors</small>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon"><i class="fas fa-apple-alt"></i></div>
                            Ingredients (Science-Based)
                        </div>
                        <div class="badge"><i class="fas fa-database"></i> 50 Ingredients • AGRIBALYSE 3.2 • DQR Rated</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Select Ingredient</label>
                        <select id="ingredientSelect" class="form-control">
                            <option value="">Choose from science-based ingredients...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Quantity (kg)</label>
                        <input type="number" id="ingredientQuantity" value="0.150" step="0.001" min="0" class="form-control">
                    </div>
                    <button class="btn" onclick="addIngredient()"><i class="fas fa-plus"></i> Add Ingredient</button>
                    <div class="ingredient-list" id="ingredientList">
                        <div class="empty-state">
                            <i class="fas fa-apple-alt"></i>
                            <h3>No ingredients added yet</h3>
                            <p>Add ingredients to calculate your environmental impact</p>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon"><i class="fas fa-industry"></i></div>
                            Manufacturing & Supply Chain
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Manufacturing Country</label>
                        <select id="manufacturingCountry" class="form-control">
                            <option value="">Select country...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Processing Method</label>
                        <select id="processingMethod" class="form-control">
                            <option value="none">No Additional Processing</option>
                            <option value="pasteurization">Pasteurization</option>
                            <option value="sterilization">Sterilization (UHT)</option>
                            <option value="baking">Baking</option>
                            <option value="frying">Frying</option>
                            <option value="freezing">Freezing (IQF)</option>
                            <option value="drying">Spray Drying</option>
                            <option value="milling">Milling</option>
                            <option value="mixing">Mixing/Blending</option>
                            <option value="fermentation">Fermentation</option>
                            <option value="extrusion">Extrusion</option>
                            <option value="oat-processing">Oat Enzyming/Heat Treatment</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Transportation</label>
                        <div class="transport-section">
                            <div>
                                <label class="form-label">Distance (km)</label>
                                <input type="number" id="transportDistance" value="300" min="0" class="form-control">
                            </div>
                            <div>
                                <label class="form-label">Transport Mode</label>
                                <select id="transportMode" class="form-control">
                                    <option value="road">Road Freight (HGV Diesel)</option>
                                    <option value="rail">Rail Freight (Electric)</option>
                                    <option value="sea">Sea Freight (Container)</option>
                                    <option value="air">Air Freight</option>
                                    <option value="lastmile">Last-mile Delivery</option>
                                    <option value="electric_van">Electric Van</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-outline" onclick="toggleAdvanced()"><i class="fas fa-cog"></i> Advanced Options</button>
                    <div class="advanced-options hidden" id="advancedOptions">
                        <div class="form-group">
                            <label class="form-label">Refrigerated Transport</label>
                            <select id="refrigeratedTransport" class="form-control">
                                <option value="no">No Refrigeration</option>
                                <option value="yes">Refrigerated (+20-40% emissions)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon"><i class="fas fa-box-open"></i></div>
                            Packaging Materials
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Primary Packaging Material</label>
                        <select id="packagingMaterial" class="form-control">
                            <option value="cardboard">Cardboard (Coated)</option>
                            <option value="PET">PET Plastic</option>
                            <option value="rPET">rPET (Recycled)</option>
                            <option value="HDPE">HDPE Plastic</option>
                            <option value="LDPE">LDPE Plastic</option>
                            <option value="PP">PP Plastic</option>
                            <option value="glass">Glass</option>
                            <option value="aluminum">Aluminum</option>
                            <option value="steel">Steel</option>
                            <option value="PLA">PLA Bioplastic</option>
                            <option value="mycelium">Mycelium Foam</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Packaging Weight (kg)</label>
                        <input type="number" id="packagingWeight" value="0.050" step="0.001" min="0" class="form-control">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Recycled Content (%)</label>
                        <input type="number" id="recycledContent" value="30" min="0" max="100" class="form-control">
                        <div class="progress-bar"><div class="progress-fill" style="width: 30%;"></div></div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="calculateImpact()" style="width: 100%; padding: 1.25rem; font-size: 1.1rem;"><i class="fas fa-rocket"></i> Calculate Environmental Impact</button>
            </div>

            <div id="results-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><div class="card-icon"><i class="fas fa-chart-pie"></i></div> Impact Analysis</div>
                        <div class="badge"><i class="fas fa-clock"></i> PEF 3.1 Methodology</div>
                    </div>
                    <div class="loading hidden" id="loadingResults">
                        <div class="spinner"></div>
                        <h3>Calculating Environmental Footprint...</h3>
                    </div>
                    <div id="resultsContent">
                        <div class="data-quality-section hidden" id="dataQualitySection">
                            <h3 style="margin-bottom: 1rem; color: var(--primary);"><i class="fas fa-chart-line"></i> Data Quality Assessment</h3>
                            <div class="dqr-breakdown" id="dqrBreakdown"></div>
                            <div style="text-align: center; margin-top: 1rem;">
                                <span class="dqr-badge dqr-excellent" id="overallDQRBadge"><i class="fas fa-star"></i> Overall Data Quality: Excellent</span>
                            </div>
                        </div>
                        <div class="mass-balance hidden" id="massBalanceSection">
                            <div class="mass-balance-title"><i class="fas fa-balance-scale"></i> Mass Balance Verification</div>
                            <div id="massBalanceContent"></div>
                        </div>
                        <div class="results-grid">
                            <div class="metric-card">
                                <div class="metric-icon"><i class="fas fa-smog"></i></div>
                                <div class="metric-value" id="co2Value">0.00 kg</div>
                                <div class="metric-label">CO₂e per kg</div>
                                <div class="savings-badge" id="co2Savings">0% saved</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon"><i class="fas fa-tint"></i></div>
                                <div class="metric-value" id="waterValue">0 m³</div>
                                <div class="metric-label">Water Scarcity per kg</div>
                                <div class="savings-badge" id="waterSavings">0% saved</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon"><i class="fas fa-mountain"></i></div>
                                <div class="metric-value" id="landValue">0 Pt</div>
                                <div class="metric-label">Land Use per kg</div>
                            </div>
                            <div class="metric-card">
                                <div class="metric-icon"><i class="fas fa-fire"></i></div>
                                <div class="metric-value" id="fossilValue">0 MJ</div>
                                <div class="metric-label">Fossil Resources</div>
                            </div>
                        </div>
                        <div class="multi-comparison" id="universalComparisonSection">
                            <h3 style="margin-bottom: 1rem; color: var(--primary);"><i class="fas fa-chart-bar"></i> Universal Product Comparison</h3>
                            <div style="background: #E3F2FD; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                                <i class="fas fa-robot" style="color: var(--primary);"></i> <strong id="baselineName">Comparing against: Detecting...</strong>
                            </div>
                            <div class="universal-comparison-grid" id="universalComparisonGrid"></div>
                        </div>
                        <div class="environmental-story hidden" id="environmentalStory">
                            <div class="story-title"><i class="fas fa-globe-europe"></i> Environmental Impact Story</div>
                            <div class="story-content" id="storyContent"></div>
                            <div class="story-comparison" id="storyComparison"></div>
                        </div>
                        <div class="chart-container"><canvas id="emissionChart"></canvas></div>
                        <div class="impact-comparison">
                            <div class="comparison-card">
                                <i class="fas fa-car" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="carKm">0 km</div>
                                <div class="comparison-label">Car distance saved</div>
                            </div>
                            <div class="comparison-card">
                                <i class="fas fa-home" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="householdEnergy">0 days</div>
                                <div class="comparison-label">Household energy</div>
                            </div>
                            <div class="comparison-card">
                                <i class="fas fa-tree" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="treesPlanted">0 trees</div>
                                <div class="comparison-label">CO₂ absorption</div>
                            </div>
                            <div class="comparison-card">
                                <i class="fas fa-wine-bottle" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i>
                                <div class="comparison-value" id="waterBottles">0 bottles</div>
                                <div class="comparison-label">Water saved</div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn" onclick="showTab('business-case')"><i class="fas fa-euro-sign"></i> View Business Case</button>
                            <button class="btn" onclick="showTab('pef-scorecard')"><i class="fas fa-list-ol"></i> View Full PEF Scorecard</button>
                            <button class="btn" onclick="showTab('dpp')"><i class="fas fa-qrcode"></i> Generate Transparency Card</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="business-case-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title"><div class="card-icon"><i class="fas fa-euro-sign"></i></div> Business Case & ROI Analysis</div>
                    </div>
                    <div class="business-case">
                        <div class="form-group" style="background: white; padding: 2rem; border-radius: 12px; border: 2px solid var(--border); margin-bottom: 2rem;">
                            <label class="form-label" style="font-size: 1.1rem; margin-bottom: 1.5rem;"><i class="fas fa-boxes"></i> Annual Production Volume</label>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 0.5rem; margin-bottom: 1.5rem;">
                                <button class="btn btn-outline" onclick="setVolume(100)">100 units</button>
                                <button class="btn btn-outline" onclick="setVolume(1000)">1K units</button>
                                <button class="btn btn-outline" onclick="setVolume(10000)">10K units</button>
                                <button class="btn btn-outline" onclick="setVolume(100000)">100K units</button>
                                <button class="btn btn-outline" onclick="setVolume(1000000)">1M units</button>
                            </div>
                            <div style="margin-bottom: 1rem;">
                                <input type="range" id="salesVolume" min="1" max="1000000000" value="10000" step="1" style="width: 100%; height: 8px; border-radius: 4px;" oninput="updateVolumeDisplay(this.value); updateBusinessCase();">
                            </div>
                            <div style="text-align: center;">
                                <div style="font-size: 2rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem;"><span id="volumeDisplay">10,000</span></div>
                                <div style="font-size: 1rem; color: var(--gray);"><span id="businessScaleDisplay">Growing Business</span> • Tier: <span id="volumeTierDisplay">10K-100K</span></div>
                            </div>
                        </div>

                        <h3 style="margin: 1.5rem 0 1rem 0; color: var(--primary);">What-If Scenarios (Physics-Based)</h3>
                        <div class="scenario-grid">
                            <div class="scenario-btn" id="scenario-renewables" onclick="toggleScenario('renewables')"><i class="fas fa-solar-panel"></i><div style="font-weight: 600;">Renewable Energy</div><div style="font-size: 0.75rem; color: gray;">Drops Scope 2 Carbon</div></div>
                            <div class="scenario-btn" id="scenario-local" onclick="toggleScenario('local')"><i class="fas fa-truck"></i><div style="font-weight: 600;">Local Sourcing</div><div style="font-size: 0.75rem; color: gray;">Reduce Dist. to 50km</div></div>
                            <div class="scenario-btn" id="scenario-lightweight" onclick="toggleScenario('lightweight')"><i class="fas fa-feather"></i><div style="font-weight: 600;">Lightweight Pkg</div><div style="font-size: 0.75rem; color: gray;">-20% Material Wgt</div></div>
                            <div class="scenario-btn" id="scenario-reset" onclick="resetScenarios()"><i class="fas fa-undo"></i><div style="font-weight: 600;">Reset All</div><div style="font-size: 0.75rem; color: gray;">Baseline Physics</div></div>
                        </div>

                        <div style="margin-top: 2rem;">
                            <h3 style="margin-bottom: 1rem; color: var(--primary);"><i class="fas fa-calculator"></i> Financial Impact Analysis (Real Physics)</h3>
                            <table class="ledger-table">
                                <thead><tr><th>Cost Driver (Real Math)</th><th>Physics Delta</th><th>Financial Impact</th></tr></thead>
                                <tbody id="ledgerBody"></tbody>
                            </table>
                            <div style="margin-top: 1.5rem; text-align: right;">
                                <div style="font-size: 0.9rem; color: gray;">Total Annual Benefit</div>
                                <div style="font-size: 2rem; font-weight: 800; color: var(--success);" id="totalBenefit">€0</div>
                            </div>
                        </div>

                        <div class="business-metrics">
                            <div class="business-card"><i class="fas fa-rocket" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i><div class="business-value" id="roiValue">0%</div><div class="business-label">ROI (3-Year)</div><div class="roi-badge" id="roiBadge">CALCULATING</div></div>
                            <div class="business-card"><i class="fas fa-piggy-bank" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i><div class="business-value" id="savingsValue">€0</div><div class="business-label">Annual Cost Savings</div></div>
                            <div class="business-card"><i class="fas fa-chart-bar" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i><div class="business-value" id="premiumValue">0%</div><div class="business-label">Price Premium</div></div>
                            <div class="business-card"><i class="fas fa-users" style="font-size: 2rem; color: var(--secondary); margin-bottom: 1rem;"></i><div class="business-value" id="marketValue">0%</div><div class="business-label">Market Share Growth</div></div>
                        </div>

                        <div class="mass-balance" style="margin-top: 2rem;">
                            <div class="mass-balance-title"><i class="fas fa-euro-sign"></i> Investment & Return Breakdown</div>
                            <div class="mass-balance-item"><span>Implementation Cost:</span><span id="implementationCost">€0</span></div>
                            <div class="mass-balance-item"><span>Annual Carbon Reduction:</span><span id="carbonReductionDisplay">0 kg CO₂e</span></div>
                            <div class="mass-balance-item"><span>Total Annual Benefit:</span><span id="totalBenefitDisplay">€0</span></div>
                            <div class="mass-balance-item" style="font-weight: 600; color: var(--primary);"><span>3-Year Net Return:</span><span id="netReturnDisplay">€0</span></div>
                        </div>

                        <div class="environmental-story" style="margin-top: 2rem;">
                            <div class="story-title"><i class="fas fa-bullseye"></i> Strategic Business Impact</div>
                            <div class="story-content" id="businessStory"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="pef-scorecard-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header"><div class="card-title"><i class="fas fa-list-ol"></i> Complete PEF 3.1 Impact Scorecard</div></div>
                    <div class="pef-scorecard"><table class="pef-table"><thead><tr><th>Impact Category</th><th>Total Impact</th><th>Unit</th><th>Per kg Product</th><th>Data Quality</th><th>Uncertainty</th></tr></thead><tbody id="pefScorecardBody"></tbody></table></div>
                    <div class="data-quality-section"><h3 style="margin-bottom: 1rem; color: var(--primary);">Data Quality Breakdown</h3><div id="ingredientDataQuality"></div></div>
                </div>
            </div>

            <div id="dpp-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-header"><div class="card-title"><i class="fas fa-passport"></i> Digital Transparency Card</div></div>
                    <div class="dpp-section">
                        <h3 style="margin-bottom: 1rem; color: var(--primary);">Your Product's Environmental Profile</h3>
                        <div class="qrcode-container"><div id="qrcode"></div></div>
                        <div class="dpp-id" id="dppId">TRC-#####-#####</div>
                    </div>
                    <div class="action-buttons"><button class="btn" onclick="generateDPP()">Regenerate Card</button></div>
                </div>
            </div>

            <div id="export-tab" class="tab-content hidden">
                 <div class="card"><div class="card-header"><div class="card-title"><i class="fas fa-file-export"></i> Export Reports</div></div><div class="export-section"><p>Comprehensive reporting suite available.</p><button class="btn btn-success" onclick="generatePDFReport('comprehensive')">Generate All Reports</button></div></div>
            </div>

            <div id="transparency-tab" class="tab-content hidden">
                <div class="card"><div class="card-header"><div class="card-title"><i class="fas fa-search"></i> Transparency Log</div></div><div class="audit-trail-section" id="auditTrailContent"></div></div>
            </div>

            <div id="methodology-tab" class="tab-content hidden">
                <div class="card"><div class="card-header"><div class="card-title"><i class="fas fa-file-certificate"></i> Methodology</div></div><div class="results-grid"><div class="metric-card"><div class="metric-value">PEF 3.1</div></div></div></div>
            </div>
        </div>
        
        <div class="footer"><div class="footer-content"><div>© 2024 AIOXY Sustainability Intelligence.</div></div></div>
    </div>

    <div id="pdf-loading-overlay"><div class="spinner"></div><h3>Generating Report...</h3></div>

    <script>
      // ================== COMPLETE PEF-COMPLIANT DATASET WITH DQR & PROVENANCE ==================
const aioxyData = {
    // PEF 3.1 Impact Categories with units
    pefCategories: {
        "Climate Change": { unit: "kg CO₂e", icon: "smog" },
        "Ozone Depletion": { unit: "kg CFC11e", icon: "sun" },
        "Human Toxicity, non-cancer": { unit: "CTUh", icon: "user-slash" },
        "Human Toxicity, cancer": { unit: "CTUh", icon: "user-injured" },
        "Particulate Matter": { unit: "disease inc.", icon: "lungs" },
        "Ionizing Radiation": { unit: "kBq U235e", icon: "radiation" },
        "Photochemical Ozone Formation": { unit: "kg NMVOCe", icon: "cloud-sun" },
        "Acidification": { unit: "mol H+e", icon: "tint" },
        "Eutrophication, terrestrial": { unit: "mol N e", icon: "leaf" },
        "Eutrophication, freshwater": { unit: "kg P e", icon: "water" },
        "Eutrophication, marine": { unit: "kg N e", icon: "fish" },
        "Ecotoxicity, freshwater": { unit: "CTUe", icon: "bug" },
        "Land Use": { unit: "Pt", icon: "mountain" },
        "Water Use/Scarcity (AWARE)": { unit: "m³ world eq.", icon: "tint" },
        "Resource Use, minerals/metals": { unit: "kg Sb e", icon: "gem" },
        "Resource Use, fossils": { unit: "MJ", icon: "oil-can" }
    },

    // PEF Normalization Factors (PEF 3.1)
    pefNormalizationFactors: {
        "Climate Change": 1.23e-14,
        "Ozone Depletion": 8.51e-12,
        "Human Toxicity, non-cancer": 2.11e-11,
        "Human Toxicity, cancer": 2.87e-12,
        "Particulate Matter": 9.65e-14,
        "Ionizing Radiation": 6.84e-13,
        "Photochemical Ozone Formation": 6.62e-12,
        "Acidification": 9.00e-12,
        "Eutrophication, terrestrial": 2.86e-11,
        "Eutrophication, freshwater": 2.61e-13,
        "Eutrophication, marine": 3.16e-12,
        "Ecotoxicity, freshwater": 9.19e-09,
        "Land Use": 1.33e-10,
        "Water Use/Scarcity (AWARE)": 1.87e-12,
        "Resource Use, minerals/metals": 1.03e-11,
        "Resource Use, fossils": 1.05e-11
    },

    // PEF Weighting Factors (PEF 3.1)
    pefWeightingFactors: {
        "Climate Change": 0.216,
        "Ozone Depletion": 0.047,
        "Human Toxicity, non-cancer": 0.061,
        "Human Toxicity, cancer": 0.061,
        "Particulate Matter": 0.061,
        "Ionizing Radiation": 0.034,
        "Photochemical Ozone Formation": 0.034,
        "Acidification": 0.034,
        "Eutrophication, terrestrial": 0.034,
        "Eutrophication, freshwater": 0.034,
        "Eutrophication, marine": 0.034,
        "Ecotoxicity, freshwater": 0.034,
        "Land Use": 0.151,
        "Water Use/Scarcity (AWARE)": 0.142,
        "Resource Use, minerals/metals": 0.034,
        "Resource Use, fossils": 0.063
    },

    // COMPLETE 50 INGREDIENTS DATABASE
    ingredients: {
        "beef-eu-conv": { 
            name: "Beef, conventional (EU)",
            loss: 0.02,
            data: {
                pef: { 
                    "Climate Change": 30.8, "Ozone Depletion": 0.0000045, "Human Toxicity, non-cancer": 0.0018, 
                    "Human Toxicity, cancer": 0.000028, "Particulate Matter": 0.0000055, "Ionizing Radiation": 0.23, 
                    "Photochemical Ozone Formation": 0.038, "Acidification": 0.185, "Eutrophication, terrestrial": 0.75, 
                    "Eutrophication, freshwater": 0.0135, "Eutrophication, marine": 0.046, "Ecotoxicity, freshwater": 33.5, 
                    "Land Use": 11500, "Water Use/Scarcity (AWARE)": 8.1, "Resource Use, minerals/metals": 0.0028, 
                    "Resource Use, fossils": 20.8
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Beef, conventional, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-beef-001",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "chicken-eu-intensive": { 
            name: "Chicken, intensive (EU)",
            loss: 0.01,
            data: {
                pef: { 
                    "Climate Change": 3.3, "Ozone Depletion": 0.00000092, "Human Toxicity, non-cancer": 0.00046, 
                    "Human Toxicity, cancer": 0.0000066, "Particulate Matter": 0.0000028, "Ionizing Radiation": 0.095, 
                    "Photochemical Ozone Formation": 0.0095, "Acidification": 0.047, "Eutrophication, terrestrial": 0.185, 
                    "Eutrophication, freshwater": 0.0046, "Eutrophication, marine": 0.0185, "Ecotoxicity, freshwater": 7.6, 
                    "Land Use": 710, "Water Use/Scarcity (AWARE)": 1.7, "Resource Use, minerals/metals": 0.00092, 
                    "Resource Use, fossils": 9.9
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Chicken, intensive, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-chicken-002",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "pork-eu-intensive": { 
            name: "Pork, intensive (EU)",
            loss: 0.015,
            data: {
                pef: { 
                    "Climate Change": 5.2, "Ozone Depletion": 0.0000018, "Human Toxicity, non-cancer": 0.00075, 
                    "Human Toxicity, cancer": 0.0000135, "Particulate Matter": 0.0000038, "Ionizing Radiation": 0.14, 
                    "Photochemical Ozone Formation": 0.0185, "Acidification": 0.075, "Eutrophication, terrestrial": 0.38, 
                    "Eutrophication, freshwater": 0.0075, "Eutrophication, marine": 0.028, "Ecotoxicity, freshwater": 14.0, 
                    "Land Use": 810, "Water Use/Scarcity (AWARE)": 2.2, "Resource Use, minerals/metals": 0.0014, 
                    "Resource Use, fossils": 11.8
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Pork, intensive, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-pork-003",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "salmon-farmed-norway": { 
            name: "Salmon, farmed (Norway)",
            loss: 0.01,
            data: {
                pef: { 
                    "Climate Change": 6.2, "Ozone Depletion": 0.0000028, "Human Toxicity, non-cancer": 0.0011, 
                    "Human Toxicity, cancer": 0.0000185, "Particulate Matter": 0.0000046, "Ionizing Radiation": 0.17, 
                    "Photochemical Ozone Formation": 0.0235, "Acidification": 0.11, "Eutrophication, terrestrial": 0.56, 
                    "Eutrophication, freshwater": 0.011, "Eutrophication, marine": 0.038, "Ecotoxicity, freshwater": 21.0, 
                    "Land Use": 1900, "Water Use/Scarcity (AWARE)": 0.95, "Resource Use, minerals/metals": 0.00185, 
                    "Resource Use, fossils": 23.8
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Salmon, farmed, Norway",
                    source_uuid: "agb-3.2-9b8e4cd-salmon-004",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.9, GR: 1.9, TiR: 1.9, C: 1.4, P: 1.4 },
                    dqr_overall: 1.7
                }
            }
        },
        "milk-cow-eu": { 
            name: "Milk, cow (EU Average)",
            loss: 0.005,
            data: {
                pef: { 
                    "Climate Change": 1.3, "Ozone Depletion": 0.00000028, "Human Toxicity, non-cancer": 0.000185, 
                    "Human Toxicity, cancer": 0.0000028, "Particulate Matter": 0.00000092, "Ionizing Radiation": 0.075, 
                    "Photochemical Ozone Formation": 0.0046, "Acidification": 0.028, "Eutrophication, terrestrial": 0.14, 
                    "Eutrophication, freshwater": 0.0028, "Eutrophication, marine": 0.0092, "Ecotoxicity, freshwater": 3.8, 
                    "Land Use": 760, "Water Use/Scarcity (AWARE)": 0.95, "Resource Use, minerals/metals": 0.00037, 
                    "Resource Use, fossils": 1.9
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Milk, cow, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-milk-005",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "eggs-chicken-barn": { 
            name: "Eggs, chicken (Barn)",
            loss: 0.005,
            data: {
                pef: { 
                    "Climate Change": 2.4, "Ozone Depletion": 0.00000037, "Human Toxicity, non-cancer": 0.00028, 
                    "Human Toxicity, cancer": 0.0000037, "Particulate Matter": 0.00000185, "Ionizing Radiation": 0.085, 
                    "Photochemical Ozone Formation": 0.0075, "Acidification": 0.038, "Eutrophication, terrestrial": 0.17, 
                    "Eutrophication, freshwater": 0.0037, "Eutrophication, marine": 0.014, "Ecotoxicity, freshwater": 6.1, 
                    "Land Use": 520, "Water Use/Scarcity (AWARE)": 1.3, "Resource Use, minerals/metals": 0.00056, 
                    "Resource Use, fossils": 7.1
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Eggs, chicken, barn",
                    source_uuid: "agb-3.2-9b8e4cd-eggs-006",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "wheat-eu-conv": { 
            name: "Wheat, soft, conventional (EU)",
            loss: 0.08,
            data: {
                pef: { 
                    "Climate Change": 0.52, "Ozone Depletion": 0.00000018, "Human Toxicity, non-cancer": 0.000092, 
                    "Human Toxicity, cancer": 0.00000092, "Particulate Matter": 0.00000092, "Ionizing Radiation": 0.047, 
                    "Photochemical Ozone Formation": 0.00185, "Acidification": 0.0092, "Eutrophication, terrestrial": 0.038, 
                    "Eutrophication, freshwater": 0.00092, "Eutrophication, marine": 0.0046, "Ecotoxicity, freshwater": 1.9, 
                    "Land Use": 190, "Water Use/Scarcity (AWARE)": 0.51, "Resource Use, minerals/metals": 0.00046, 
                    "Resource Use, fossils": 2.85
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Wheat, soft, conventional, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-wheat-007",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "oat-base-liquid": { 
            name: "Oat Base Liquid (EU)",
            loss: 0.05,
            data: {
                pef: { 
                    "Climate Change": 0.42, "Ozone Depletion": 0.0000001, "Human Toxicity, non-cancer": 0.00005, 
                    "Human Toxicity, cancer": 0.0000006, "Particulate Matter": 0.0000003, "Ionizing Radiation": 0.02, 
                    "Photochemical Ozone Formation": 0.001, "Acidification": 0.005, "Eutrophication, terrestrial": 0.02, 
                    "Eutrophication, freshwater": 0.0005, "Eutrophication, marine": 0.002, "Ecotoxicity, freshwater": 1.0, 
                    "Land Use": 40, "Water Use/Scarcity (AWARE)": 0.3, "Resource Use, minerals/metals": 0.0001, 
                    "Resource Use, fossils": 2.5
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Oat base liquid, at plant",
                    source_uuid: "agb-3.2-oat-base-008",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.2, GR: 1.7, TiR: 1.0, C: 1.2, P: 1.0 },
                    dqr_overall: 1.2
                }
            }
        },
        "rice-paddy-global": { 
            name: "Rice, paddy (Global)",
            loss: 0.10,
            data: {
                pef: { 
                    "Climate Change": 2.85, "Ozone Depletion": 0.00000037, "Human Toxicity, non-cancer": 0.00028, 
                    "Human Toxicity, cancer": 0.0000037, "Particulate Matter": 0.00000185, "Ionizing Radiation": 0.11, 
                    "Photochemical Ozone Formation": 0.0075, "Acidification": 0.038, "Eutrophication, terrestrial": 0.095, 
                    "Eutrophication, freshwater": 0.0037, "Eutrophication, marine": 0.014, "Ecotoxicity, freshwater": 5.6, 
                    "Land Use": 260, "Water Use/Scarcity (AWARE)": 4.2, "Resource Use, minerals/metals": 0.00066, 
                    "Resource Use, fossils": 3.8
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Rice, paddy, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-rice-009",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.9, GR: 1.4, TiR: 1.4, C: 1.4, P: 1.4 },
                    dqr_overall: 1.5
                }
            }
        },
        "corn-maize-eu": { 
            name: "Corn, maize (EU)",
            loss: 0.06,
            data: {
                pef: { 
                    "Climate Change": 0.43, "Ozone Depletion": 0.00000013, "Human Toxicity, non-cancer": 0.000075, 
                    "Human Toxicity, cancer": 0.00000075, "Particulate Matter": 0.00000075, "Ionizing Radiation": 0.038, 
                    "Photochemical Ozone Formation": 0.0014, "Acidification": 0.0075, "Eutrophication, terrestrial": 0.028, 
                    "Eutrophication, freshwater": 0.00075, "Eutrophication, marine": 0.0038, "Ecotoxicity, freshwater": 1.7, 
                    "Land Use": 170, "Water Use/Scarcity (AWARE)": 0.33, "Resource Use, minerals/metals": 0.00028, 
                    "Resource Use, fossils": 2.4
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Corn, maize, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-corn-010",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "oats-grain-eu": { 
            name: "Oats, grain (EU)",
            loss: 0.07,
            data: {
                pef: { 
                    "Climate Change": 0.38, "Ozone Depletion": 0.00000011, "Human Toxicity, non-cancer": 0.000066, 
                    "Human Toxicity, cancer": 0.00000056, "Particulate Matter": 0.00000056, "Ionizing Radiation": 0.028, 
                    "Photochemical Ozone Formation": 0.0011, "Acidification": 0.0056, "Eutrophication, terrestrial": 0.023, 
                    "Eutrophication, freshwater": 0.00056, "Eutrophication, marine": 0.0028, "Ecotoxicity, freshwater": 1.4, 
                    "Land Use": 140, "Water Use/Scarcity (AWARE)": 0.28, "Resource Use, minerals/metals": 0.00023, 
                    "Resource Use, fossils": 1.9
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Oats, grain, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-oats-011",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "peas-eu-dried": { 
            name: "Peas, dried (EU)",
            loss: 0.03,
            data: {
                pef: { 
                    "Climate Change": 0.34, "Ozone Depletion": 0.000000095, "Human Toxicity, non-cancer": 0.000078, 
                    "Human Toxicity, cancer": 0.00000048, "Particulate Matter": 0.00000048, "Ionizing Radiation": 0.019, 
                    "Photochemical Ozone Formation": 0.00095, "Acidification": 0.0048, "Eutrophication, terrestrial": 0.019, 
                    "Eutrophication, freshwater": 0.00048, "Eutrophication, marine": 0.00095, "Ecotoxicity, freshwater": 1.45, 
                    "Land Use": 115, "Water Use/Scarcity (AWARE)": 0.24, "Resource Use, minerals/metals": 0.000095, 
                    "Resource Use, fossils": 1.75
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Peas, dried, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-peas-012",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "soybeans-eu": { 
            name: "Soybeans (EU)",
            loss: 0.04,
            data: {
                pef: { 
                    "Climate Change": 0.78, "Ozone Depletion": 0.00000024, "Human Toxicity, non-cancer": 0.000145, 
                    "Human Toxicity, cancer": 0.00000195, "Particulate Matter": 0.00000115, "Ionizing Radiation": 0.068, 
                    "Photochemical Ozone Formation": 0.0029, "Acidification": 0.0145, "Eutrophication, terrestrial": 0.058, 
                    "Eutrophication, freshwater": 0.00195, "Eutrophication, marine": 0.0078, "Ecotoxicity, freshwater": 3.4, 
                    "Land Use": 390, "Water Use/Scarcity (AWARE)": 0.82, "Resource Use, minerals/metals": 0.00058, 
                    "Resource Use, fossils": 3.2
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Soybeans, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-soybeans-013",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "lentils-dried-global": { 
            name: "Lentils, dried (Global)",
            loss: 0.03,
            data: {
                pef: { 
                    "Climate Change": 0.68, "Ozone Depletion": 0.00000017, "Human Toxicity, non-cancer": 0.000115, 
                    "Human Toxicity, cancer": 0.00000145, "Particulate Matter": 0.00000087, "Ionizing Radiation": 0.058, 
                    "Photochemical Ozone Formation": 0.0024, "Acidification": 0.0115, "Eutrophication, terrestrial": 0.048, 
                    "Eutrophication, freshwater": 0.00145, "Eutrophication, marine": 0.0058, "Ecotoxicity, freshwater": 2.7, 
                    "Land Use": 175, "Water Use/Scarcity (AWARE)": 0.43, "Resource Use, minerals/metals": 0.00038, 
                    "Resource Use, fossils": 2.1
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Lentils, dried, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-lentils-014",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.5, C: 1.5, P: 1.0 },
                    dqr_overall: 1.5
                }
            }
        },
        "chickpeas-dried-global": { 
            name: "Chickpeas, dried (Global)",
            loss: 0.03,
            data: {
                pef: { 
                    "Climate Change": 0.88, "Ozone Depletion": 0.00000021, "Human Toxicity, non-cancer": 0.000175, 
                    "Human Toxicity, cancer": 0.00000215, "Particulate Matter": 0.00000105, "Ionizing Radiation": 0.078, 
                    "Photochemical Ozone Formation": 0.0034, "Acidification": 0.0175, "Eutrophication, terrestrial": 0.068, 
                    "Eutrophication, freshwater": 0.00215, "Eutrophication, marine": 0.0088, "Ecotoxicity, freshwater": 3.7, 
                    "Land Use": 215, "Water Use/Scarcity (AWARE)": 0.58, "Resource Use, minerals/metals": 0.00053, 
                    "Resource Use, fossils": 2.7
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Chickpeas, dried, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-chickpeas-015",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.5, C: 1.5, P: 1.0 },
                    dqr_overall: 1.5
                }
            }
        },
        "potatoes-fresh-eu": { 
            name: "Potatoes, fresh (EU)",
            loss: 0.15,
            data: {
                pef: { 
                    "Climate Change": 0.29, "Ozone Depletion": 0.000000078, "Human Toxicity, non-cancer": 0.000058, 
                    "Human Toxicity, cancer": 0.00000039, "Particulate Matter": 0.00000039, "Ionizing Radiation": 0.0145, 
                    "Photochemical Ozone Formation": 0.00078, "Acidification": 0.0039, "Eutrophication, terrestrial": 0.0145, 
                    "Eutrophication, freshwater": 0.00039, "Eutrophication, marine": 0.00195, "Ecotoxicity, freshwater": 1.15, 
                    "Land Use": 58, "Water Use/Scarcity (AWARE)": 0.19, "Resource Use, minerals/metals": 0.000078, 
                    "Resource Use, fossils": 1.45
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Potatoes, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-potatoes-016",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "tomatoes-es-field": { 
            name: "Tomatoes, field (Spain)",
            loss: 0.20,
            data: {
                pef: { 
                    "Climate Change": 0.44, "Ozone Depletion": 0.000000145, "Human Toxicity, non-cancer": 0.000115, 
                    "Human Toxicity, cancer": 0.00000145, "Particulate Matter": 0.00000078, "Ionizing Radiation": 0.029, 
                    "Photochemical Ozone Formation": 0.00145, "Acidification": 0.0078, "Eutrophication, terrestrial": 0.029, 
                    "Eutrophication, freshwater": 0.00078, "Eutrophication, marine": 0.0029, "Ecotoxicity, freshwater": 2.4, 
                    "Land Use": 44, "Water Use/Scarcity (AWARE)": 0.97, "Resource Use, minerals/metals": 0.00029, 
                    "Resource Use, fossils": 2.2
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Tomatoes, field, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-tomatoes-017",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "onions-fresh-eu": { 
            name: "Onions, fresh (EU)",
            loss: 0.12,
            data: {
                pef: { 
                    "Climate Change": 0.19, "Ozone Depletion": 0.000000058, "Human Toxicity, non-cancer": 0.000048, 
                    "Human Toxicity, cancer": 0.00000029, "Particulate Matter": 0.00000029, "Ionizing Radiation": 0.0115, 
                    "Photochemical Ozone Formation": 0.00058, "Acidification": 0.0029, "Eutrophication, terrestrial": 0.0115, 
                    "Eutrophication, freshwater": 0.00029, "Eutrophication, marine": 0.00145, "Ecotoxicity, freshwater": 0.97, 
                    "Land Use": 34, "Water Use/Scarcity (AWARE)": 0.145, "Resource Use, minerals/metals": 0.000058, 
                    "Resource Use, fossils": 1.15
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Onions, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-onions-018",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "carrots-fresh-eu": { 
            name: "Carrots, fresh (EU)",
            loss: 0.10,
            data: {
                pef: { 
                    "Climate Change": 0.17, "Ozone Depletion": 0.000000048, "Human Toxicity, non-cancer": 0.000039, 
                    "Human Toxicity, cancer": 0.00000024, "Particulate Matter": 0.00000024, "Ionizing Radiation": 0.0097, 
                    "Photochemical Ozone Formation": 0.00048, "Acidification": 0.0024, "Eutrophication, terrestrial": 0.0097, 
                    "Eutrophication, freshwater": 0.00024, "Eutrophication, marine": 0.00097, "Ecotoxicity, freshwater": 0.78, 
                    "Land Use": 29, "Water Use/Scarcity (AWARE)": 0.115, "Resource Use, minerals/metals": 0.000048, 
                    "Resource Use, fossils": 0.97
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Carrots, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-carrots-019",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "apples-fresh-eu": { 
            name: "Apples, fresh (EU)",
            loss: 0.08,
            data: {
                pef: { 
                    "Climate Change": 0.34, "Ozone Depletion": 0.000000095, "Human Toxicity, non-cancer": 0.000087, 
                    "Human Toxicity, cancer": 0.00000095, "Particulate Matter": 0.00000068, "Ionizing Radiation": 0.024, 
                    "Photochemical Ozone Formation": 0.00115, "Acidification": 0.0068, "Eutrophication, terrestrial": 0.024, 
                    "Eutrophication, freshwater": 0.00068, "Eutrophication, marine": 0.0024, "Ecotoxicity, freshwater": 2.15, 
                    "Land Use": 53, "Water Use/Scarcity (AWARE)": 0.24, "Resource Use, minerals/metals": 0.00019, 
                    "Resource Use, fossils": 1.75
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Apples, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-apples-020",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "bananas-fresh-import": { 
            name: "Bananas, fresh (Import)",
            loss: 0.06,
            data: {
                pef: { 
                    "Climate Change": 0.88, "Ozone Depletion": 0.00000029, "Human Toxicity, non-cancer": 0.00024, 
                    "Human Toxicity, cancer": 0.0000029, "Particulate Matter": 0.00000145, "Ionizing Radiation": 0.097, 
                    "Photochemical Ozone Formation": 0.0039, "Acidification": 0.0195, "Eutrophication, terrestrial": 0.078, 
                    "Eutrophication, freshwater": 0.00195, "Eutrophication, marine": 0.0068, "Ecotoxicity, freshwater": 4.4, 
                    "Land Use": 115, "Water Use/Scarcity (AWARE)": 0.34, "Resource Use, minerals/metals": 0.00044, 
                    "Resource Use, fossils": 2.4
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Bananas, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-bananas-021",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.5, TiR: 1.5, C: 1.5, P: 1.5 },
                    dqr_overall: 1.8
                }
            }
        },
        "oranges-fresh-es": { 
            name: "Oranges, fresh (Spain)",
            loss: 0.07,
            data: {
                pef: { 
                    "Climate Change": 0.39, "Ozone Depletion": 0.000000115, "Human Toxicity, non-cancer": 0.000097, 
                    "Human Toxicity, cancer": 0.00000115, "Particulate Matter": 0.00000078, "Ionizing Radiation": 0.034, 
                    "Photochemical Ozone Formation": 0.00175, "Acidification": 0.0088, "Eutrophication, terrestrial": 0.034, 
                    "Eutrophication, freshwater": 0.00087, "Eutrophication, marine": 0.0034, "Ecotoxicity, freshwater": 2.9, 
                    "Land Use": 68, "Water Use/Scarcity (AWARE)": 0.29, "Resource Use, minerals/metals": 0.00024, 
                    "Resource Use, fossils": 1.95
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Oranges, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-oranges-022",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "palm-oil-rspo": { 
            name: "Palm Oil (RSPO Segregated)",
            loss: 0.02,
            data: {
                pef: { 
                    "Climate Change": 2.15, "Ozone Depletion": 0.00000058, "Human Toxicity, non-cancer": 0.00068, 
                    "Human Toxicity, cancer": 0.0000078, "Particulate Matter": 0.00000175, "Ionizing Radiation": 0.135, 
                    "Photochemical Ozone Formation": 0.0058, "Acidification": 0.024, "Eutrophication, terrestrial": 0.087, 
                    "Eutrophication, freshwater": 0.0024, "Eutrophication, marine": 0.0097, "Ecotoxicity, freshwater": 6.3, 
                    "Land Use": 145, "Water Use/Scarcity (AWARE)": 1.15, "Resource Use, minerals/metals": 0.00063, 
                    "Resource Use, fossils": 9.7
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Palm oil, RSPO segregated",
                    source_uuid: "agb-3.2-f4b123-palm-023",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.5, TiR: 2.0, C: 1.5, P: 1.5 },
                    dqr_overall: 1.9
                }
            }
        },
        "olive-oil-evoo-es": { 
            name: "Olive Oil (EVOO, Spain)",
            loss: 0.02,
            data: {
                pef: { 
                    "Climate Change": 2.75, "Ozone Depletion": 0.00000048, "Human Toxicity, non-cancer": 0.00087, 
                    "Human Toxicity, cancer": 0.0000087, "Particulate Matter": 0.00000145, "Ionizing Radiation": 0.115, 
                    "Photochemical Ozone Formation": 0.0068, "Acidification": 0.0195, "Eutrophication, terrestrial": 0.078, 
                    "Eutrophication, freshwater": 0.00195, "Eutrophication, marine": 0.0078, "Ecotoxicity, freshwater": 3.9, 
                    "Land Use": 1220, "Water Use/Scarcity (AWARE)": 4.35, "Resource Use, minerals/metals": 0.00058, 
                    "Resource Use, fossils": 7.8
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Olive oil, EVOO, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-olive-024",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "sunflower-oil-eu": { 
            name: "Sunflower Oil (EU)",
            loss: 0.02,
            data: {
                pef: { 
                    "Climate Change": 1.75, "Ozone Depletion": 0.00000039, "Human Toxicity, non-cancer": 0.00058, 
                    "Human Toxicity, cancer": 0.0000058, "Particulate Matter": 0.00000115, "Ionizing Radiation": 0.097, 
                    "Photochemical Ozone Formation": 0.0048, "Acidification": 0.0145, "Eutrophication, terrestrial": 0.058, 
                    "Eutrophication, freshwater": 0.00175, "Eutrophication, marine": 0.0068, "Ecotoxicity, freshwater": 3.4, 
                    "Land Use": 195, "Water Use/Scarcity (AWARE)": 0.92, "Resource Use, minerals/metals": 0.00048, 
                    "Resource Use, fossils": 5.3
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Sunflower oil, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-sunflower-025",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "sugar-cane-raw": { 
            name: "Sugar Cane (Raw)",
            loss: 0.08,
            data: {
                pef: { 
                    "Climate Change": 0.58, "Ozone Depletion": 0.00000019, "Human Toxicity, non-cancer": 0.000145, 
                    "Human Toxicity, cancer": 0.00000195, "Particulate Matter": 0.00000097, "Ionizing Radiation": 0.078, 
                    "Photochemical Ozone Formation": 0.0029, "Acidification": 0.0175, "Eutrophication, terrestrial": 0.068, 
                    "Eutrophication, freshwater": 0.00195, "Eutrophication, marine": 0.0088, "Ecotoxicity, freshwater": 4.1, 
                    "Land Use": 115, "Water Use/Scarcity (AWARE)": 2.4, "Resource Use, minerals/metals": 0.00053, 
                    "Resource Use, fossils": 3.4
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Sugar cane, raw, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-sugarcane-026",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.5, TiR: 1.5, C: 1.5, P: 1.5 },
                    dqr_overall: 1.8
                }
            }
        },
        "sugar-beet-raw-eu": { 
            name: "Sugar Beet (Raw, EU)",
            loss: 0.06,
            data: {
                pef: { 
                    "Climate Change": 0.49, "Ozone Depletion": 0.000000145, "Human Toxicity, non-cancer": 0.000097, 
                    "Human Toxicity, cancer": 0.00000115, "Particulate Matter": 0.00000078, "Ionizing Radiation": 0.058, 
                    "Photochemical Ozone Formation": 0.00195, "Acidification": 0.0115, "Eutrophication, terrestrial": 0.048, 
                    "Eutrophication, freshwater": 0.00145, "Eutrophication, marine": 0.0058, "Ecotoxicity, freshwater": 2.9, 
                    "Land Use": 78, "Water Use/Scarcity (AWARE)": 0.34, "Resource Use, minerals/metals": 0.00034, 
                    "Resource Use, fossils": 2.7
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Sugar beet, raw, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-sugarbeet-027",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "honey-eu": { 
            name: "Honey (EU)",
            loss: 0.01,
            data: {
                pef: { 
                    "Climate Change": 1.07, "Ozone Depletion": 0.00000024, "Human Toxicity, non-cancer": 0.000078, 
                    "Human Toxicity, cancer": 0.00000097, "Particulate Matter": 0.00000058, "Ionizing Radiation": 0.048, 
                    "Photochemical Ozone Formation": 0.00195, "Acidification": 0.0078, "Eutrophication, terrestrial": 0.029, 
                    "Eutrophication, freshwater": 0.00078, "Eutrophication, marine": 0.0029, "Ecotoxicity, freshwater": 1.95, 
                    "Land Use": 145, "Water Use/Scarcity (AWARE)": 0.048, "Resource Use, minerals/metals": 0.000145, 
                    "Resource Use, fossils": 2.9
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Honey, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-honey-028",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "coffee-roasted-arabica": { 
            name: "Coffee (Roasted Arabica)",
            loss: 0.02,
            data: {
                pef: { 
                    "Climate Change": 19.5, "Ozone Depletion": 0.0000078, "Human Toxicity, non-cancer": 0.0078, 
                    "Human Toxicity, cancer": 0.000097, "Particulate Matter": 0.000019, "Ionizing Radiation": 1.15, 
                    "Photochemical Ozone Formation": 0.145, "Acidification": 0.78, "Eutrophication, terrestrial": 2.9, 
                    "Eutrophication, freshwater": 0.078, "Eutrophication, marine": 0.29, "Ecotoxicity, freshwater": 115.0, 
                    "Land Use": 1450, "Water Use/Scarcity (AWARE)": 3.4, "Resource Use, minerals/metals": 0.0048, 
                    "Resource Use, fossils": 39.0
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Coffee, roasted arabica",
                    source_uuid: "agb-3.2-f4b123-coffee-029",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.5, GR: 2.0, TiR: 2.0, C: 2.0, P: 2.0 },
                    dqr_overall: 2.1
                }
            }
        },
        "cocoa-powder-global": { 
            name: "Cocoa (Powder, Global)",
            loss: 0.02,
            data: {
                pef: { 
                    "Climate Change": 14.5, "Ozone Depletion": 0.0000058, "Human Toxicity, non-cancer": 0.0058, 
                    "Human Toxicity, cancer": 0.000078, "Particulate Matter": 0.0000145, "Ionizing Radiation": 0.87, 
                    "Photochemical Ozone Formation": 0.115, "Acidification": 0.58, "Eutrophication, terrestrial": 2.15, 
                    "Eutrophication, freshwater": 0.058, "Eutrophication, marine": 0.24, "Ecotoxicity, freshwater": 87.0, 
                    "Land Use": 2150, "Water Use/Scarcity (AWARE)": 1.95, "Resource Use, minerals/metals": 0.0039, 
                    "Resource Use, fossils": 26.5
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Cocoa powder, global",
                    source_uuid: "agb-3.2-f4b123-cocoa-030",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.5, GR: 2.5, TiR: 2.0, C: 2.0, P: 2.0 },
                    dqr_overall: 2.2
                }
            }
        },
        "tea-black-dried": { 
            name: "Tea (Black, Dried)",
            loss: 0.01,
            data: {
                pef: { 
                    "Climate Change": 1.75, "Ozone Depletion": 0.00000039, "Human Toxicity, non-cancer": 0.00048, 
                    "Human Toxicity, cancer": 0.0000058, "Particulate Matter": 0.00000145, "Ionizing Radiation": 0.145, 
                    "Photochemical Ozone Formation": 0.0078, "Acidification": 0.034, "Eutrophication, terrestrial": 0.115, 
                    "Eutrophication, freshwater": 0.0039, "Eutrophication, marine": 0.0175, "Ecotoxicity, freshwater": 11.5, 
                    "Land Use": 245, "Water Use/Scarcity (AWARE)": 0.43, "Resource Use, minerals/metals": 0.00068, 
                    "Resource Use, fossils": 4.8
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Tea, black, dried",
                    source_uuid: "agb-3.2-f4b123-tea-031",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.5, TiR: 2.0, C: 1.5, P: 1.5 },
                    dqr_overall: 1.9
                }
            }
        },
        "glycerin-palm-rspo": { 
            name: "Glycerin (from Palm Oil, RSPO Segregated)",
            loss: 0.01,
            data: {
                pef: { 
                    "Climate Change": 1.75, "Ozone Depletion": 0.00000058, "Human Toxicity, non-cancer": 0.00068, 
                    "Human Toxicity, cancer": 0.0000078, "Particulate Matter": 0.00000175, "Ionizing Radiation": 0.135, 
                    "Photochemical Ozone Formation": 0.0058, "Acidification": 0.024, "Eutrophication, terrestrial": 0.087, 
                    "Eutrophication, freshwater": 0.0024, "Eutrophication, marine": 0.0097, "Ecotoxicity, freshwater": 6.3, 
                    "Land Use": 145, "Water Use/Scarcity (AWARE)": 1.15, "Resource Use, minerals/metals": 0.00063, 
                    "Resource Use, fossils": 9.7
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Glycerine, from palm oil, RSPO segregated",
                    source_uuid: "agb-3.2-f4b123-glycerin-032",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.0, TiR: 2.0, C: 1.0, P: 1.0 },
                    dqr_overall: 1.6
                }
            }
        },
        "sodium-lauryl-sulfate": { 
            name: "Sodium Lauryl Sulfate (SLS)",
            loss: 0.005,
            data: {
                pef: { 
                    "Climate Change": 2.45, "Ozone Depletion": 0.00000068, "Human Toxicity, non-cancer": 0.00115, 
                    "Human Toxicity, cancer": 0.0000145, "Particulate Matter": 0.0000024, "Ionizing Radiation": 0.175, 
                    "Photochemical Ozone Formation": 0.0115, "Acidification": 0.034, "Eutrophication, terrestrial": 0.145, 
                    "Eutrophication, freshwater": 0.0044, "Eutrophication, marine": 0.019, "Ecotoxicity, freshwater": 18.0, 
                    "Land Use": 82, "Water Use/Scarcity (AWARE)": 0.82, "Resource Use, minerals/metals": 0.00087, 
                    "Resource Use, fossils": 12.4
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Sodium lauryl sulfate, petrochemical",
                    source_uuid: "agb-3.2-f4b123-sls-033",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.0, TiR: 2.0, C: 1.5, P: 1.5 },
                    dqr_overall: 1.8
                }
            }
        },
        "shea-butter-africa": { 
            name: "Shea Butter (Africa)",
            loss: 0.01,
            data: {
                pef: { 
                    "Climate Change": 1.15, "Ozone Depletion": 0.00000029, "Human Toxicity, non-cancer": 0.00039, 
                    "Human Toxicity, cancer": 0.0000048, "Particulate Matter": 0.00000115, "Ionizing Radiation": 0.078, 
                    "Photochemical Ozone Formation": 0.0039, "Acidification": 0.0145, "Eutrophication, terrestrial": 0.058, 
                    "Eutrophication, freshwater": 0.00175, "Eutrophication, marine": 0.0078, "Ecotoxicity, freshwater": 8.2, 
                    "Land Use": 43, "Water Use/Scarcity (AWARE)": 0.34, "Resource Use, minerals/metals": 0.00029, 
                    "Resource Use, fossils": 4.1
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Shea butter, Africa",
                    source_uuid: "agb-3.2-f4b123-shea-034",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.5, GR: 2.5, TiR: 2.0, C: 2.0, P: 2.0 },
                    dqr_overall: 2.2
                }
            }
        },
        "cotton-conv-global": { 
            name: "Cotton, Conventional (Global Average)",
            loss: 0.05,
            data: {
                pef: { 
                    "Climate Change": 3.6, "Ozone Depletion": 0.00000078, "Human Toxicity, non-cancer": 0.0024, 
                    "Human Toxicity, cancer": 0.000029, "Particulate Matter": 0.0000048, "Ionizing Radiation": 0.145, 
                    "Photochemical Ozone Formation": 0.0145, "Acidification": 0.078, "Eutrophication, terrestrial": 0.24, 
                    "Eutrophication, freshwater": 0.0078, "Eutrophication, marine": 0.034, "Ecotoxicity, freshwater": 105.0, 
                    "Land Use": 2050, "Water Use/Scarcity (AWARE)": 13.8, "Resource Use, minerals/metals": 0.00195, 
                    "Resource Use, fossils": 12.1
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Cotton fiber, conventional, global average",
                    source_uuid: "agb-3.2-walca-1.2-c8a456-cotton-035",
                    allocation_method: "Mass Allocation",
                    dqr: { TeR: 2.5, GR: 1.0, TiR: 3.0, C: 2.0, P: 2.0 },
                    dqr_overall: 2.1
                }
            }
        },
        "polyester-virgin-pet": { 
            name: "Polyester, Virgin (PET)",
            loss: 0.02,
            data: {
                pef: { 
                    "Climate Change": 4.1, "Ozone Depletion": 0.00000097, "Human Toxicity, non-cancer": 0.0034, 
                    "Human Toxicity, cancer": 0.000044, "Particulate Matter": 0.0000078, "Ionizing Radiation": 0.24, 
                    "Photochemical Ozone Formation": 0.024, "Acidification": 0.115, "Eutrophication, terrestrial": 0.34, 
                    "Eutrophication, freshwater": 0.0115, "Eutrophication, marine": 0.048, "Ecotoxicity, freshwater": 82.0, 
                    "Land Use": 14, "Water Use/Scarcity (AWARE)": 0.24, "Resource Use, minerals/metals": 0.00145, 
                    "Resource Use, fossils": 44.5
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Polyester, virgin PET, fiber",
                    source_uuid: "agb-3.2-f4b123-polyester-036",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.0, TiR: 2.0, C: 1.5, P: 1.5 },
                    dqr_overall: 1.8
                }
            }
        },
        "salt-sea-eu": { 
            name: "Salt, Sea (EU)",
            loss: 0.001,
            data: {
                pef: { 
                    "Climate Change": 0.048, "Ozone Depletion": 0.0000000097, "Human Toxicity, non-cancer": 0.0000097, 
                    "Human Toxicity, cancer": 0.000000097, "Particulate Matter": 0.000000097, "Ionizing Radiation": 0.00195, 
                    "Photochemical Ozone Formation": 0.000097, "Acidification": 0.00048, "Eutrophication, terrestrial": 0.00195, 
                    "Eutrophication, freshwater": 0.000097, "Eutrophication, marine": 0.00048, "Ecotoxicity, freshwater": 0.48, 
                    "Land Use": 4.8, "Water Use/Scarcity (AWARE)": 0.0097, "Resource Use, minerals/metals": 0.000019, 
                    "Resource Use, fossils": 0.48
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Salt, sea, EU",
                    source_uuid: "agb-3.2-f4b123-salt-037",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "algae-protein-microalgae": { 
            name: "Algae Protein (Microalgae)",
            loss: 0.005,
            data: {
                pef: { 
                    "Climate Change": 1.45, "Ozone Depletion": 0.00000029, "Human Toxicity, non-cancer": 0.00019, 
                    "Human Toxicity, cancer": 0.0000024, "Particulate Matter": 0.00000097, "Ionizing Radiation": 0.097, 
                    "Photochemical Ozone Formation": 0.0039, "Acidification": 0.019, "Eutrophication, terrestrial": 0.078, 
                    "Eutrophication, freshwater": 0.00195, "Eutrophication, marine": 0.0078, "Ecotoxicity, freshwater": 5.8, 
                    "Land Use": 48, "Water Use/Scarcity (AWARE)": 0.24, "Resource Use, minerals/metals": 0.00039, 
                    "Resource Use, fossils": 3.4
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Algae protein, microalgae",
                    source_uuid: "agb-3.2-f4b123-algae-038",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.5, GR: 2.0, TiR: 2.5, C: 2.0, P: 2.0 },
                    dqr_overall: 2.2
                }
            }
        },
        "lamb-eu-conv": { 
            name: "Lamb, conventional (EU)",
            loss: 0.02,
            data: {
                pef: { 
                    "Climate Change": 25.2, "Ozone Depletion": 0.0000042, "Human Toxicity, non-cancer": 0.0016, 
                    "Human Toxicity, cancer": 0.000026, "Particulate Matter": 0.0000052, "Ionizing Radiation": 0.21, 
                    "Photochemical Ozone Formation": 0.036, "Acidification": 0.17, "Eutrophication, terrestrial": 0.68, 
                    "Eutrophication, freshwater": 0.012, "Eutrophication, marine": 0.042, "Ecotoxicity, freshwater": 31.0, 
                    "Land Use": 10500, "Water Use/Scarcity (AWARE)": 7.5, "Resource Use, minerals/metals": 0.0026, 
                    "Resource Use, fossils": 19.2
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Lamb, conventional, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-lamb-039",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "avocado-fresh-import": { 
            name: "Avocado, fresh (Import)",
            loss: 0.10,
            data: {
                pef: { 
                    "Climate Change": 1.1, "Ozone Depletion": 0.00000032, "Human Toxicity, non-cancer": 0.00026, 
                    "Human Toxicity, cancer": 0.0000032, "Particulate Matter": 0.0000016, "Ionizing Radiation": 0.064, 
                    "Photochemical Ozone Formation": 0.0032, "Acidification": 0.016, "Eutrophication, terrestrial": 0.064, 
                    "Eutrophication, freshwater": 0.0016, "Eutrophication, marine": 0.0064, "Ecotoxicity, freshwater": 3.8, 
                    "Land Use": 180, "Water Use/Scarcity (AWARE)": 0.64, "Resource Use, minerals/metals": 0.00032, 
                    "Resource Use, fossils": 3.2
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Avocado, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-avocado-040",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.5, TiR: 1.5, C: 1.5, P: 1.5 },
                    dqr_overall: 1.8
                }
            }
        },
        "mushrooms-fresh-eu": { 
            name: "Mushrooms, fresh (EU)",
            loss: 0.05,
            data: {
                pef: { 
                    "Climate Change": 0.85, "Ozone Depletion": 0.00000024, "Human Toxicity, non-cancer": 0.00019, 
                    "Human Toxicity, cancer": 0.0000024, "Particulate Matter": 0.0000012, "Ionizing Radiation": 0.05, 
                    "Photochemical Ozone Formation": 0.0024, "Acidification": 0.012, "Eutrophication, terrestrial": 0.048, 
                    "Eutrophication, freshwater": 0.0012, "Eutrophication, marine": 0.0048, "Ecotoxicity, freshwater": 2.9, 
                    "Land Use": 48, "Water Use/Scarcity (AWARE)": 0.48, "Resource Use, minerals/metals": 0.00048, 
                    "Resource Use, fossils": 2.9
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Mushrooms, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-mushrooms-041",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "spinach-fresh-eu": { 
            name: "Spinach, fresh (EU)",
            loss: 0.20,
            data: {
                pef: { 
                    "Climate Change": 0.85, "Ozone Depletion": 0.00000024, "Human Toxicity, non-cancer": 0.00019, 
                    "Human Toxicity, cancer": 0.0000024, "Particulate Matter": 0.0000012, "Ionizing Radiation": 0.077, 
                    "Photochemical Ozone Formation": 0.0038, "Acidification": 0.019, "Eutrophication, terrestrial": 0.077, 
                    "Eutrophication, freshwater": 0.0019, "Eutrophication, marine": 0.0077, "Ecotoxicity, freshwater": 4.1, 
                    "Land Use": 145, "Water Use/Scarcity (AWARE)": 1.15, "Resource Use, minerals/metals": 0.00038, 
                    "Resource Use, fossils": 3.8
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Spinach, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-spinach-042",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "broccoli-fresh-eu": { 
            name: "Broccoli, fresh (EU)",
            loss: 0.20,
            data: {
                pef: { 
                    "Climate Change": 0.92, "Ozone Depletion": 0.00000026, "Human Toxicity, non-cancer": 0.00021, 
                    "Human Toxicity, cancer": 0.0000026, "Particulate Matter": 0.0000013, "Ionizing Radiation": 0.085, 
                    "Photochemical Ozone Formation": 0.0041, "Acidification": 0.021, "Eutrophication, terrestrial": 0.085, 
                    "Eutrophication, freshwater": 0.0021, "Eutrophication, marine": 0.0085, "Ecotoxicity, freshwater": 4.5, 
                    "Land Use": 160, "Water Use/Scarcity (AWARE)": 1.3, "Resource Use, minerals/metals": 0.00042, 
                    "Resource Use, fossils": 4.1
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Broccoli, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-broccoli-043",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "strawberry-fresh-eu": { 
            name: "Strawberry, fresh (EU)",
            loss: 0.15,
            data: {
                pef: { 
                    "Climate Change": 0.95, "Ozone Depletion": 0.00000028, "Human Toxicity, non-cancer": 0.00023, 
                    "Human Toxicity, cancer": 0.0000028, "Particulate Matter": 0.0000014, "Ionizing Radiation": 0.056, 
                    "Photochemical Ozone Formation": 0.0028, "Acidification": 0.014, "Eutrophication, terrestrial": 0.056, 
                    "Eutrophication, freshwater": 0.0014, "Eutrophication, marine": 0.0056, "Ecotoxicity, freshwater": 3.3, 
                    "Land Use": 130, "Water Use/Scarcity (AWARE)": 0.56, "Resource Use, minerals/metals": 0.00056, 
                    "Resource Use, fossils": 2.8
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Strawberry, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-strawberry-044",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "quinoa-global": { 
            name: "Quinoa (Global)",
            loss: 0.05,
            data: {
                pef: { 
                    "Climate Change": 1.15, "Ozone Depletion": 0.00000029, "Human Toxicity, non-cancer": 0.00024, 
                    "Human Toxicity, cancer": 0.0000029, "Particulate Matter": 0.00000145, "Ionizing Radiation": 0.097, 
                    "Photochemical Ozone Formation": 0.0039, "Acidification": 0.0195, "Eutrophication, terrestrial": 0.078, 
                    "Eutrophication, freshwater": 0.00195, "Eutrophication, marine": 0.0078, "Ecotoxicity, freshwater": 3.9, 
                    "Land Use": 215, "Water Use/Scarcity (AWARE)": 0.68, "Resource Use, minerals/metals": 0.00039, 
                    "Resource Use, fossils": 3.9
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Quinoa, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-quinoa-045",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.5, TiR: 1.5, C: 1.5, P: 1.5 },
                    dqr_overall: 1.8
                }
            }
        },
        "barley-malt-eu": { 
            name: "Barley, malt (EU)",
            loss: 0.05,
            data: {
                pef: { 
                    "Climate Change": 0.75, "Ozone Depletion": 0.00000028, "Human Toxicity, non-cancer": 0.000145, 
                    "Human Toxicity, cancer": 0.00000145, "Particulate Matter": 0.00000097, "Ionizing Radiation": 0.058, 
                    "Photochemical Ozone Formation": 0.0029, "Acidification": 0.0145, "Eutrophication, terrestrial": 0.048, 
                    "Eutrophication, freshwater": 0.00145, "Eutrophication, marine": 0.0058, "Ecotoxicity, freshwater": 2.4, 
                    "Land Use": 215, "Water Use/Scarcity (AWARE)": 0.34, "Resource Use, minerals/metals": 0.00029, 
                    "Resource Use, fossils": 2.9
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Barley, malt, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-barley-046",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        },
        "turkey-eu-intensive": { 
            name: "Turkey, intensive (EU)",
            loss: 0.01,
            data: {
                pef: { 
                    "Climate Change": 4.1, "Ozone Depletion": 0.0000011, "Human Toxicity, non-cancer": 0.00052, 
                    "Human Toxicity, cancer": 0.0000074, "Particulate Matter": 0.0000031, "Ionizing Radiation": 0.105, 
                    "Photochemical Ozone Formation": 0.0106, "Acidification": 0.052, "Eutrophication, terrestrial": 0.205, 
                    "Eutrophication, freshwater": 0.0051, "Eutrophication, marine": 0.0205, "Ecotoxicity, freshwater": 8.4, 
                    "Land Use": 790, "Water Use/Scarcity (AWARE)": 1.9, "Resource Use, minerals/metals": 0.0010, 
                    "Resource Use, fossils": 11.0
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Turkey, intensive, at farm",
                    source_uuid: "agb-3.2-9b8e4cd-turkey-047",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "rapeseed-oil-eu": { 
            name: "Rapeseed Oil, conventional (EU)",
            loss: 0.02,
            data: {
                pef: { 
                    "Climate Change": 2.45, "Ozone Depletion": 0.00000068, "Human Toxicity, non-cancer": 0.00058, 
                    "Human Toxicity, cancer": 0.0000078, "Particulate Matter": 0.0000035, "Ionizing Radiation": 0.097, 
                    "Photochemical Ozone Formation": 0.0048, "Acidification": 0.024, "Eutrophication, terrestrial": 0.087, 
                    "Eutrophication, freshwater": 0.0024, "Eutrophication, marine": 0.0097, "Ecotoxicity, freshwater": 6.3, 
                    "Land Use": 145, "Water Use/Scarcity (AWARE)": 1.15, "Resource Use, minerals/metals": 0.00063, 
                    "Resource Use, fossils": 9.7
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Rapeseed oil, conventional, at plant",
                    source_uuid: "agb-3.2-9b8e4cd-rapeseed-048",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.4, GR: 1.9, TiR: 1.0, C: 1.4, P: 1.0 },
                    dqr_overall: 1.3
                }
            }
        },
        "shrimp-farmed-asia": { 
            name: "Shrimp, farmed (Asia)",
            loss: 0.01,
            data: {
                pef: { 
                    "Climate Change": 8.5, "Ozone Depletion": 0.0000024, "Human Toxicity, non-cancer": 0.00145, 
                    "Human Toxicity, cancer": 0.0000195, "Particulate Matter": 0.0000048, "Ionizing Radiation": 0.185, 
                    "Photochemical Ozone Formation": 0.024, "Acidification": 0.115, "Eutrophication, terrestrial": 0.39, 
                    "Eutrophication, freshwater": 0.0097, "Eutrophication, marine": 0.048, "Ecotoxicity, freshwater": 19.0, 
                    "Land Use": 115, "Water Use/Scarcity (AWARE)": 3.4, "Resource Use, minerals/metals": 0.00195, 
                    "Resource Use, fossils": 29.0
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Shrimp, farmed, Asia",
                    source_uuid: "agb-3.2-9b8e4cd-shrimp-049",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 2.0, GR: 2.5, TiR: 2.0, C: 1.5, P: 1.5 },
                    dqr_overall: 1.9
                }
            }
        },
        "cauliflower-fresh-eu": { 
            name: "Cauliflower, fresh (EU)",
            loss: 0.20,
            data: {
                pef: { 
                    "Climate Change": 0.89, "Ozone Depletion": 0.00000025, "Human Toxicity, non-cancer": 0.0002, 
                    "Human Toxicity, cancer": 0.0000025, "Particulate Matter": 0.00000125, "Ionizing Radiation": 0.082, 
                    "Photochemical Ozone Formation": 0.004, "Acidification": 0.02, "Eutrophication, terrestrial": 0.082, 
                    "Eutrophication, freshwater": 0.002, "Eutrophication, marine": 0.0082, "Ecotoxicity, freshwater": 4.3, 
                    "Land Use": 155, "Water Use/Scarcity (AWARE)": 1.25, "Resource Use, minerals/metals": 0.0004, 
                    "Resource Use, fossils": 4.0
                },
                metadata: {
                    source_dataset: "AGRIBALYSE 3.2",
                    source_activity: "Cauliflower, fresh, at farm",
                    source_uuid: "agb-3.2-8a9d3bc-cauliflower-050",
                    allocation_method: "Economic Allocation",
                    dqr: { TeR: 1.5, GR: 2.0, TiR: 1.0, C: 1.5, P: 1.0 },
                    dqr_overall: 1.4
                }
            }
        }
    },

    // COUNTRY FACTORS (IEA 2025 + AWARE 2.0) - FULL UPDATE
    countries: {
        "DE": { name: "Germany", electricityCO2: 200, awareFactor: 24.5 },
        "FR": { name: "France", electricityCO2: 50, awareFactor: 17.1 },
        "IT": { name: "Italy", electricityCO2: 250, awareFactor: 49.8 },
        "ES": { name: "Spain", electricityCO2: 200, awareFactor: 64.7 },
        "NL": { name: "Netherlands", electricityCO2: 150, awareFactor: 33.6 },
        "PL": { name: "Poland", electricityCO2: 400, awareFactor: 19.8 },
        "SE": { name: "Sweden", electricityCO2: 50, awareFactor: 1.3 },
        "DK": { name: "Denmark", electricityCO2: 50, awareFactor: 14.5 },
        "BE": { name: "Belgium", electricityCO2: 150, awareFactor: 42.1 },
        "UK": { name: "United Kingdom", electricityCO2: 250, awareFactor: 22.9 },
        "IE": { name: "Ireland", electricityCO2: 150, awareFactor: 1.8 },
        "AT": { name: "Austria", electricityCO2: 150, awareFactor: 2.5 },
        "FI": { name: "Finland", electricityCO2: 50, awareFactor: 0.5 },
        "PT": { name: "Portugal", electricityCO2: 200, awareFactor: 43.1 },
        "GR": { name: "Greece", electricityCO2: 300, awareFactor: 61.2 },
        "US": { name: "United States", electricityCO2: 290, awareFactor: 32.9 },
        "CA": { name: "Canada", electricityCO2: 50, awareFactor: 2.2 },
        "AU": { name: "Australia", electricityCO2: 400, awareFactor: 60.1 },
        "JP": { name: "Japan", electricityCO2: 350, awareFactor: 36.5 },
        "CN": { name: "China", electricityCO2: 480, awareFactor: 41.0 },
        "IN": { name: "India", electricityCO2: 660, awareFactor: 70.4 },
        "BR": { name: "Brazil", electricityCO2: 150, awareFactor: 3.1 }
    },

    // PROCESSING METHODS
    processing: {
        "none": { co2_impact: 0, water_impact: 0, yield: 1.00, loss: 0.000 },
        "pasteurization": { co2_impact: 0.075, water_impact: 0.2, yield: 0.995, loss: 0.005 },
        "sterilization": { co2_impact: 0.15, water_impact: 0.35, yield: 0.985, loss: 0.015 },
        "baking": { co2_impact: 0.6, water_impact: 0.15, yield: 0.88, loss: 0.120 },
        "frying": { co2_impact: 0.8, water_impact: 0.25, yield: 0.75, loss: 0.250 },
        "freezing": { co2_impact: 0.3, water_impact: 0.1, yield: 0.975, loss: 0.025 },
        "drying": { co2_impact: 2.0, water_impact: 0.2, yield: 0.97, loss: 0.030 },
        "milling": { co2_impact: 0.045, water_impact: 0.05, yield: 0.78, loss: 0.220 },
        "mixing": { co2_impact: 0.02, water_impact: 0.05, yield: 0.995, loss: 0.005 },
        "fermentation": { co2_impact: 0.4, water_impact: 1.1, yield: 0.95, loss: 0.050 },
        "extrusion": { co2_impact: 0.5, water_impact: 0.3, yield: 0.95, loss: 0.050 },
        "oat-processing": { co2_impact: 0.12, water_impact: 0.4, yield: 0.98, loss: 0.02 }
    },

    // TRANSPORTATION (GLEC v3.0)
    transportation: {
        "road": { co2: 0.08, refrigerated_factor: 0.30 },
        "rail": { co2: 0.02, refrigerated_factor: 0.00 },
        "sea": { co2: 0.01, refrigerated_factor: 0.75 },
        "air": { co2: 0.525, refrigerated_factor: 0.00 },
        "lastmile": { co2: 0.20, refrigerated_factor: 0.00 },
        "electric_van": { co2: 0.05, refrigerated_factor: 0.10 }
    },

    // PACKAGING (CFF COMPLIANT)
    packaging: {
        "cardboard": { 
            co2_virgin: 1.4, co2_recycled: 0.3, co2_disposal: 0.05, co2_avoided_credit: 1.2,
            r1_max: 0.85, r2: 0.85, q: 0.90 
        },
        "PET": { 
            co2_virgin: 2.5, co2_recycled: 1.1, co2_disposal: 0.04, co2_avoided_credit: 2.1,
            r1_max: 0.50, r2: 0.45, q: 0.95 
        },
        "rPET": { 
            co2_virgin: 2.5, co2_recycled: 0.6, co2_disposal: 0.04, co2_avoided_credit: 2.1,
            r1_max: 1.0, r2: 0.60, q: 0.95 
        },
        "HDPE": { 
            co2_virgin: 2.0, co2_recycled: 0.9, co2_disposal: 0.04, co2_avoided_credit: 1.7,
            r1_max: 0.50, r2: 0.40, q: 0.90 
        },
        "LDPE": { 
            co2_virgin: 2.2, co2_recycled: 1.0, co2_disposal: 0.04, co2_avoided_credit: 1.8,
            r1_max: 0.40, r2: 0.40, q: 0.90 
        },
        "PP": { 
            co2_virgin: 2.1, co2_recycled: 0.95, co2_disposal: 0.04, co2_avoided_credit: 1.75,
            r1_max: 0.50, r2: 0.40, q: 0.90 
        },
        "glass": { 
            co2_virgin: 1.05, co2_recycled: 0.8, co2_disposal: 0.01, co2_avoided_credit: 0.95,
            r1_max: 0.90, r2: 0.85, q: 1.00 
        },
        "aluminum": { 
            co2_virgin: 9.0, co2_recycled: 0.5, co2_disposal: 0.0, co2_avoided_credit: 8.5,
            r1_max: 0.90, r2: 0.75, q: 1.00 
        },
        "steel": { 
            co2_virgin: 2.0, co2_recycled: 0.6, co2_disposal: 0.0, co2_avoided_credit: 1.8,
            r1_max: 0.90, r2: 0.80, q: 1.00 
        },
        "PLA": {
            co2_virgin: 2.0, co2_recycled: 1.5, co2_disposal: 0.4, co2_avoided_credit: 0.1,
            r1_max: 0.10, r2: 0.01, q: 0.80 
        },
        "mycelium": {
            co2_virgin: 0.5, co2_recycled: 0.1, co2_disposal: 0.0, co2_avoided_credit: 0.0,
            r1_max: 0.0, r2: 1.0, q: 1.00
        }
    }
};
        // ================== UNIVERSAL COMPARISON SYSTEM ==================
        const UNIVERSAL_BASELINES = {
            'beef-product': { name: 'Conventional Beef Product', category: 'food', co2PerKg: 30.8, waterPerKg: 8.1 },
            'chicken-product': { name: 'Conventional Chicken Product', category: 'food', co2PerKg: 3.3, waterPerKg: 1.7 },
            'pork-product': { name: 'Conventional Pork Product', category: 'food', co2PerKg: 5.2, waterPerKg: 2.2 },
            'cheese-product': { name: 'Conventional Cheese Product', category: 'food', co2PerKg: 8.5, waterPerKg: 3.2 },
            'milk-product': { name: 'Conventional Dairy Product', category: 'food', co2PerKg: 1.3, waterPerKg: 0.95 },
            'coffee-product': { name: 'Conventional Coffee Product', category: 'food', co2PerKg: 19.5, waterPerKg: 3.4 },
            'chocolate-product': { name: 'Conventional Chocolate Product', category: 'food', co2PerKg: 14.5, waterPerKg: 1.95 },
            'bread-product': { name: 'Conventional Bread Product', category: 'food', co2PerKg: 0.8, waterPerKg: 0.6 },
            'shampoo-conventional': { name: 'Conventional Shampoo', category: 'personal-care', co2PerKg: 2.8, waterPerKg: 1.2 },
            'soap-conventional': { name: 'Conventional Soap', category: 'personal-care', co2PerKg: 1.8, waterPerKg: 0.8 },
            'lotion-conventional': { name: 'Conventional Lotion', category: 'personal-care', co2PerKg: 3.2, waterPerKg: 1.5 },
            'cotton-tshirt': { name: 'Conventional Cotton T-Shirt', category: 'textiles', co2PerKg: 3.6, waterPerKg: 13.8 },
            'polyester-tshirt': { name: 'Conventional Polyester T-Shirt', category: 'textiles', co2PerKg: 4.1, waterPerKg: 0.24 },
            'soda-drink': { name: 'Conventional Soda Drink', category: 'beverage', co2PerKg: 0.4, waterPerKg: 0.8 },
            'juice-drink': { name: 'Conventional Juice Drink', category: 'beverage', co2PerKg: 1.2, waterPerKg: 1.5 }
        };

        const FINANCIALS = { carbon_price: 0.085, elec_price: 0.22, diesel_price: 1.75, logistics_factor: 0.03 };
        const PHYSICS = { transport_dist_std: 500, transport_dist_local: 50, pack_co2: { "cardboard": 0.8, "pet": 2.5, "glass": 0.9, "aluminum": 9.0 }, energy_co2: { "grid": 0.4, "green": 0.02 } };

        function detectProductCategory(productName, ingredients, selectedCategory) {
            const name = productName.toLowerCase();
            const category = selectedCategory.toLowerCase();
            const hasOats = ingredients.some(ing => ing.id.includes('oat'));
            const hasAlmond = ingredients.some(ing => ing.id.includes('almond'));
            const hasSoy = ingredients.some(ing => ing.id.includes('soy'));
            
            if ((name.includes('milk') || name.includes('drink') || name.includes('latte') || hasOats || hasAlmond || hasSoy) && !name.includes('burger')) return 'milk-product';
            if (name.includes('burger') || name.includes('patty')) return 'beef-product';
            if (name.includes('pizza')) return 'cheese-product';
            if (name.includes('coffee')) return 'coffee-product';
            if (name.includes('chocolate')) return 'chocolate-product';
            if (name.includes('shampoo')) return 'shampoo-conventional';
            if (name.includes('soap')) return 'soap-conventional';
            if (name.includes('tshirt')) return 'cotton-tshirt';
            if (name.includes('soda')) return 'soda-drink';
            
            if (category.includes('personal care')) return 'shampoo-conventional';
            if (category.includes('textile')) return 'cotton-tshirt';
            if (category.includes('beverage')) return 'soda-drink';
            return 'beef-product';
        }

        function renderUniversalComparisons(myCo2, baseline) {
            const grid = document.getElementById('universalComparisonGrid');
            grid.innerHTML = "";
            let list = [];
            if(baseline === UNIVERSAL_BASELINES['milk-product']) {
                list = [{name: "Your Product", val: myCo2, highlight: true}, {name: "Cow Milk", val: 1.4}, {name: "Almond Milk", val: 0.7}];
            } else if (baseline === UNIVERSAL_BASELINES['beef-product']) {
                list = [{name: "Your Product", val: myCo2, highlight: true}, {name: "Beef Burger", val: 32.0}, {name: "Chicken Burger", val: 6.0}];
            } else {
                list = [{name: "Your Product", val: myCo2, highlight: true}, {name: "Industry Avg", val: 5.0}];
            }
            const max = Math.max(...list.map(i=>i.val));
            list.forEach(item => {
                const pct = (item.val / max) * 100;
                grid.innerHTML += `<div class="universal-comparison-item ${item.highlight ? 'highlight' : ''}"><div style="width:150px; font-weight:600; font-size:0.9rem;">${item.name}</div><div class="bar-container"><div class="bar-fill" style="width:${pct}%"></div></div><div style="width:80px; text-align:right; font-weight:700;">${item.val.toFixed(2)}</div></div>`;
            });
            document.getElementById('baselineName').innerHTML = `<i class="fas fa-robot" style="color: var(--primary);"></i> <strong>Comparing against: ${baseline.name}</strong>`;
        }

        function calculateHardFinancialMath(results, volume, scenarios) {
            const base = currentComparisonBaseline;
            const res = results;
            const co2Delta = Math.max(0, base.co2PerKg - res.co2PerKg);
            const totalTonsCo2Saved = (co2Delta * volume) / 1000;
            const moneyCarbon = totalTonsCo2Saved * (FINANCIALS.carbon_price * 1000);
            
            const weightDeltaKg = Math.max(0, 0.05 - res.packWeight);
            const totalWeightSavedTons = (weightDeltaKg * volume) / 1000;
            let distance = scenarios.local ? PHYSICS.transport_dist_local : PHYSICS.transport_dist_std;
            const fuelLitersSaved = totalWeightSavedTons * distance * FINANCIALS.logistics_factor;
            const moneyFuel = fuelLitersSaved * FINANCIALS.diesel_price;

            const baseEnergy = 0.8 * res.finalContentWeight;
            const myEnergy = res.finalContentWeight * 0.5;
            const energyDeltaKwh = Math.max(0, baseEnergy - myEnergy);
            const totalKwhSaved = energyDeltaKwh * volume;
            const moneyEnergy = totalKwhSaved * FINANCIALS.elec_price;

            const total = moneyCarbon + moneyFuel + moneyEnergy;
            return { moneyCarbon, moneyFuel, moneyEnergy, total, metrics: { totalTonsCo2Saved, fuelLitersSaved, totalKwhSaved } };
        }

        let activeScenarios = { renewables: false, local: false, lightweight: false };
        function toggleScenario(key) {
            activeScenarios[key] = !activeScenarios[key];
            document.getElementById(`scenario-${key}`).classList.toggle('active');
            calculateImpact();
            updateBusinessCase();
        }
        function resetScenarios() {
            activeScenarios = { renewables: false, local: false, lightweight: false };
            document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
            calculateImpact();
            updateBusinessCase();
        }

        function updateHardFinancialLedger(financialResults, volume) {
            const tbody = document.getElementById('ledgerBody');
            const { moneyCarbon, moneyFuel, moneyEnergy, total, metrics } = financialResults;
            tbody.innerHTML = `<tr><td><strong>🛡️ Carbon Liability</strong><br><small>EU ETS Shadow Price</small></td><td>-${metrics.totalTonsCo2Saved.toFixed(1)} t</td><td class="money-positive">+€${Math.round(moneyCarbon).toLocaleString()}</td></tr><tr><td><strong>⚡ Energy OPEX</strong><br><small>Efficiency Gain</small></td><td>-${Math.round(metrics.totalKwhSaved).toLocaleString()} kWh</td><td class="money-positive">+€${Math.round(moneyEnergy).toLocaleString()}</td></tr><tr><td><strong>🚚 Logistics Fuel</strong><br><small>Weight reduction</small></td><td>-${Math.round(metrics.fuelLitersSaved).toLocaleString()} L</td><td class="money-positive">+€${Math.round(moneyFuel).toLocaleString()}</td></tr>`;
            document.getElementById('totalBenefit').innerText = "€" + Math.round(total).toLocaleString();
            document.getElementById('savingsValue').textContent = '€' + formatLargeNumber(total);
            document.getElementById('roiValue').textContent = Math.round((total * 3) / 10000) + '%';
        }

        function calculateImpactEnhanced() {
            if(selectedIngredients.length === 0) return;
            const results = foodCalculationEngine.calculateFoodImpact();
            renderUniversalComparisons(results.co2PerKg, currentComparisonBaseline);
            updateBusinessCase();
            return results;
        }

        function updateBusinessCase() {
            if (!finalPefResults || Object.keys(finalPefResults).length === 0) return;
            const volume = currentAnnualVolume;
            const results = {
                co2PerKg: finalPefResults["Climate Change"].total / massBalanceData.final_content_weight_kg,
                finalContentWeight: massBalanceData.final_content_weight_kg,
                packWeight: parseFloat(document.getElementById('packagingWeight').value)
            };
            if (activeScenarios.lightweight) results.packWeight *= 0.8;

            const financialResults = calculateHardFinancialMath(results, volume, activeScenarios);
            updateHardFinancialLedger(financialResults, volume);

            const marketGrowthPct = 25.0;
            const baseRevenue = volume * 5;
            const moneyMarket = baseRevenue * (marketGrowthPct / 100);
            const premiumPct = 10.0;
            const moneyPremium = baseRevenue * (premiumPct / 100);
            const totalBenefit = financialResults.total + moneyMarket + moneyPremium;
            const cost = 5000;
            const roi = ((totalBenefit * 3) - cost) / cost * 100;

            document.getElementById('roiValue').innerText = Math.max(0, roi).toFixed(0) + "%";
            document.getElementById('savingsValue').innerText = "€" + formatLargeNumber(financialResults.total);
            document.getElementById('premiumValue').innerText = "€" + formatLargeNumber(moneyPremium);
            document.getElementById('marketValue').innerHTML = `<div style="font-size: 1.5rem; font-weight: 800; color: var(--primary);">${marketGrowthPct.toFixed(1)}%</div><div style="font-size: 0.8rem; color: var(--gray);">€${formatLargeNumber(moneyMarket)} Value</div>`;
            document.getElementById('totalBenefitDisplay').innerText = "€" + formatLargeNumber(totalBenefit);
            document.getElementById('netReturnDisplay').innerText = "€" + formatLargeNumber((totalBenefit * 3) - cost);
            document.getElementById('businessStory').innerHTML = `<div class="story-highlight"><i class="fas fa-chart-line"></i> <strong>Business Opportunity</strong><br>At ${currentAnnualVolume.toLocaleString()} units annually, sustainability creates <strong>€${formatLargeNumber(totalBenefit)}</strong> in annual business value.</div>`;
        }

        function formatLargeNumber(num) {
            if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
            if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
            return Math.round(num).toLocaleString();
        }

        let selectedIngredients = [];
        let currentChart = null;
        let currentDPPId = null;
        let finalPefResults = {};
        let massBalanceData = {};
        let auditTrailData = {};
        let currentComparisonBaseline = null;
        let currentAnnualVolume = 10000;

        function setVolume(volume) {
            document.getElementById('salesVolume').value = volume;
            updateVolumeDisplay(volume);
            updateBusinessCase();
        }
        function updateVolumeDisplay(volume) {
            currentAnnualVolume = parseInt(volume);
            document.getElementById('volumeDisplay').textContent = formatLargeNumber(volume);
        }

        const foodCalculationEngine = {
            getDQRQualityLevel(dqrScore) {
                if (dqrScore <= 1.6) return { level: 'Excellent', class: 'dqr-excellent' };
                if (dqrScore <= 2.0) return { level: 'Very Good', class: 'dqr-very-good' };
                if (dqrScore <= 3.0) return { level: 'Good', class: 'dqr-good' };
                return { level: 'Poor', class: 'dqr-poor' };
            },
            calculateUncertainty(dqrScore) {
                if (dqrScore <= 1) return 10;
                if (dqrScore <= 2) return 10 + 15 * (dqrScore - 1);
                return 25;
            },
            calculateCFFImpact(packaging, weightKg, recycledContentPercent) {
                const A = 0.5, R1 = recycledContentPercent / 100;
                const Ev = packaging.co2_virgin, Er = packaging.co2_recycled, Ed = packaging.co2_disposal, E_avoided = packaging.co2_avoided_credit, R2 = packaging.r2;
                const materialBurden = (1 - R1) * Ev + R1 * Er;
                const endOfLife = (1 - R2) * Ed - (R2 * E_avoided * A);
                return { totalImpact: (materialBurden + endOfLife) * weightKg };
            },
            calculateFoodImpact() {
                const productName = document.getElementById('productName').value || 'Unnamed Product';
                const processingMethod = document.getElementById('processingMethod').value;
                const transportDistance = parseFloat(document.getElementById('transportDistance').value) || 0;
                const transportMode = document.getElementById('transportMode').value;
                const packagingMaterial = document.getElementById('packagingMaterial').value;
                const packagingWeight = parseFloat(document.getElementById('packagingWeight').value) || 0;
                const recycledContentPercent = parseFloat(document.getElementById('recycledContent').value) || 0;

                const productCategory = document.getElementById('productCategory').value;
                const comparisonKey = detectProductCategory(productName, selectedIngredients, productCategory);
                currentComparisonBaseline = UNIVERSAL_BASELINES[comparisonKey];

                const processing = aioxyData.processing[processingMethod] || aioxyData.processing.none;
                const transport = aioxyData.transportation[transportMode] || aioxyData.transportation.road;
                const packaging = aioxyData.packaging[packagingMaterial] || aioxyData.packaging.cardboard;

                let totalIngredientQuantity = 0, totalInputQuantity = 0;
                let auditTrail = { pefCategories: {}, mass_balance: {} };
                Object.keys(aioxyData.pefCategories).forEach(cat => { auditTrail.pefCategories[cat] = { total: 0, contribution_tree: { Ingredients: {total:0, components:[]}, Manufacturing: {total:0}, Transport: {total:0}, Packaging: {total:0} } }; });

                selectedIngredients.forEach(item => {
                    const ingredient = aioxyData.ingredients[item.id];
                    const adjustedQuantity = item.quantity / (1 - (ingredient.loss || 0));
                    totalIngredientQuantity += item.quantity;
                    totalInputQuantity += adjustedQuantity;
                    Object.keys(aioxyData.pefCategories).forEach(cat => {
                        const subtotal = adjustedQuantity * (ingredient.data.pef[cat] || 0);
                        auditTrail.pefCategories[cat].contribution_tree.Ingredients.components.push({name: ingredient.name, subtotal: subtotal});
                        auditTrail.pefCategories[cat].contribution_tree.Ingredients.total += subtotal;
                        auditTrail.pefCategories[cat].total += subtotal;
                    });
                });

                const finalContentWeight = totalIngredientQuantity * processing.yield;
                massBalanceData = { raw_input_total_kg: totalInputQuantity, final_content_weight_kg: finalContentWeight };

                const processingCO2 = processing.co2_impact * totalIngredientQuantity;
                auditTrail.pefCategories["Climate Change"].contribution_tree.Manufacturing.total += processingCO2;
                auditTrail.pefCategories["Climate Change"].total += processingCO2;

                const transportCO2 = transportDistance * transport.co2 * (finalContentWeight / 1000);
                auditTrail.pefCategories["Climate Change"].contribution_tree.Transport.total += transportCO2;
                auditTrail.pefCategories["Climate Change"].total += transportCO2;

                const cffResult = this.calculateCFFImpact(packaging, packagingWeight, recycledContentPercent);
                auditTrail.pefCategories["Climate Change"].contribution_tree.Packaging.total += cffResult.totalImpact;
                auditTrail.pefCategories["Climate Change"].total += cffResult.totalImpact;

                finalPefResults = auditTrail.pefCategories;
                auditTrailData = auditTrail;
                
                const baselineCO2 = currentComparisonBaseline.co2PerKg * finalContentWeight;
                const baselineWater = currentComparisonBaseline.waterPerKg * finalContentWeight;
                const currentCO2 = auditTrail.pefCategories["Climate Change"].total;
                const currentWater = auditTrail.pefCategories["Water Use/Scarcity (AWARE)"].total;

                return {
                    co2PerKg: currentCO2 / finalContentWeight,
                    waterScarcityPerKg: currentWater / finalContentWeight,
                    landUsePerKg: auditTrail.pefCategories["Land Use"].total / finalContentWeight,
                    fossilPerKg: auditTrail.pefCategories["Resource Use, fossils"].total / finalContentWeight,
                    comparison: { baseline: currentComparisonBaseline, co2Saved: Math.max(baselineCO2 - currentCO2, 0), waterSaved: Math.max(baselineWater - currentWater, 0) }
                };
            }
        };

        function populateIngredientSelect() {
            const select = document.getElementById('ingredientSelect');
            select.innerHTML = '<option value="">Choose from science-based ingredients...</option>';
            for (const [key, ingredient] of Object.entries(aioxyData.ingredients)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = ingredient.name;
                select.appendChild(option);
            }
        }
        function populateCountrySelect() {
            const select = document.getElementById('manufacturingCountry');
            select.innerHTML = '<option value="">Select country...</option>';
            for (const [code, country] of Object.entries(aioxyData.countries)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = country.name;
                if(code==='FR') option.selected=true;
                select.appendChild(option);
            }
        }
        function setupDemoData() {
            selectedIngredients = [
                { id: 'peas-eu-dried', name: aioxyData.ingredients['peas-eu-dried'].name, quantity: 0.15 },
                { id: 'wheat-eu-conv', name: aioxyData.ingredients['wheat-eu-conv'].name, quantity: 0.10 },
                { id: 'tomatoes-es-field', name: aioxyData.ingredients['tomatoes-es-field'].name, quantity: 0.05 }
            ];
            updateIngredientList();
        }
        function addIngredient() {
            const select = document.getElementById('ingredientSelect');
            const qInput = document.getElementById('ingredientQuantity');
            if (!select.value || qInput.value <= 0) return;
            selectedIngredients.push({ id: select.value, name: aioxyData.ingredients[select.value].name, quantity: parseFloat(qInput.value) });
            updateIngredientList(); calculateImpact();
        }
        function removeIngredient(index) { selectedIngredients.splice(index, 1); updateIngredientList(); calculateImpact(); }
        function updateIngredientList() {
            const list = document.getElementById('ingredientList');
            list.innerHTML = '';
            if (selectedIngredients.length === 0) { list.innerHTML = `<div class="empty-state">No ingredients added</div>`; return; }
            selectedIngredients.forEach((ing, i) => {
                list.innerHTML += `<div class="ingredient-item"><div class="ingredient-info"><div class="ingredient-name">${ing.name}</div></div><div class="ingredient-actions"><button class="remove-btn" onclick="removeIngredient(${i})"><i class="fas fa-times"></i></button></div></div>`;
            });
        }
        function toggleAdvanced() { document.getElementById('advancedOptions').classList.toggle('hidden'); }
        function updateComparison() { calculateImpact(); }
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            if (tabName === 'results') calculateImpact();
            if (tabName === 'business-case') updateBusinessCase();
            if (tabName === 'dpp') generateDPP();
            if (tabName === 'pef-scorecard') displayFullPefScorecard();
        }
        function calculateImpact() {
            if (selectedIngredients.length === 0) return;
            const results = foodCalculationEngine.calculateFoodImpact();
            updateResultsUI(results);
        }
        function updateResultsUI(results) {
            document.getElementById('co2Value').textContent = results.co2PerKg.toFixed(2) + ' kg';
            document.getElementById('waterValue').textContent = results.waterScarcityPerKg.toFixed(2) + ' m³';
            document.getElementById('landValue').textContent = results.landUsePerKg.toFixed(0) + ' Pt';
            document.getElementById('fossilValue').textContent = results.fossilPerKg.toFixed(1) + ' MJ';
            document.getElementById('environmentalStory').classList.remove('hidden');
            document.getElementById('storyContent').innerHTML = `<p>${results.comparison.co2Saved.toFixed(2)} kg CO₂e saved vs ${results.comparison.baseline.name}</p>`;
            renderUniversalComparisons(results.co2PerKg, currentComparisonBaseline);
            createEmissionChart(results);
        }
        function createEmissionChart(results) {
            const ctx = document.getElementById('emissionChart').getContext('2d');
            if (currentChart) currentChart.destroy();
            const data = [auditTrailData.pefCategories["Climate Change"].contribution_tree.Ingredients.total, auditTrailData.pefCategories["Climate Change"].contribution_tree.Manufacturing.total, auditTrailData.pefCategories["Climate Change"].contribution_tree.Transport.total, auditTrailData.pefCategories["Climate Change"].contribution_tree.Packaging.total];
            currentChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['Ingredients', 'Processing', 'Transport', 'Packaging'], datasets: [{ data: data, backgroundColor: ['#2E86C1', '#27AE60', '#F39C12', '#E74C3C'] }] } });
        }
        function generateDPP() {
            const dppId = 'TRC-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            document.getElementById('dppId').textContent = dppId;
            QRCode.toCanvas(document.getElementById('qrcode'), JSON.stringify({id: dppId, results: finalPefResults}), { width: 200 }, function(error) {});
        }
        function displayFullPefScorecard() {
            const tbody = document.getElementById('pefScorecardBody');
            tbody.innerHTML = '';
            for (const cat in finalPefResults) {
                tbody.innerHTML += `<tr><td>${cat}</td><td>${finalPefResults[cat].total.toFixed(4)}</td><td>${aioxyData.pefCategories[cat].unit}</td><td>${(finalPefResults[cat].total / massBalanceData.final_content_weight_kg).toFixed(4)}</td><td>Good</td><td>±15%</td></tr>`;
            }
        }
        function generatePDFReport() { alert("Generating PDF Report..."); }

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            populateIngredientSelect();
            populateCountrySelect();
            setupDemoData();
            calculateImpact();
            // Reset scenarios
            resetScenarios();
        });
    </script>
</body>
</html>
