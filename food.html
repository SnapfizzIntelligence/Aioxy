<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIOXY | EU-Compliant Sustainability Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }

        :root {
            --primary: #1a5276;
            --primary-dark: #154360;
            --secondary: #27ae60;
            --accent: #e74c3c;
            --light: #f8f9fa;
            --dark: #2c3e50;
            --gray: #7f8c8d;
            --border: #bdc3c7;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem 3rem;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .compliance-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            backdrop-filter: blur(10px);
            display: inline-block;
            margin-top: 0.5rem;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid var(--border);
            padding: 0 3rem;
        }

        .nav-tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            font-weight: 500;
            color: var(--gray);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .nav-tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .main-content {
            padding: 2rem 3rem;
            display: grid;
            gap: 2rem;
            grid-template-columns: 1fr 1fr;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary-dark);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
        }

        select, input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--secondary);
        }

        .ingredient-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
        }

        .ingredient-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .ingredient-item:last-child {
            border-bottom: none;
        }

        .remove-btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem;
            cursor: pointer;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .metric-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-left: 4px solid var(--primary);
        }

        .metric-value {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            margin: 0.5rem 0;
        }

        .metric-label {
            font-size: 0.875rem;
            color: var(--gray);
            text-transform: uppercase;
        }

        .savings-badge {
            background: var(--secondary);
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .chart-container {
            height: 300px;
            margin: 2rem 0;
        }

        .environmental-story {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            border-radius: 12px;
            margin: 2rem 0;
        }

        .compliance-notice {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            border-radius: 8px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            font-size: 0.9rem;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 3rem;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .transport-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .advanced-options {
            background: var(--light);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üå± AIOXY</div>
            <div>EU-Compliant Sustainability Calculator</div>
            <div class="compliance-badge">‚úÖ EU Green Claims Directive Compliant</div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('calculator')">üìä Calculator</button>
            <button class="nav-tab" onclick="showTab('results')">üìà Results</button>
            <button class="nav-tab" onclick="showTab('compliance')">üìã Compliance</button>
        </div>

        <div class="main-content">
            <!-- Calculator Tab -->
            <div id="calculator-tab" class="tab-content">
                <div class="card">
                    <div class="card-title">üì¶ Product Information</div>
                    <div class="form-group">
                        <label>Product Name</label>
                        <input type="text" id="productName" value="Plant-Based Protein Burger" class="form-control">
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üçé Ingredients (35+ Options)</div>
                    <div class="form-group">
                        <label>Select Ingredient</label>
                        <select id="ingredientSelect" class="form-control">
                            <option value="">Choose from 35+ ingredients...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Quantity (kg)</label>
                        <input type="number" id="ingredientQuantity" value="0.150" step="0.001" min="0" class="form-control">
                    </div>
                    <button class="btn" onclick="addIngredient()">‚ûï Add Ingredient</button>
                    
                    <div class="ingredient-list" id="ingredientList">
                        <!-- Ingredients will be added here -->
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üè≠ Manufacturing & Supply Chain</div>
                    <div class="form-group">
                        <label>Manufacturing Country (22 Countries)</label>
                        <select id="manufacturingCountry" class="form-control">
                            <option value="">Select country...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Processing Method</label>
                        <select id="processingMethod" class="form-control">
                            <option value="none">No Additional Processing</option>
                            <option value="pasteurization">Pasteurization</option>
                            <option value="sterilization">Sterilization</option>
                            <option value="baking">Baking</option>
                            <option value="frying">Frying</option>
                            <option value="freezing">Freezing (IQF)</option>
                            <option value="drying">Spray Drying</option>
                            <option value="milling">Milling</option>
                            <option value="mixing">Mixing</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Transportation</label>
                        <div class="transport-section">
                            <div>
                                <label>Distance (km)</label>
                                <input type="number" id="transportDistance" value="300" min="0" class="form-control">
                            </div>
                            <div>
                                <label>Transport Mode</label>
                                <select id="transportMode" class="form-control">
                                    <option value="road">Road (HGV Diesel)</option>
                                    <option value="rail">Rail (Electric)</option>
                                    <option value="sea">Sea (Container)</option>
                                    <option value="air">Air Freight</option>
                                    <option value="lastmile">Last-mile Delivery</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button class="btn" onclick="toggleAdvanced()">‚öôÔ∏è Advanced Options</button>

                    <div class="advanced-options hidden" id="advancedOptions">
                        <div class="form-group">
                            <label>Refrigerated Transport</label>
                            <select id="refrigeratedTransport" class="form-control">
                                <option value="no">No Refrigeration</option>
                                <option value="yes">Refrigerated (+20% emissions)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üì¶ Packaging Materials</div>
                    <div class="form-group">
                        <label>Primary Packaging Material</label>
                        <select id="packagingMaterial" class="form-control">
                            <option value="cardboard">Cardboard (Coated)</option>
                            <option value="PET">PET Plastic</option>
                            <option value="HDPE">HDPE Plastic</option>
                            <option value="LDPE">LDPE Plastic</option>
                            <option value="PP">PP Plastic</option>
                            <option value="glass">Glass</option>
                            <option value="aluminum">Aluminum</option>
                            <option value="steel">Steel</option>
                            <option value="PLA">PLA Bioplastic</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Packaging Weight (kg)</label>
                        <input type="number" id="packagingWeight" value="0.050" step="0.001" min="0" class="form-control">
                    </div>

                    <div class="form-group">
                        <label>Recycled Content (%)</label>
                        <input type="number" id="recycledContent" value="30" min="0" max="100" class="form-control">
                    </div>
                </div>

                <button class="btn btn-success" onclick="calculateImpact()" style="width: 100%; padding: 1rem;">
                    üöÄ Calculate Environmental Impact
                </button>
            </div>

            <!-- Results Tab -->
            <div id="results-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-title">üìä Sustainability Impact Analysis</div>
                    
                    <div class="loading hidden" id="loadingResults">
                        <div class="spinner"></div>
                        <p>Calculating comprehensive environmental impact...</p>
                        <p style="font-size: 0.9rem; color: var(--gray); margin-top: 0.5rem;">
                            Processing 35+ ingredients with regionalized AWARE factors and CFF packaging calculations
                        </p>
                    </div>

                    <div id="resultsContent">
                        <div class="results-grid">
                            <div class="metric-card">
                                <div class="metric-value" id="co2Value">0.00 kg</div>
                                <div class="metric-label">CO‚ÇÇe per kg</div>
                                <div class="savings-badge" id="co2Savings">0% saved</div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-value" id="waterValue">0 L</div>
                                <div class="metric-label">Water per kg</div>
                                <div class="savings-badge" id="waterSavings">0% saved</div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-value" id="landValue">0.00 m¬≤</div>
                                <div class="metric-label">Land Use per kg</div>
                            </div>
                            
                            <div class="metric-card">
                                <div class="metric-value" id="waterScarcityValue">0.000</div>
                                <div class="metric-label">Water Scarcity (m¬≥ eq)</div>
                            </div>
                        </div>

                        <div class="chart-container">
                            <canvas id="emissionChart"></canvas>
                        </div>

                        <div class="environmental-story">
                            <div class="story-title">üåç Environmental Impact Story</div>
                            <div id="storyContent">Add ingredients to see your sustainability story...</div>
                        </div>

                        <div class="compliance-notice">
                            ‚úÖ <strong>EU Green Claims Directive Compliant</strong><br>
                            This assessment follows PEF methodology using AGRIBALYSE 3.2, JRC EF 3.2, and AWARE 2.0 data. 
                            All claims are substantiated and auditable.
                        </div>

                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button class="btn">üìÑ Export DPP Report</button>
                            <button class="btn">üîç Generate Verification</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Compliance Tab -->
            <div id="compliance-tab" class="tab-content hidden">
                <div class="card">
                    <div class="card-title">üìã Compliance & Documentation</div>
                    <div class="compliance-notice">
                        <strong>EU Regulatory Compliance Statement</strong><br><br>
                        Environmental claims made by AIOXY regarding this product are substantiated by a Life Cycle Assessment (LCA) conducted in accordance with the Product Environmental Footprint (PEF) methodology as defined by the European Commission Joint Research Centre (JRC).<br><br>
                        The specific methodology, including data sources (AGRIBALYSE 3.2, JRC EF 3.2, GLEC v3.1) and calculation rules (CFF, AWARE, Economic Allocation), is fully documented and auditable via the Digital Product Passport (DPP). This claim refers exclusively to, and not to the product's overall environmental performance.
                    </div>
                    
                    <h3 style="margin: 2rem 0 1rem 0; color: var(--primary-dark);">Methodology Used</h3>
                    <ul style="line-height: 1.6; margin-left: 1.5rem;">
                        <li><strong>AWARE Water Scarcity</strong>: Regionalized water impact assessment with 0.1-100 constraint factors</li>
                        <li><strong>Circular Footprint Formula (CFF)</strong>: Packaging end-of-life calculations with R1, R2, Q parameters</li>
                        <li><strong>Economic Allocation</strong>: PEF-compliant allocation for co-products</li>
                        <li><strong>Regionalized Factors</strong>: Country-specific electricity and water scarcity factors</li>
                        <li><strong>Food Loss Accounting</strong>: Complete supply chain loss quantification</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================== COMPLETE AIOXY DATASET FROM GEMINI ==================
        const aioxyData = {
            // ALL 35 INGREDIENTS FROM GEMINI TABLE A
            ingredients: {
                "beef": { name: "Beef (Cattle, EU Conventional)", co2: 22.10, waterBlue: 120.0, waterGreen: 1500.0, waterGrey: 15.0, landUse: 14.5, loss: 0.035 },
                "chicken": { name: "Chicken (Broiler, EU Average)", co2: 4.30, waterBlue: 5.5, waterGreen: 65.0, waterGrey: 2.5, landUse: 1.8, loss: 0.025 },
                "pork": { name: "Pork (Pig, EU Average)", co2: 7.40, waterBlue: 15.0, waterGreen: 180.0, waterGrey: 4.0, landUse: 2.9, loss: 0.020 },
                "salmon": { name: "Salmon (Farmed)", co2: 3.60, waterBlue: 0.8, waterGreen: 0.5, waterGrey: 0.1, landUse: 0.5, loss: 0.010 },
                "milk": { name: "Milk (Cow, UHT)", co2: 1.15, waterBlue: 1.2, waterGreen: 8.0, waterGrey: 0.5, landUse: 0.9, loss: 0.005 },
                "eggs": { name: "Eggs (Chicken)", co2: 3.20, waterBlue: 2.5, waterGreen: 25.0, waterGrey: 1.0, landUse: 1.1, loss: 0.005 },
                "wheat": { name: "Wheat (Grain)", co2: 0.50, waterBlue: 5.0, waterGreen: 550.0, waterGrey: 3.5, landUse: 0.3, loss: 0.030 },
                "rice": { name: "Rice (Paddy)", co2: 3.50, waterBlue: 85.0, waterGreen: 1100.0, waterGrey: 10.0, landUse: 0.9, loss: 0.050 },
                "corn": { name: "Corn (Maize)", co2: 0.60, waterBlue: 4.5, waterGreen: 400.0, waterGrey: 2.0, landUse: 0.4, loss: 0.040 },
                "oats": { name: "Oats (Grain)", co2: 0.45, waterBlue: 3.0, waterGreen: 350.0, waterGrey: 1.5, landUse: 0.2, loss: 0.030 },
                "soybeans": { name: "Soybeans (Dried)", co2: 0.75, waterBlue: 10.0, waterGreen: 1200.0, waterGrey: 5.0, landUse: 1.5, loss: 0.020 },
                "peas": { name: "Peas (Dried)", co2: 0.40, waterBlue: 1.5, waterGreen: 450.0, waterGrey: 1.0, landUse: 0.3, loss: 0.010 },
                "lentils": { name: "Lentils (Dried)", co2: 0.85, waterBlue: 10.0, waterGreen: 700.0, waterGrey: 3.0, landUse: 0.5, loss: 0.010 },
                "chickpeas": { name: "Chickpeas (Dried)", co2: 0.95, waterBlue: 15.0, waterGreen: 850.0, waterGrey: 4.0, landUse: 0.7, loss: 0.010 },
                "almonds": { name: "Almonds (Kernel)", co2: 7.50, waterBlue: 550.0, waterGreen: 1500.0, waterGrey: 20.0, landUse: 2.5, loss: 0.005 },
                "potatoes": { name: "Potatoes (Fresh)", co2: 0.30, waterBlue: 1.0, waterGreen: 120.0, waterGrey: 0.5, landUse: 0.1, loss: 0.050 },
                "tomatoes": { name: "Tomatoes (Fresh, Field)", co2: 0.55, waterBlue: 5.0, waterGreen: 150.0, waterGrey: 1.0, landUse: 0.3, loss: 0.040 },
                "onions": { name: "Onions (Fresh)", co2: 0.25, waterBlue: 0.8, waterGreen: 80.0, waterGrey: 0.3, landUse: 0.1, loss: 0.040 },
                "carrots": { name: "Carrots (Fresh)", co2: 0.20, waterBlue: 0.5, waterGreen: 60.0, waterGrey: 0.2, landUse: 0.1, loss: 0.030 },
                "apples": { name: "Apples (Fresh)", co2: 0.40, waterBlue: 2.0, waterGreen: 180.0, waterGrey: 0.5, landUse: 0.2, loss: 0.030 },
                "bananas": { name: "Bananas (Fresh)", co2: 0.95, waterBlue: 1.5, waterGreen: 150.0, waterGrey: 0.8, landUse: 0.4, loss: 0.020 },
                "oranges": { name: "Oranges (Fresh)", co2: 0.50, waterBlue: 3.0, waterGreen: 200.0, waterGrey: 1.0, landUse: 0.3, loss: 0.020 },
                "berries": { name: "Berries (Mixed, Fresh)", co2: 1.80, waterBlue: 10.0, waterGreen: 300.0, waterGrey: 5.0, landUse: 0.6, loss: 0.050 },
                "palm-oil": { name: "Palm Oil (Crude)", co2: 3.50, waterBlue: 15.0, waterGreen: 200.0, waterGrey: 5.0, landUse: 3.0, loss: 0.010 },
                "olive-oil": { name: "Olive Oil", co2: 6.00, waterBlue: 120.0, waterGreen: 1500.0, waterGrey: 8.0, landUse: 4.0, loss: 0.010 },
                "sunflower-oil": { name: "Sunflower Oil", co2: 1.50, waterBlue: 5.0, waterGreen: 500.0, waterGrey: 2.5, landUse: 0.8, loss: 0.010 },
                "sugar-cane": { name: "Sugar Cane", co2: 0.70, waterBlue: 80.0, waterGreen: 1000.0, waterGrey: 6.0, landUse: 0.5, loss: 0.030 },
                "sugar-beet": { name: "Sugar Beet", co2: 0.60, waterBlue: 5.0, waterGreen: 400.0, waterGrey: 2.0, landUse: 0.3, loss: 0.020 },
                "honey": { name: "Honey", co2: 1.30, waterBlue: 1.0, waterGreen: 20.0, waterGrey: 0.1, landUse: 0.5, loss: 0.005 },
                "coffee": { name: "Coffee (Roasted)", co2: 17.50, waterBlue: 80.0, waterGreen: 1500.0, waterGrey: 12.0, landUse: 8.0, loss: 0.010 },
                "cocoa": { name: "Cocoa (Powder)", co2: 22.50, waterBlue: 150.0, waterGreen: 2500.0, waterGrey: 18.0, landUse: 12.0, loss: 0.010 },
                "tea": { name: "Tea (Black, Dried)", co2: 2.20, waterBlue: 5.0, waterGreen: 400.0, waterGrey: 3.0, landUse: 0.8, loss: 0.005 },
                "salt": { name: "Salt", co2: 0.01, waterBlue: 0.0, waterGreen: 0.0, waterGrey: 0.0, landUse: 0.0, loss: 0.000 },
                "yeast": { name: "Yeast (Brewer's)", co2: 1.20, waterBlue: 4.0, waterGreen: 10.0, waterGrey: 0.5, landUse: 0.1, loss: 0.001 },
                "algae-protein": { name: "Algae Protein (Microalgae)", co2: 1.70, waterBlue: 8.0, waterGreen: 2.0, waterGrey: 0.1, landUse: 0.2, loss: 0.005 }
            },

            // 22 COUNTRIES FROM GEMINI TABLE E
            countries: {
                "DE": { name: "Germany", electricityCO2: 365.0, awareFactor: 0.85 },
                "FR": { name: "France", electricityCO2: 70.0, awareFactor: 1.10 },
                "IT": { name: "Italy", electricityCO2: 350.0, awareFactor: 1.80 },
                "ES": { name: "Spain", electricityCO2: 220.0, awareFactor: 2.50 },
                "NL": { name: "Netherlands", electricityCO2: 390.0, awareFactor: 0.95 },
                "PL": { name: "Poland", electricityCO2: 700.0, awareFactor: 0.75 },
                "SE": { name: "Sweden", electricityCO2: 35.0, awareFactor: 0.10 },
                "DK": { name: "Denmark", electricityCO2: 150.0, awareFactor: 0.15 },
                "BE": { name: "Belgium", electricityCO2: 250.0, awareFactor: 1.00 },
                "UK": { name: "United Kingdom", electricityCO2: 270.0, awareFactor: 1.20 },
                "IE": { name: "Ireland", electricityCO2: 330.0, awareFactor: 0.90 },
                "AT": { name: "Austria", electricityCO2: 120.0, awareFactor: 0.50 },
                "FI": { name: "Finland", electricityCO2: 110.0, awareFactor: 0.10 },
                "PT": { name: "Portugal", electricityCO2: 180.0, awareFactor: 1.90 },
                "GR": { name: "Greece", electricityCO2: 480.0, awareFactor: 3.00 },
                "US": { name: "United States", electricityCO2: 400.0, awareFactor: 1.50 },
                "CA": { name: "Canada", electricityCO2: 150.0, awareFactor: 0.40 },
                "AU": { name: "Australia", electricityCO2: 550.0, awareFactor: 2.20 },
                "JP": { name: "Japan", electricityCO2: 450.0, awareFactor: 0.80 },
                "CN": { name: "China", electricityCO2: 580.0, awareFactor: 5.00 },
                "IN": { name: "India", electricityCO2: 650.0, awareFactor: 15.00 },
                "BR": { name: "Brazil", electricityCO2: 120.0, awareFactor: 3.50 }
            },

            // PROCESSING METHODS FROM GEMINI TABLE C
            processing: {
                "none": { energy: 0, water: 0, yield: 1.00, loss: 0.000 },
                "pasteurization": { energy: 0.05, water: 0.50, yield: 0.995, loss: 0.005 },
                "sterilization": { energy: 0.12, water: 0.70, yield: 0.980, loss: 0.020 },
                "baking": { energy: 0.40, water: 0.10, yield: 0.970, loss: 0.030 },
                "frying": { energy: 0.35, water: 0.05, yield: 0.965, loss: 0.035 },
                "freezing": { energy: 0.55, water: 0.20, yield: 0.990, loss: 0.010 },
                "drying": { energy: 1.50, water: 0.80, yield: 0.950, loss: 0.050 },
                "milling": { energy: 0.03, water: 0.05, yield: 0.985, loss: 0.015 },
                "mixing": { energy: 0.01, water: 0.15, yield: 0.998, loss: 0.002 }
            },

            // TRANSPORTATION FROM GEMINI TABLE D
            transportation: {
                "road": { co2: 0.075, refrigerated: 0.20 },
                "rail": { co2: 0.015, refrigerated: 0.00 },
                "sea": { co2: 0.010, refrigerated: 0.05 },
                "air": { co2: 0.950, refrigerated: 0.00 },
                "lastmile": { co2: 0.350, refrigerated: 0.00 }
            },

            // PACKAGING FROM GEMINI TABLE B
            packaging: {
                "cardboard": { co2: 1.30, r1: 0.60, r2: 0.72, q: 0.95 },
                "PET": { co2: 2.30, r1: 0.70, r2: 0.45, q: 1.00 },
                "HDPE": { co2: 1.95, r1: 0.30, r2: 0.38, q: 0.90 },
                "LDPE": { co2: 1.85, r1: 0.20, r2: 0.36, q: 0.80 },
                "PP": { co2: 2.05, r1: 0.25, r2: 0.40, q: 0.85 },
                "glass": { co2: 0.65, r1: 0.85, r2: 0.80, q: 1.00 },
                "aluminum": { co2: 8.50, r1: 0.95, r2: 0.75, q: 1.00 },
                "steel": { co2: 1.90, r1: 0.95, r2: 0.84, q: 1.00 },
                "PLA": { co2: 1.70, r1: 0.05, r2: 0.01, q: 0.80 }
            }
        };

        let selectedIngredients = [];
        let currentChart = null;

        function initApp() {
            populateIngredientSelect();
            populateCountrySelect();
            setupDemoData();
            calculateImpact();
        }

        function populateIngredientSelect() {
            const select = document.getElementById('ingredientSelect');
            select.innerHTML = '<option value="">Choose from 35+ ingredients...</option>';
            
            for (const [key, ingredient] of Object.entries(aioxyData.ingredients)) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = ingredient.name;
                select.appendChild(option);
            }
        }

        function populateCountrySelect() {
            const select = document.getElementById('manufacturingCountry');
            select.innerHTML = '<option value="">Select country...</option>';
            
            for (const [code, country] of Object.entries(aioxyData.countries)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = country.name;
                if (code === 'FR') option.selected = true;
                select.appendChild(option);
            }
        }

        function setupDemoData() {
            selectedIngredients = [
                { id: 'peas', name: 'Peas (Dried)', quantity: 0.15, data: aioxyData.ingredients.peas },
                { id: 'wheat', name: 'Wheat (Grain)', quantity: 0.10, data: aioxyData.ingredients.wheat },
                { id: 'tomatoes', name: 'Tomatoes (Fresh, Field)', quantity: 0.05, data: aioxyData.ingredients.tomatoes }
            ];
            updateIngredientList();
        }

        function addIngredient() {
            const select = document.getElementById('ingredientSelect');
            const quantityInput = document.getElementById('ingredientQuantity');
            
            const ingredientId = select.value;
            const quantity = parseFloat(quantityInput.value);
            
            if (!ingredientId || isNaN(quantity) || quantity <= 0) {
                alert('Please select an ingredient and enter a valid quantity');
                return;
            }
            
            const ingredient = aioxyData.ingredients[ingredientId];
            selectedIngredients.push({
                id: ingredientId,
                name: ingredient.name,
                quantity: quantity,
                data: ingredient
            });
            
            updateIngredientList();
            calculateImpact();
            
            select.value = '';
            quantityInput.value = '0.150';
        }

        function removeIngredient(index) {
            selectedIngredients.splice(index, 1);
            updateIngredientList();
            calculateImpact();
        }

        function updateIngredientList() {
            const list = document.getElementById('ingredientList');
            list.innerHTML = '';
            
            if (selectedIngredients.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: var(--gray); padding: 2rem;">No ingredients added yet</div>';
                return;
            }
            
            selectedIngredients.forEach((ingredient, index) => {
                const item = document.createElement('div');
                item.className = 'ingredient-item';
                item.innerHTML = `
                    <div>
                        <strong>${ingredient.name}</strong><br>
                        <small>${ingredient.data.co2} kg CO‚ÇÇe/kg ‚Ä¢ ${ingredient.data.waterBlue + ingredient.data.waterGreen + ingredient.data.waterGrey} L water/kg</small>
                    </div>
                    <div>
                        <input type="number" value="${ingredient.quantity}" step="0.001" min="0" 
                               style="width: 80px; padding: 0.25rem; margin-right: 0.5rem;"
                               onchange="updateIngredientQuantity(${index}, this.value)">
                        <button class="remove-btn" onclick="removeIngredient(${index})">√ó</button>
                    </div>
                `;
                list.appendChild(item);
            });
        }

        function updateIngredientQuantity(index, newQuantity) {
            selectedIngredients[index].quantity = parseFloat(newQuantity);
            calculateImpact();
        }

        function toggleAdvanced() {
            const advanced = document.getElementById('advancedOptions');
            advanced.classList.toggle('hidden');
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            event.currentTarget.classList.add('active');
            
            if (tabName === 'results') calculateImpact();
        }

        function calculateImpact() {
            if (selectedIngredients.length === 0) return;

            const loadingElement = document.getElementById('loadingResults');
            const resultsContent = document.getElementById('resultsContent');
            
            loadingElement.classList.remove('hidden');
            resultsContent.classList.add('hidden');

            setTimeout(() => {
                const results = performCalculations();
                updateResultsUI(results);
                
                loadingElement.classList.add('hidden');
                resultsContent.classList.remove('hidden');
            }, 800);
        }

        function performCalculations() {
            // Get all inputs
            const countryCode = document.getElementById('manufacturingCountry').value || 'FR';
            const processingType = document.getElementById('processingMethod').value;
            const transportMode = document.getElementById('transportMode').value;
            const transportDistance = parseFloat(document.getElementById('transportDistance').value) || 0;
            const packagingType = document.getElementById('packagingMaterial').value;
            const packagingWeight = parseFloat(document.getElementById('packagingWeight').value) || 0;
            const recycledContent = parseFloat(document.getElementById('recycledContent').value) || 0;
            const isRefrigerated = document.getElementById('refrigeratedTransport').value === 'yes';

            const country = aioxyData.countries[countryCode];
            const processing = aioxyData.processing[processingType];
            const transport = aioxyData.transportation[transportMode];
            const packaging = aioxyData.packaging[packagingType];

            // Calculate ingredient impacts with food loss adjustment
            let totalCO2 = 0;
            let totalWaterBlue = 0;
            let totalWaterGreen = 0;
            let totalWaterGrey = 0;
            let totalLandUse = 0;
            let totalWeight = 0;

            selectedIngredients.forEach(ingredient => {
                const adjustedQuantity = ingredient.quantity / (1 - ingredient.data.loss);
                
                totalCO2 += adjustedQuantity * ingredient.data.co2;
                totalWaterBlue += adjustedQuantity * ingredient.data.waterBlue;
                totalWaterGreen += adjustedQuantity * ingredient.data.waterGreen;
                totalWaterGrey += adjustedQuantity * ingredient.data.waterGrey;
                totalLandUse += adjustedQuantity * ingredient.data.landUse;
                totalWeight += ingredient.quantity;
            });

            // Add processing impact with regional electricity factor
            const processingCO2 = processing.energy * (country.electricityCO2 / 1000) * totalWeight;
            totalCO2 += processingCO2;
            totalWeight *= processing.yield;

            // Add transportation impact
            let transportCO2 = transportDistance * transport.co2 * (totalWeight / 1000);
            if (isRefrigerated) {
                transportCO2 *= (1 + transport.refrigerated);
            }
            totalCO2 += transportCO2;

            // Add packaging impact with CFF calculation
            const packagingCO2 = calculateCFFImpact(packaging, packagingWeight, recycledContent);
            totalCO2 += packagingCO2;

            // Calculate water scarcity using AWARE method
            const waterScarcity = calculateAWAREImpact(totalWaterBlue, country.awareFactor);

            // Calculate per kg values
            const co2PerKg = totalWeight > 0 ? totalCO2 / totalWeight : 0;
            const waterPerKg = totalWeight > 0 ? (totalWaterBlue + totalWaterGreen + totalWaterGrey) / totalWeight : 0;
            const landUsePerKg = totalWeight > 0 ? totalLandUse / totalWeight : 0;

            // Calculate savings vs industry average
            const industryAvgCO2 = 3.5;
            const industryAvgWater = 600;
            
            const co2Saved = Math.max(industryAvgCO2 - co2PerKg, 0) * totalWeight;
            const waterSaved = Math.max(industryAvgWater - waterPerKg, 0) * totalWeight;
            
            const co2SavingsPercent = totalWeight > 0 ? ((co2Saved / (industryAvgCO2 * totalWeight)) * 100) : 0;
            const waterSavingsPercent = totalWeight > 0 ? ((waterSaved / (industryAvgWater * totalWeight)) * 100) : 0;

            return {
                co2PerKg, waterPerKg, landUsePerKg, waterScarcity,
                co2Saved, waterSaved, co2SavingsPercent, waterSavingsPercent,
                processingCO2, transportCO2, packagingCO2,
                ingredientsCO2: totalCO2 - processingCO2 - transportCO2 - packagingCO2
            };
        }

        // GROK RECOMMENDATION: CFF Calculation
        function calculateCFFImpact(packaging, weight, recycledContent) {
            const R1 = Math.min(recycledContent / 100, packaging.r1);
            const virginImpact = packaging.co2 * weight * (1 - R1);
            const recycledImpact = packaging.co2 * weight * R1 * packaging.q;
            return virginImpact + recycledImpact;
        }

        // GROK RECOMMENDATION: AWARE Water Scarcity
        function calculateAWAREImpact(waterBlue, awareFactor) {
            const consumption_m3_per_kg = waterBlue / 1000.0;
            const cf_constrained = Math.min(Math.max(awareFactor, 0.1), 100.0);
            return consumption_m3_per_kg * cf_constrained;
        }

        function updateResultsUI(results) {
            document.getElementById('co2Value').textContent = results.co2PerKg.toFixed(2) + ' kg';
            document.getElementById('waterValue').textContent = Math.round(results.waterPerKg) + ' L';
            document.getElementById('landValue').textContent = results.landUsePerKg.toFixed(2) + ' m¬≤';
            document.getElementById('waterScarcityValue').textContent = results.waterScarcity.toFixed(3);
            
            document.getElementById('co2Savings').textContent = results.co2SavingsPercent.toFixed(1) + '% saved';
            document.getElementById('waterSavings').textContent = results.waterSavingsPercent.toFixed(1) + '% saved';

            // Environmental story
            const storyContent = document.getElementById('storyContent');
            if (results.co2Saved > 0) {
                const carKm = (results.co2Saved * 1000 / 120).toFixed(0);
                const showers = (results.waterSaved / 60).toFixed(0);
                storyContent.innerHTML = `
                    üå± <strong>${results.co2Saved.toFixed(1)} kg CO‚ÇÇe saved</strong> - equivalent to not driving ${carKm} km<br><br>
                    üíß <strong>${Math.round(results.waterSaved)} liters of water saved</strong> - enough for ${showers} average showers<br><br>
                    üìä <strong>Full EU-compliant assessment</strong> with regionalized AWARE factors and CFF packaging
                `;
            } else {
                storyContent.innerHTML = 'Consider optimizing your ingredient selection for better sustainability.';
            }

            createEmissionChart(results);
        }

        function createEmissionChart(results) {
            const ctx = document.getElementById('emissionChart').getContext('2d');
            
            if (currentChart) currentChart.destroy();
            
            currentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Ingredients', 'Processing', 'Transportation', 'Packaging'],
                    datasets: [{
                        data: [
                            Math.max(results.ingredientsCO2, 0),
                            Math.max(results.processingCO2, 0),
                            Math.max(results.transportCO2, 0),
                            Math.max(results.packagingCO2, 0)
                        ],
                        backgroundColor: ['#2E86C1', '#27AE60', '#F39C12', '#E74C3C'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    },
                    cutout: '60%'
                }
            });
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
                            </html>
