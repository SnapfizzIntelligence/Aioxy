<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIOXY Fashion Footprint Calculator v2.0 - Enhanced</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs@gh-pages/qrcode.min.js"></script>
    <style>
        :root { 
            --aioxy-primary: #2e8b57;
            --aioxy-secondary: #3a7d54; 
            --aioxy-dark: #1a3e2d;
            --twitter-blue: #1DA1F2;
            --background-light: #f8f9fa;
            --water-blue: #1e88e5;
            --impact-orange: #ff6b35;
            --luxury-gold: #d4af37;
            --innovation-purple: #8a2be2;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
            line-height: 1.6;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
        }
        
        .header {
            text-align: center;
            padding: 2rem 1rem;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, var(--aioxy-dark) 0%, var(--aioxy-primary) 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }
        
        @media (min-width: 900px) {
            .container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .card h2 {
            color: var(--aioxy-dark);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--aioxy-primary);
            font-size: 1.5rem;
        }
        
        .input-section { 
            background: var(--background-light); 
            padding: 1.5rem; 
            border-radius: 12px; 
            margin-bottom: 1.5rem; 
        }
        
        button { 
            background: var(--aioxy-primary); 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 8px 0; 
            transition: all 0.2s ease;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        button:hover {
            background: var(--aioxy-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        input, select { 
            padding: 12px; 
            margin: 8px 0; 
            width: 100%; 
            box-sizing: border-box; 
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--aioxy-primary);
            box-shadow: 0 0 0 3px rgba(46, 139, 87, 0.1);
        }
        
        .input-row { 
            display: flex; 
            gap: 12px; 
            margin-bottom: 12px; 
            align-items: center; 
        }
        
        .input-row > * { flex: 1; }
        
        .input-row > button { 
            flex: 0 0 40px; 
            background: #dc3545;
            color: white;
            padding: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #results { 
            margin-top: 2rem; 
            padding: 2rem; 
            background: white; 
            border-radius: 12px; 
            display: none; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .calculate-btn { 
            background: var(--aioxy-dark); 
            color: white;
            font-weight: bold; 
            width: 100%;
            padding: 16px;
            font-size: 1.1rem;
            margin-top: 1rem;
        }
        
        #qrcode-container {
            margin: 2rem auto;
            text-align: center;
            padding: 1.5rem;
            background: var(--background-light);
            border-radius: 12px;
            border: 1px solid #eee;
        }
        
        #qrcode {
            margin: 0 auto;
        }
        
        #qrcode img {
            padding: 12px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .export-buttons { 
            display: flex; 
            gap: 12px; 
            margin-top: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .savings {
            color: var(--aioxy-primary);
            font-weight: bold;
            background: #e8f5ee;
            padding: 12px 16px;
            border-radius: 8px;
            display: inline-block;
            margin: 8px 0;
            font-size: 1.1rem;
            border-left: 4px solid var(--aioxy-primary);
        }
        
        .water-savings {
            color: var(--water-blue);
            font-weight: bold;
            background: #e3f2fd;
            padding: 12px 16px;
            border-radius: 8px;
            display: inline-block;
            margin: 8px 0;
            font-size: 1.1rem;
            border-left: 4px solid var(--water-blue);
        }
        
        .innovation-savings {
            color: var(--innovation-purple);
            font-weight: bold;
            background: #f3e8fd;
            padding: 12px 16px;
            border-radius: 8px;
            display: inline-block;
            margin: 8px 0;
            font-size: 1.1rem;
            border-left: 4px solid var(--innovation-purple);
        }
        
        .impact-story {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            text-align: center;
        }
        
        .impact-value {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0.5rem 0;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        .impact-label {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        #downloadQR {
            display: inline-block;
            background: var(--aioxy-dark);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin-top: 1rem;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        #downloadQR:hover {
            background: var(--aioxy-primary);
            transform: translateY(-2px);
        }
        
        .error-message {
            color: #dc3545;
            font-weight: bold;
            margin: 12px 0;
            padding: 12px;
            background: #ffeaea;
            border-radius: 8px;
            border-left: 4px solid #dc3545;
        }
        
        #chart-container {
            margin: 2rem auto;
            max-width: 400px;
            height: 300px;
        }
        
        .material-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--aioxy-primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .luxury-badge {
            background: linear-gradient(135deg, var(--luxury-gold) 0%, #bf953f 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .innovation-badge {
            background: linear-gradient(135deg, var(--innovation-purple) 0%, #6a0dad 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .data-source {
            font-size: 0.9rem;
            color: #666;
            margin-top: 1rem;
            text-align: center;
            font-style: italic;
        }
        
        .story-section {
            background: #fff9e6;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            border-left: 4px solid var(--impact-orange);
        }
        
        .story-heading {
            color: var(--impact-orange);
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .certification-badges {
            display: flex;
            gap: 0.8rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .cert-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .cert-badge.organic { background: #27ae60; color: white; }
        .cert-badge.recycled { background: #3498db; color: white; }
        .cert-badge.vegan { background: #2ecc71; color: white; }
        .cert-badge.innovation { background: var(--innovation-purple); color: white; }
        
        .material-comparison {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
        }
        
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .comparison-item {
            background: rgba(255,255,255,0.2);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }
        
        @media (max-width: 768px) {
            .input-row {
                flex-direction: column;
            }
            
            .input-row > * {
                width: 100%;
            }
            
            #qrcode { 
                width: 180px; 
                height: 180px; 
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .export-buttons {
                flex-direction: column;
            }
            
            #chart-container {
                max-width: 300px;
            }
            
            .comparison-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .footprint-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .comparison-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .comparison-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }
        
        .your-value {
            color: var(--aioxy-primary);
        }
        
        .avg-value {
            color: #666;
        }
        
        .master-badge {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🌿 AIOXY Fashion Footprint Calculator <span class="master-badge">v2.0 ENHANCED</span></h1>
        <p>Master Dataset Integrated • 20+ Sustainable Materials • Enhanced Storytelling</p>
    </div>

    <div class="container">
        <div class="card">
            <h2>Product Details</h2>
            
            <div class="input-section">
                <input type="text" id="product-name" placeholder="Product Name (e.g., Neverfull MM Bag)" value="Innovative Mycelium Handbag">
                <select id="product-country">
                    <option value="global">Global Average</option>
                    <option value="Germany">Germany</option>
                    <option value="France" selected>France</option>
                    <option value="UK">UK</option>
                    <option value="US">US</option>
                    <option value="China">China</option>
                    <option value="Japan">Japan</option>
                </select>

                <h3>Materials <span class="master-badge">20+ OPTIONS</span></h3>
                <div id="materials-container"></div>
                <button onclick="addMaterial()">+ Add Material</button>

                <h3>Manufacturing Energy</h3>
                <div class="input-row">
                    <input type="number" id="energy-amount" placeholder="kWh" step="0.1" value="2.5">
                    <select id="energy-type">
                        <option value="grid">Grid Electricity</option>
                        <option value="solar">Solar</option>
                        <option value="wind">Wind</option>
                        <option value="hydro">Hydro</option>
                        <option value="biomass">Biomass</option>
                        <option value="geothermal">Geothermal</option>
                    </select>
                </div>

                <h3>CO₂ Benchmark</h3>
                <div class="input-row">
                    <input type="number" id="benchmark" placeholder="Benchmark CO₂e (kg)" step="0.01" value="6.00">
                    <span>vs. market average</span>
                </div>

                <h3>Transport <span class="master-badge">NEW MODES</span></h3>
                <div id="transport-container"></div>
                <button onclick="addTransport()">+ Add Transport Route</button>
            </div>
            
            <button onclick="calculatePCF()" class="calculate-btn">Generate Sustainability Passport</button>
        </div>

        <div class="card">
            <h2>Impact Story Builder</h2>
            <div class="story-section">
                <div class="story-heading">
                    <span>📖</span>
                    <h3>Why Storytelling Matters</h3>
                </div>
                <p>Consumers don't buy carbon data—they buy stories. They buy trust. They buy positive impact.</p>
                <p>With new EU Green Claims Directive, verified storytelling isn't optional—it's your competitive advantage.</p>
            </div>
            
            <div class="story-section">
                <div class="story-heading">
                    <span>💡</span>
                    <h3>How It Works</h3>
                </div>
                <p>1. Enter your product materials and manufacturing details</p>
                <p>2. We calculate verified CO₂ and water footprints using regulatory databases</p>
                <p>3. Generate a compelling sustainability story with QR code verification</p>
                <p>4. Share your verified impact with customers and regulators</p>
            </div>
            
            <div class="story-section">
                <div class="story-heading">
                    <span>🚀</span>
                    <h3>Business Impact</h3>
                </div>
                <p>• <strong>28% higher conversion</strong> for products with verified claims (McKinsey 2023)</p>
                <p>• <strong>10-30% price premium</strong> for verified sustainable products</p>
                <p>• <strong>Zero greenwashing risk</strong> with regulator-ready data</p>
                <p>• <strong>QR-powered transparency</strong> that builds lasting consumer trust</p>
            </div>
        </div>
    </div>

    <div id="results">
        <h2>🌱 Your Sustainability Passport</h2>
        <div id="result-summary"></div>
        
        <div class="impact-story">
            <div class="impact-value" id="impactCo2">0.00 kg CO₂e</div>
            <div class="impact-label">Carbon Emissions Saved vs Industry Average</div>
            <p id="impactAnalogy">Your positive impact story will appear here</p>
        </div>
        
        <div class="footprint-comparison">
            <div class="comparison-card">
                <h4>Your Product</h4>
                <div class="comparison-value your-value" id="your-co2">0.00 kg</div>
                <div>CO₂ Footprint</div>
            </div>
            <div class="comparison-card">
                <h4>Industry Average</h4>
                <div class="comparison-value avg-value" id="avg-co2">0.00 kg</div>
                <div>CO₂ Footprint</div>
            </div>
        </div>
        
        <div id="chart-container">
            <canvas id="chart"></canvas>
        </div>
        
        <div id="qrcode-container">
            <h3>📱 Digital Product Passport</h3>
            <p>Scan to verify sustainability claims</p>
            <div id="qrcode"></div>
            <a id="downloadQR" download="aioxy-sustainability-passport.png" style="display:none;">Download QR Code</a>
            <div id="qr-error" class="error-message" style="display:none;"></div>
        </div>
        
        <div class="export-buttons">
            <button onclick="saveAsPDF()">📄 Save as PDF Report</button>
            <button onclick="copyResults()">📋 Copy Sustainability Story</button>
            <button id="share">🐦 Share on X</button>
        </div>
    </div>

    <script>
        // ================== ENHANCED EMISSION FACTORS DATASET ==================
        const PCFFactors = {
          materials: {
            'plastic-virgin': { 
              co2: { 'Germany': 2.8, 'UK': 2.75, 'France': 2.6, 'Japan': 2.9, 'US': 3.0, 'China': 3.2, 'global': 2.7 },
              water: 234,
              story: "Virgin plastic from fossil fuels",
              certifications: []
            },
            'plastic-recycled': { 
              co2: { 'Germany': 0.6, 'UK': 0.55, 'France': 0.5, 'Japan': 0.65, 'US': 0.7, 'China': 0.8, 'global': 0.5 },
              water: 56,
              story: "Recycled plastic diverting waste from oceans",
              certifications: ['recycled']
            },
            'rubber': { 
              co2: { 'Germany': 1.9, 'UK': 1.85, 'France': 1.8, 'Japan': 2.0, 'US': 2.1, 'China': 2.2, 'global': 1.8 },
              water: 2000,
              story: "Natural rubber from sustainable sources",
              certifications: []
            },
            'leather': { 
              co2: { 'Germany': 10.5, 'UK': 10.2, 'France': 9.8, 'Japan': 10.7, 'US': 11.0, 'China': 11.5, 'global': 10.0 },
              water: 17093,
              story: "Traditional leather with high water footprint",
              certifications: []
            },
            'steel': { 
              co2: { 'Germany': 2.0, 'UK': 2.05, 'France': 1.9, 'Japan': 2.2, 'US': 2.3, 'China': 2.5, 'global': 2.1 },
              water: 100,
              story: "Recycled steel components",
              certifications: ['recycled']
            },
            'aluminum': { 
              co2: { 'Germany': 10.5, 'UK': 10.8, 'France': 10.0, 'Japan': 11.2, 'US': 11.5, 'China': 12.0, 'global': 11.0 },
              water: 15,
              story: "Recycled aluminum hardware",
              certifications: ['recycled']
            },
            'glass': { 
              co2: { 'Germany': 1.2, 'UK': 1.25, 'France': 1.1, 'Japan': 1.4, 'US': 1.5, 'China': 1.6, 'global': 1.3 },
              water: 28,
              story: "Recycled glass elements",
              certifications: ['recycled']
            },
            'cardboard': { 
              co2: { 'Germany': 0.9, 'UK': 0.95, 'France': 0.85, 'Japan': 1.0, 'US': 1.1, 'China': 1.2, 'global': 0.94 },
              water: 2000,
              story: "FSC-certified cardboard packaging",
              certifications: ['organic', 'recycled']
            },
            'nylon-recycled': { 
              co2: { 'Germany': 0.6, 'UK': 0.55, 'France': 0.5, 'Japan': 0.65, 'US': 0.7, 'China': 0.8, 'global': 0.6 },
              water: 71,
              story: "Recycled nylon from ocean waste",
              certifications: ['recycled']
            },
            'cotton': { 
              co2: { 'Germany': 3.5, 'UK': 3.4, 'France': 3.3, 'Japan': 3.6, 'US': 3.7, 'China': 4.0, 'global': 3.6 },
              water: 8920,
              story: "Organic cotton saving water",
              certifications: ['organic']
            },
            'polyester': { 
              co2: { 'Germany': 4.2, 'UK': 4.1, 'France': 4.0, 'Japan': 4.3, 'US': 4.5, 'China': 4.8, 'global': 4.3 },
              water: 71,
              story: "Recycled polyester from bottles",
              certifications: ['recycled']
            },
            'vegan-leather': { 
              co2: { 'Germany': 3.2, 'UK': 3.1, 'France': 3.0, 'Japan': 3.3, 'US': 3.4, 'China': 3.6, 'global': 3.2 },
              water: 250,
              story: "Innovative plant-based leather alternative",
              certifications: ['vegan']
            },
            'wool-virgin': { 
              co2: { 'Germany': 30.0, 'UK': 30.0, 'France': 28.0, 'Japan': 35.0, 'US': 40.0, 'China': 45.0, 'global': 30.0 },
              water: 8000,
              story: "Virgin wool from responsibly reared sheep",
              certifications: ['organic']
            },
            'wool-recycled': { 
              co2: { 'Germany': 2.0, 'UK': 2.5, 'France': 2.0, 'Japan': 3.0, 'US': 4.0, 'China': 5.0, 'global': 3.0 },
              water: 2000,
              story: "Recycled wool blend saving water and climate impact",
              certifications: ['recycled']
            },
            // 🌱 NEW SUSTAINABLE MATERIALS
            'hemp': {
              co2: { 'Germany': 1.5, 'UK': 1.4, 'France': 1.3, 'Japan': 1.6, 'US': 1.7, 'China': 1.8, 'global': 1.5 },
              water: 300,
              story: "Hemp: low-input fiber with regenerative potential",
              certifications: ['organic', 'vegan']
            },
            'linen': {
              co2: { 'Germany': 1.6, 'UK': 1.5, 'France': 1.4, 'Japan': 1.7, 'US': 1.8, 'China': 1.9, 'global': 1.6 },
              water: 650,
              story: "Linen: ancient, durable, and water-efficient",
              certifications: ['organic', 'vegan']
            },
            'tencel': {
              co2: { 'Germany': 2.0, 'UK': 1.9, 'France': 1.8, 'Japan': 2.1, 'US': 2.2, 'China': 2.3, 'global': 2.0 },
              water: 500,
              story: "Tencel (Lyocell): closed-loop cellulose fiber",
              certifications: ['organic', 'vegan', 'innovation']
            },
            'mycelium-leather': {
              co2: { 'Germany': 1.2, 'UK': 1.1, 'France': 1.0, 'Japan': 1.3, 'US': 1.4, 'China': 1.5, 'global': 1.2 },
              water: 100,
              story: "Futuristic leather grown from fungi mycelium",
              certifications: ['vegan', 'innovation']
            },
            'pinatex': {
              co2: { 'Germany': 2.5, 'UK': 2.4, 'France': 2.3, 'Japan': 2.6, 'US': 2.7, 'China': 2.9, 'global': 2.5 },
              water: 400,
              story: "Piñatex: pineapple leaf waste turned into leather",
              certifications: ['vegan', 'innovation']
            },
            'cork': {
              co2: { 'Germany': 0.9, 'UK': 0.8, 'France': 0.7, 'Japan': 1.0, 'US': 1.1, 'China': 1.2, 'global': 0.9 },
              water: 50,
              story: "Cork: bark harvested without cutting trees",
              certifications: ['organic', 'vegan']
            },
            'bioplastic': {
              co2: { 'Germany': 1.8, 'UK': 1.7, 'France': 1.6, 'Japan': 2.0, 'US': 2.1, 'China': 2.3, 'global': 1.9 },
              water: 120,
              story: "Bio-based plastic: made from renewable crops",
              certifications: ['vegan', 'innovation']
            }
          },
          energy: {
            'grid': { 'Germany': 0.362, 'UK': 0.189, 'France': 0.051, 'Japan': 0.395, 'US': 0.352, 'China': 0.573, 'global': 0.475 },
            'solar': { 'Germany': 0.04, 'UK': 0.045, 'France': 0.035, 'Japan': 0.05, 'US': 0.05, 'China': 0.06, 'global': 0.045 },
            'wind': { 'Germany': 0.012, 'UK': 0.015, 'France': 0.01, 'Japan': 0.018, 'US': 0.015, 'China': 0.02, 'global': 0.015 },
            'hydro': { 'Germany': 0.01, 'UK': 0.012, 'France': 0.008, 'Japan': 0.015, 'US': 0.013, 'China': 0.018, 'global': 0.012 },
            'biomass': { 'Germany': 0.05, 'UK': 0.06, 'France': 0.045, 'Japan': 0.07, 'US': 0.08, 'China': 0.09, 'global': 0.06 },
            'geothermal': { 'Germany': 0.015, 'UK': 0.018, 'France': 0.012, 'Japan': 0.02, 'US': 0.025, 'China': 0.03, 'global': 0.02 }
          },
          transport: {
            'road': { 'Germany': 0.115, 'UK': 0.120, 'France': 0.110, 'Japan': 0.125, 'US': 0.130, 'China': 0.140, 'global': 0.120 },
            'air': { 'Germany': 0.560, 'UK': 0.570, 'France': 0.550, 'Japan': 0.580, 'US': 0.590, 'China': 0.600, 'global': 0.570 },
            'sea': { 'Germany': 0.014, 'UK': 0.015, 'France': 0.013, 'Japan': 0.016, 'US': 0.015, 'China': 0.017, 'global': 0.015 },
            'rail': { 'Germany': 0.028, 'UK': 0.030, 'France': 0.025, 'Japan': 0.032, 'US': 0.035, 'China': 0.040, 'global': 0.030 },
            'electric-vehicle': { 'Germany': 0.03, 'UK': 0.035, 'France': 0.025, 'Japan': 0.04, 'US': 0.045, 'China': 0.06, 'global': 0.04 },
            'inland-waterway': { 'Germany': 0.01, 'UK': 0.012, 'France': 0.009, 'Japan': 0.015, 'US': 0.011, 'China': 0.013, 'global': 0.011 },
            'last-mile-van': { 'Germany': 0.18, 'UK': 0.19, 'France': 0.17, 'Japan': 0.20, 'US': 0.22, 'China': 0.25, 'global': 0.20 },
            'cargo-bike': { 'Germany': 0.005, 'UK': 0.006, 'France': 0.004, 'Japan': 0.007, 'US': 0.008, 'China': 0.009, 'global': 0.006 },
            'pipeline': { 'Germany': 0.02, 'UK': 0.021, 'France': 0.019, 'Japan': 0.022, 'US': 0.023, 'China': 0.025, 'global': 0.021 }
          }
        };

        // Enhanced impact analogies
        const co2Analogies = [
            { threshold: 0.5, text: "That's like charging your smartphone for 6 months!" },
            { threshold: 1.0, text: "That's equivalent to driving 4 fewer miles in a car!" },
            { threshold: 2.0, text: "That's like charging your smartphone for 2.5 years!" },
            { threshold: 5.0, text: "That's equivalent to planting 1 tree and letting it grow for 10 years!" },
            { threshold: 10.0, text: "That's like not driving your car for 40 miles!" },
            { threshold: 20.0, text: "That's equivalent to the carbon absorbed by 2 trees in a year!" },
            { threshold: 50.0, text: "That's like saving enough energy to power a home for 2 days!" },
            { threshold: 100.0, text: "That's like skipping a round-trip flight from London to Paris!" },
            { threshold: 500.0, text: "That's like offsetting the footprint of 1 person's meat diet for a year!" },
            { threshold: 1000.0, text: "That's equal to the annual CO₂ footprint of a small car!" }
        ];

        // Material comparison data for storytelling
        const materialComparisons = {
            'mycelium-leather': { 
                traditional: 'leather', 
                co2Reduction: 88,
                waterReduction: 99,
                story: "Mycelium leather uses 88% less carbon and 99% less water than traditional leather"
            },
            'hemp': { 
                traditional: 'cotton', 
                co2Reduction: 57,
                waterReduction: 97,
                story: "Hemp uses 57% less carbon and 97% less water than conventional cotton"
            },
            'pinatex': { 
                traditional: 'leather', 
                co2Reduction: 75,
                waterReduction: 98,
                story: "Piñatex reduces carbon by 75% and water by 98% compared to leather"
            }
        };

        // ================== CORE FUNCTIONS ==================
        let currentQRCode = null;

        function addMaterial() {
          const container = document.getElementById('materials-container');
          const newRow = document.createElement('div');
          newRow.className = 'input-row';
          newRow.innerHTML = `
            <select class="material-type">
              <optgroup label="Traditional Materials">
                <option value="plastic-virgin">Virgin Plastic</option>
                <option value="plastic-recycled">Recycled Plastic</option>
                <option value="leather">Leather</option>
                <option value="wool-virgin">Virgin Wool</option>
                <option value="wool-recycled">Recycled Wool</option>
                <option value="cotton">Cotton</option>
                <option value="polyester">Polyester</option>
              </optgroup>
              <optgroup label="Sustainable Innovations">
                <option value="vegan-leather">Vegan Leather</option>
                <option value="hemp">Hemp</option>
                <option value="linen">Linen</option>
                <option value="tencel">Tencel/Lyocell</option>
                <option value="mycelium-leather" selected>Mycelium Leather</option>
                <option value="pinatex">Piñatex</option>
                <option value="cork">Cork</option>
                <option value="bioplastic">Bioplastic</option>
              </optgroup>
              <optgroup label="Other Materials">
                <option value="rubber">Rubber</option>
                <option value="steel">Steel</option>
                <option value="aluminum">Aluminum</option>
                <option value="glass">Glass</option>
                <option value="cardboard">Cardboard</option>
                <option value="nylon-recycled">Recycled Nylon</option>
              </optgroup>
            </select>
            <input type="number" class="material-weight" placeholder="kg" step="0.01" value="0.8">
            <input type="number" class="material-water" placeholder="Actual water (L)" step="1" value="100">
            <button class="remove-btn" onclick="this.parentElement.remove()">×</button>
          `;
          container.appendChild(newRow);
        }

        function addTransport() {
          const container = document.getElementById('transport-container');
          const newRow = document.createElement('div');
          newRow.className = 'input-row';
          newRow.innerHTML = `
            <select class="transport-mode">
              <optgroup label="Standard Transport">
                <option value="road">Road Freight</option>
                <option value="air">Air Freight</option>
                <option value="sea" selected>Sea Freight</option>
                <option value="rail">Rail</option>
              </optgroup>
              <optgroup label="Sustainable Options">
                <option value="electric-vehicle">Electric Vehicle</option>
                <option value="cargo-bike">Cargo Bike</option>
                <option value="inland-waterway">Inland Waterway</option>
              </optgroup>
              <optgroup label="Specialized">
                <option value="last-mile-van">Last-Mile Delivery Van</option>
                <option value="pipeline">Pipeline</option>
              </optgroup>
            </select>
            <input type="number" class="transport-distance" placeholder="km" step="1" value="800">
            <input type="number" class="transport-weight" placeholder="kg" step="0.01" value="1.2">
            <button class="remove-btn" onclick="this.parentElement.remove()">×</button>
          `;
          container.appendChild(newRow);
        }

        function calculatePCF() {
          const country = document.getElementById('product-country').value;
          
          // 1. Materials Calculation (CO₂ + Water)
          let materialCO2 = 0;
          let totalWaterUsed = 0;
          let totalWaterSaved = 0;
          const materialsLog = [];
          let allCertifications = new Set();
          
          document.querySelectorAll('#materials-container .input-row').forEach(row => {
            const type = row.querySelector('.material-type').value;
            const weight = parseFloat(row.querySelector('.material-weight').value) || 0;
            const waterUsed = parseFloat(row.querySelector('.material-water').value) || 0;
            const co2Factor = PCFFactors.materials[type].co2[country] || PCFFactors.materials[type].co2['global'];
            const waterBenchmark = PCFFactors.materials[type].water * weight;
            const waterSaved = waterBenchmark - waterUsed;

            materialCO2 += weight * co2Factor;
            totalWaterUsed += waterUsed;
            totalWaterSaved += waterSaved;

            // Add certifications
            PCFFactors.materials[type].certifications.forEach(cert => allCertifications.add(cert));

            materialsLog.push({
              name: type.replace('-', ' '),
              weight,
              co2: weight * co2Factor,
              waterUsed,
              waterSaved,
              waterBenchmark,
              co2Factor: co2Factor.toFixed(3),
              story: PCFFactors.materials[type].story,
              certifications: PCFFactors.materials[type].certifications
            });
          });

          // 2. Energy Calculation
          const energyType = document.getElementById('energy-type').value;
          const energyAmount = parseFloat(document.getElementById('energy-amount').value) || 0;
          const energyFactor = PCFFactors.energy[energyType][country] || PCFFactors.energy[energyType]['global'];
          const energyCO2 = energyAmount * energyFactor;

          // 3. Transport Calculation
          let transportCO2 = 0;
          const transportLog = [];
          document.querySelectorAll('#transport-container .input-row').forEach(row => {
            const mode = row.querySelector('.transport-mode').value;
            const distance = parseFloat(row.querySelector('.transport-distance').value) || 0;
            const weight = parseFloat(row.querySelector('.transport-weight').value) || 0;
            const factor = PCFFactors.transport[mode][country] || PCFFactors.transport[mode]['global'];
            const co2 = (weight * distance * factor) / 1000;
            transportCO2 += co2;
            transportLog.push({
              mode,
              distance,
              weight,
              co2,
              factor: factor.toFixed(3)
            });
          });

          // 4. Final Totals
          const totalCO2 = materialCO2 + energyCO2 + transportCO2;
          const benchmark = parseFloat(document.getElementById('benchmark').value) || 6.0;
          const savedCO2 = benchmark - totalCO2;

          showResults(totalCO2, materialCO2, energyCO2, transportCO2, {
            waterUsed: totalWaterUsed,
            waterSaved: totalWaterSaved,
            materials: materialsLog,
            energy: { type: energyType, amount: energyAmount, co2: energyCO2, factor: energyFactor.toFixed(3) },
            transport: transportLog,
            country,
            savedCO2,
            benchmark,
            certifications: Array.from(allCertifications)
          });
        }

        function showResults(totalCO2, materialsCO2, energyCO2, transportCO2, data) {
          const sources = {
            'Germany': 'UBA 2024',
            'France': 'ADEME 2024',
            'UK': 'DESNZ 2024',
            'US': 'EPA 2024',
            'China': 'CAEP 2024',
            'Japan': 'MOE Japan 2024',
            'global': 'Weighted Global Average'
          };

          // Update comparison cards
          document.getElementById('your-co2').textContent = `${totalCO2.toFixed(2)} kg`;
          document.getElementById('avg-co2').textContent = `${data.benchmark.toFixed(2)} kg`;
          document.getElementById('impactCo2').textContent = `${data.savedCO2.toFixed(2)} kg CO₂e`;

          // Find appropriate analogy
          let co2Analogy = "This is a climate-positive choice!";
          for (let i = co2Analogies.length - 1; i >= 0; i--) {
              if (data.savedCO2 >= co2Analogies[i].threshold) {
                  co2Analogy = co2Analogies[i].text;
                  break;
              }
          }
          document.getElementById('impactAnalogy').textContent = co2Analogy;

          // Generate certification badges
          const certificationBadges = generateCertificationBadges(data.certifications);

          // Generate material comparison if applicable
          const materialComparison = generateMaterialComparison(data.materials);

          // 1. CO₂ Results with enhanced storytelling
          document.getElementById('result-summary').innerHTML = `
            <h3>${document.getElementById('product-name').value || 'Product'}</h3>
            <p>Total CO₂ Footprint: <strong>${totalCO2.toFixed(2)} kg</strong></p>
            ${data.savedCO2 > 0 ? `<p class="savings">♻️ CO₂ Saved: ${data.savedCO2.toFixed(2)} kg vs. ${data.benchmark.toFixed(2)} kg benchmark</p>` : ''}
            ${data.waterSaved > 0 ? `<p class="water-savings">💧 Water Saved: ${data.waterSaved.toFixed(0)} L vs. industry average</p>` : ''}
            
            ${certificationBadges}
            
            <div class="story-section">
                <div class="story-heading">
                    <span>🌍</span>
                    <h3>Your Sustainability Story</h3>
                </div>
                <p>By choosing ${data.materials.map(m => m.name).join(' and ')}, this product represents a conscious choice for our planet.</p>
                <p>${data.materials.map(m => m.story).join(' ')}</p>
                <p>Your decision saves <strong>${data.savedCO2.toFixed(2)} kg of CO₂</strong> compared to conventional alternatives—${co2Analogy.toLowerCase()}</p>
            </div>

            ${materialComparison}
            
            <div class="detail-section">
              <h4>🧱 Materials (${materialsCO2.toFixed(2)} kg CO₂)</h4>
              ${data.materials.map(m => `
                <div class="material-item">
                    <strong>${m.weight} kg ${m.name}</strong>: ${m.co2.toFixed(2)} kg CO₂
                    ${m.certifications.length > 0 ? `<div class="certification-badges">${m.certifications.map(cert => `<span class="cert-badge ${cert}">${cert.toUpperCase()}</span>`).join('')}</div>` : ''}
                    <br><small>${m.story}</small>
                </div>`
              ).join('')}
              
              <h4>⚡ Manufacturing (${energyCO2.toFixed(2)} kg CO₂)</h4>
              <div class="material-item">
                <strong>${data.energy.amount} kWh ${data.energy.type}</strong> @ ${data.energy.factor} kg/kWh = ${data.energy.co2.toFixed(2)} kg
                ${data.energy.type !== 'grid' ? '<span class="innovation-badge">RENEWABLE</span>' : ''}
              </div>
              
              <h4>🚚 Transport (${transportCO2.toFixed(2)} kg CO₂)</h4>
              ${data.transport.map(t => `
                <div class="material-item">
                    <strong>${t.weight} kg × ${t.distance} km ${t.mode}</strong> = ${t.co2.toFixed(2)} kg
                    ${['electric-vehicle', 'cargo-bike', 'inland-waterway'].includes(t.mode) ? '<span class="innovation-badge">LOW IMPACT</span>' : ''}
                </div>`
              ).join('')}
            </div>

            <!-- WATER RESULTS -->
            <div class="water-results">
              <h4>💧 Water Footprint</h4>
              <p>Actual Used: <strong>${data.waterUsed.toFixed(0)} L</strong></p>
              <p class="water-savings">✅ Saved: ${data.waterSaved.toFixed(0)} L vs. industry avg</p>
              ${data.materials.map(m => `
                <div class="material-item">
                    <strong>${m.weight} kg ${m.name}</strong>: Used ${m.waterUsed.toFixed(0)} L | Saved ${m.waterSaved.toFixed(0)} L
                </div>`
              ).join('')}
            </div>
            <p class="data-source">Data Sources: ${sources[data.country]} + Water Footprint Network + ADEME Base Carbone</p>
          `;

          // 2. Pie Chart (CO₂ Only)
          const ctx = document.getElementById('chart').getContext('2d');
          if (window.myChart) window.myChart.destroy();
          
          window.myChart = new Chart(ctx, {
            type: 'pie',
            data: {
              labels: [
                `Materials (${((materialsCO2/totalCO2)*100).toFixed(0)}%)`,
                `Manufacturing (${((energyCO2/totalCO2)*100).toFixed(0)}%)`,
                `Transport (${((transportCO2/totalCO2)*100).toFixed(0)}%)`
              ],
              datasets: [{
                data: [materialsCO2, energyCO2, transportCO2],
                backgroundColor: ['#2e8b57', '#3a86ff', '#ff9f1c'],
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { position: 'bottom' },
                title: { display: true, text: 'CO₂ Emission Breakdown', font: { size: 16 } }
              }
            }
          });

          // 3. Generate QR Code
          generateQRCode(totalCO2, data.waterSaved, data.country, data.savedCO2, data.certifications);
          document.getElementById('results').style.display = 'block';
        }

        function generateCertificationBadges(certifications) {
          if (certifications.length === 0) return '';
          
          const badgeLabels = {
            'organic': '🌿 ORGANIC',
            'recycled': '♻️ RECYCLED', 
            'vegan': '🌱 VEGAN',
            'innovation': '💡 INNOVATION'
          };
          
          return `
            <div class="certification-badges">
                <h4>🏅 Product Certifications</h4>
                ${certifications.map(cert => `
                    <span class="cert-badge ${cert}">${badgeLabels[cert] || cert.toUpperCase()}</span>
                `).join('')}
            </div>
          `;
        }

        function generateMaterialComparison(materials) {
          let comparisonHTML = '';
          
          materials.forEach(material => {
            const comparison = materialComparisons[material.name.replace(' ', '-')];
            if (comparison) {
              comparisonHTML = `
                <div class="material-comparison">
                    <h4>🚀 Innovation Breakthrough</h4>
                    <p>Choosing ${material.name} over ${comparison.traditional} achieves:</p>
                    <div class="comparison-grid">
                        <div class="comparison-item">
                            <strong>${comparison.co2Reduction}%</strong>
                            <div>Less CO₂</div>
                        </div>
                        <div class="comparison-item">
                            <strong>${comparison.waterReduction}%</strong>
                            <div>Less Water</div>
                        </div>
                    </div>
                    <p><em>${comparison.story}</em></p>
                </div>
              `;
            }
          });
          
          return comparisonHTML;
        }

        function generateQRCode(totalCO2, waterSaved, country, savedCO2, certifications) {
          const qrElement = document.getElementById('qrcode');
          qrElement.innerHTML = '';
          document.getElementById('qr-error').style.display = 'none';
          document.getElementById('downloadQR').style.display = 'none';
          
          if (currentQRCode) currentQRCode.clear();

          const productName = document.getElementById('product-name').value || 'Product';
          const certString = certifications.length > 0 ? certifications.join(',') : 'standard';
          
          const qrText = `AIOXY FASHION PASSPORT v2.0|${productName}|CO2:${totalCO2.toFixed(2)}kg|WaterSaved:${waterSaved.toFixed(0)}L|CO2Saved:${savedCO2.toFixed(2)}kg|Certs:${certString}|${country}|Verified:${new Date().toISOString().split('T')[0]}`;

          try {
            if (typeof QRCode !== 'undefined') {
              currentQRCode = new QRCode(qrElement, {
                text: qrText,
                width: 200,
                height: 200,
                colorDark: "#2e8b57",
                colorLight: "#ffffff",
                correctLevel: QRCode.CorrectLevel.H
              });
              
              setTimeout(() => {
                const qrImg = qrElement.querySelector('img');
                if (qrImg) {
                  document.getElementById('downloadQR').href = qrImg.src;
                  document.getElementById('downloadQR').style.display = 'inline-block';
                }
              }, 200);
            } else {
              throw new Error("QRCode library not loaded");
            }
          } catch (e) {
            document.getElementById('qr-error').textContent = "QR generation failed";
            document.getElementById('qr-error').style.display = 'block';
          }
        }

        // ================== UTILITIES ==================
        function saveAsPDF() {
          alert("PDF export coming in v2.1 - Use browser print for now!");
        }

        function copyResults() {
          const text = document.getElementById('result-summary').innerText;
          navigator.clipboard.writeText(text).then(() => {
            alert("Sustainability Passport copied to clipboard!");
          });
        }

        // ================== INIT ==================
        document.addEventListener('DOMContentLoaded', () => {
          addMaterial();
          addTransport();
          
          // Twitter Share
          document.getElementById('share').addEventListener('click', () => {
            const product = document.getElementById('product-name').value || 'Product';
            const co2 = document.querySelector('#result-summary p')?.innerText || '';
            const water = document.querySelector('.water-savings')?.innerText || '';
            window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(
              `Check my ${product}'s verified sustainability footprint: ${co2} | ${water} - Generated with @AIOXY #SustainableFashion #GreenClaims`
            )}`);
          });
          
          // Set default values for a better UX
          document.getElementById('product-name').value = "Innovative Mycelium Handbag";
          document.getElementById('product-country').value = "France";
          document.getElementById('energy-amount').value = "2.5";
          document.getElementById('energy-type').value = "solar";
          document.getElementById('benchmark').value = "6.00";
        });
    </script>
</body>
    </html>
